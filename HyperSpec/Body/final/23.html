<!-- Common Lisp HyperSpec (TM), version 7.0 generated by Kent M. Pitman on Mon, 11-Apr-2005 2:31am EDT -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
<head>
<meta name="generator" content=
"HTML Tidy for Linux/x86 (vers 12 April 2005), see www.w3.org">
<title>CLHS: Chapter 23</title>
<link href="../Data/clhs.css" rel="stylesheet" type="text/css">
<meta http-equiv="Author" content="Kent M. Pitman">
<meta http-equiv="Organization" content="LispWorks Ltd.">
<link rel="TOP" href="../Front/index.htm">
<link rel="COPYRIGHT" href="../Front/Help.htm#Legal">
<link rel="DISCLAIMER" href="../Front/Help.htm#Disclaimer">
<link rel="PREV" href="f_format.htm">
<link rel="UP" href="../Front/Contents.htm">
<link rel="NEXT" href="23_a.htm">
<title>CLHS: Section 23.1</title>
<link href="../Data/clhs.css" rel="stylesheet" type="text/css">
<meta http-equiv="Author" content="Kent M. Pitman">
<meta http-equiv="Organization" content="LispWorks Ltd.">
<link rel="TOP" href="../Front/index.htm">
<link rel="COPYRIGHT" href="../Front/Help.htm#Legal">
<link rel="DISCLAIMER" href="../Front/Help.htm#Disclaimer">
<link rel="PREV" href="23_.htm">
<link rel="UP" href="23_.htm">
<link rel="NEXT" href="23_aa.htm">
<title>CLHS: Section 23.1.1</title>
<link href="../Data/clhs.css" rel="stylesheet" type="text/css">
<meta http-equiv="Author" content="Kent M. Pitman">
<meta http-equiv="Organization" content="LispWorks Ltd.">
<link rel="TOP" href="../Front/index.htm">
<link rel="COPYRIGHT" href="../Front/Help.htm#Legal">
<link rel="DISCLAIMER" href="../Front/Help.htm#Disclaimer">
<link rel="PREV" href="23_a.htm">
<link rel="UP" href="23_a.htm">
<link rel="NEXT" href="23_ab.htm">
<title>CLHS: Section 23.1.2</title>
<link href="../Data/clhs.css" rel="stylesheet" type="text/css">
<meta http-equiv="Author" content="Kent M. Pitman">
<meta http-equiv="Organization" content="LispWorks Ltd.">
<link rel="TOP" href="../Front/index.htm">
<link rel="COPYRIGHT" href="../Front/Help.htm#Legal">
<link rel="DISCLAIMER" href="../Front/Help.htm#Disclaimer">
<link rel="PREV" href="23_aa.htm">
<link rel="UP" href="23_a.htm">
<link rel="NEXT" href="23_aba.htm">
<title>CLHS: Section 23.1.2.1</title>
<link href="../Data/clhs.css" rel="stylesheet" type="text/css">
<meta http-equiv="Author" content="Kent M. Pitman">
<meta http-equiv="Organization" content="LispWorks Ltd.">
<link rel="TOP" href="../Front/index.htm">
<link rel="COPYRIGHT" href="../Front/Help.htm#Legal">
<link rel="DISCLAIMER" href="../Front/Help.htm#Disclaimer">
<link rel="PREV" href="23_ab.htm">
<link rel="UP" href="23_ab.htm">
<link rel="NEXT" href="23_ac.htm">
<title>CLHS: Section 23.1.3</title>
<link href="../Data/clhs.css" rel="stylesheet" type="text/css">
<meta http-equiv="Author" content="Kent M. Pitman">
<meta http-equiv="Organization" content="LispWorks Ltd.">
<link rel="TOP" href="../Front/index.htm">
<link rel="COPYRIGHT" href="../Front/Help.htm#Legal">
<link rel="DISCLAIMER" href="../Front/Help.htm#Disclaimer">
<link rel="PREV" href="23_aba.htm">
<link rel="UP" href="23_a.htm">
<link rel="NEXT" href="23_aca.htm">
<title>CLHS: Section 23.1.3.1</title>
<link href="../Data/clhs.css" rel="stylesheet" type="text/css">
<meta http-equiv="Author" content="Kent M. Pitman">
<meta http-equiv="Organization" content="LispWorks Ltd.">
<link rel="TOP" href="../Front/index.htm">
<link rel="COPYRIGHT" href="../Front/Help.htm#Legal">
<link rel="DISCLAIMER" href="../Front/Help.htm#Disclaimer">
<link rel="PREV" href="23_ac.htm">
<link rel="UP" href="23_ac.htm">
<link rel="NEXT" href="23_acb.htm">
<title>CLHS: Section 23.1.3.2</title>
<link href="../Data/clhs.css" rel="stylesheet" type="text/css">
<meta http-equiv="Author" content="Kent M. Pitman">
<meta http-equiv="Organization" content="LispWorks Ltd.">
<link rel="TOP" href="../Front/index.htm">
<link rel="COPYRIGHT" href="../Front/Help.htm#Legal">
<link rel="DISCLAIMER" href="../Front/Help.htm#Disclaimer">
<link rel="PREV" href="23_aca.htm">
<link rel="UP" href="23_ac.htm">
<link rel="NEXT" href="c_reader.htm">
</head>
<body>
<p><a name="chaptwentythree" id="chaptwentythree"></a><a name=
"reader" id="reader"></a></p>
<h2>23. Reader</h2>
<!-- Common Lisp HyperSpec (TM), version 7.0 generated by Kent M. Pitman on Mon, 11-Apr-2005 2:31am EDT -->
<h2>23.1 Reader Concepts</h2>
<!-- Common Lisp HyperSpec (TM), version 7.0 generated by Kent M. Pitman on Mon, 11-Apr-2005 2:31am EDT -->
<h2>23.1.1 Dynamic Control of the Lisp Reader</h2>
<p>Various aspects of the <a rel="DEFINITION" href=
"26_glo_l.htm#lisp_reader"><i>Lisp reader</i></a> can be controlled
dynamically. See <a rel="CHILD" href="02_aa.htm">Section 2.1.1
(Readtables)</a> and <a rel="CHILD" href="02_ab.htm">Section 2.1.2
(Variables that affect the Lisp Reader)</a>.</p>
<!-- Common Lisp HyperSpec (TM), version 7.0 generated by Kent M. Pitman on Mon, 11-Apr-2005 2:31am EDT -->
<h2>23.1.2 Effect of Readtable Case on the Lisp Reader</h2>
<p>The <a rel="DEFINITION" href=
"26_glo_r.htm#readtable_case"><i>readtable case</i></a> of the
<a rel="DEFINITION" href=
"26_glo_c.htm#current_readtable"><i>current readtable</i></a>
affects the <a rel="DEFINITION" href=
"26_glo_l.htm#lisp_reader"><i>Lisp reader</i></a> in the following
ways:</p>
<dl>
<dt><tt>:upcase</tt><br></dt>
<dd>When the <a rel="DEFINITION" href=
"26_glo_r.htm#readtable_case"><i>readtable case</i></a> is
<tt>:upcase</tt>, unescaped constituent <a rel="DEFINITION" href=
"26_glo_c.htm#character"><i>characters</i></a> are converted to
<a rel="DEFINITION" href=
"26_glo_u.htm#uppercase"><i>uppercase</i></a>, as specified in
<a rel="CHILD" href="02_b.htm">Section 2.2 (Reader
Algorithm)</a>.</dd>
<dt><tt>:downcase</tt><br></dt>
<dd>When the <a rel="DEFINITION" href=
"26_glo_r.htm#readtable_case"><i>readtable case</i></a> is
<tt>:downcase</tt>, unescaped constituent <a rel="DEFINITION" href=
"26_glo_c.htm#character"><i>characters</i></a> are converted to
<a rel="DEFINITION" href=
"26_glo_l.htm#lowercase"><i>lowercase</i></a>.</dd>
<dt><tt>:preserve</tt><br></dt>
<dd>When the <a rel="DEFINITION" href=
"26_glo_r.htm#readtable_case"><i>readtable case</i></a> is
<tt>:preserve</tt>, the case of all <a rel="DEFINITION" href=
"26_glo_c.htm#character"><i>characters</i></a> remains
unchanged.</dd>
<dt><tt>:invert</tt><br></dt>
<dd>When the <a rel="DEFINITION" href=
"26_glo_r.htm#readtable_case"><i>readtable case</i></a> is
<tt>:invert</tt>, then if all of the unescaped letters in the
extended token are of the same <a rel="DEFINITION" href=
"26_glo_c.htm#case"><i>case</i></a>, those (unescaped) letters are
converted to the opposite <a rel="DEFINITION" href=
"26_glo_c.htm#case"><i>case</i></a>.</dd>
</dl>
<!-- Common Lisp HyperSpec (TM), version 7.0 generated by Kent M. Pitman on Mon, 11-Apr-2005 2:31am EDT -->
<h2>23.1.2.1 Examples of Effect of Readtable Case on the Lisp
Reader</h2>
<pre>
 (defun test-readtable-case-reading ()
   (let ((*readtable* (copy-readtable nil)))
     (format t "READTABLE-CASE  Input   Symbol-name~
              ~%-----------------------------------~
              ~%")
     (dolist (readtable-case '(:upcase :downcase :preserve :invert))
       (setf (readtable-case *readtable*) readtable-case)
       (dolist (input '("ZEBRA" "Zebra" "zebra"))
         (format t "~&amp;:~A~16T~A~24T~A"
                 (string-upcase readtable-case)
                 input
                 (symbol-name (read-from-string input)))))))
</pre>
<p>The output from <tt>(test-readtable-case-reading)</tt> should be
as follows:</p>
<pre>
 READTABLE-CASE     Input Symbol-name
 -------------------------------------
    :UPCASE         ZEBRA   ZEBRA
    :UPCASE         Zebra   ZEBRA
    :UPCASE         zebra   ZEBRA
    :DOWNCASE       ZEBRA   zebra
    :DOWNCASE       Zebra   zebra
    :DOWNCASE       zebra   zebra
    :PRESERVE       ZEBRA   ZEBRA
    :PRESERVE       Zebra   Zebra
    :PRESERVE       zebra   zebra
    :INVERT         ZEBRA   zebra
    :INVERT         Zebra   Zebra
    :INVERT         zebra   ZEBRA
</pre>
<!-- Common Lisp HyperSpec (TM), version 7.0 generated by Kent M. Pitman on Mon, 11-Apr-2005 2:31am EDT -->
<h2>23.1.3 Argument Conventions of Some Reader Functions</h2>
<!-- Common Lisp HyperSpec (TM), version 7.0 generated by Kent M. Pitman on Mon, 11-Apr-2005 2:31am EDT -->
<h2>23.1.3.1 The EOF-ERROR-P argument</h2>
<p><i>Eof-error-p</i> in input function calls controls what happens
if input is from a file (or any other input source that has a
definite end) and the end of the file is reached. If
<i>eof-error-p</i> is <a rel="DEFINITION" href=
"26_glo_t.htm#true"><i>true</i></a> (the default), an error of
<a rel="DEFINITION" href="26_glo_t.htm#type"><i>type</i></a>
<a rel="DEFINITION" href=
"e_end_of.htm#end-of-file"><b>end-of-file</b></a> is signaled at
end of file. If it is <a rel="DEFINITION" href=
"26_glo_f.htm#false"><i>false</i></a>, then no error is signaled,
and instead the function returns <i>eof-value</i>.</p>
<p>Functions such as <a rel="DEFINITION" href=
"f_rd_rd.htm#read"><b>read</b></a> that read the representation of
an <a rel="DEFINITION" href="26_glo_o.htm#object"><i>object</i></a>
rather than a single character always signals an error, regardless
of <i>eof-error-p</i>, if the file ends in the middle of an object
representation. For example, if a file does not contain enough
right parentheses to balance the left parentheses in it, <a rel=
"DEFINITION" href="f_rd_rd.htm#read"><b>read</b></a> signals an
error. If a file ends in a <a rel="DEFINITION" href=
"26_glo_s.htm#symbol"><i>symbol</i></a> or a <a rel="DEFINITION"
href="26_glo_n.htm#number"><i>number</i></a> immediately followed
by end-of-file, <a rel="DEFINITION" href=
"f_rd_rd.htm#read"><b>read</b></a> reads the <a rel="DEFINITION"
href="26_glo_s.htm#symbol"><i>symbol</i></a> or <a rel="DEFINITION"
href="26_glo_n.htm#number"><i>number</i></a> successfully and when
called again will act according to <i>eof-error-p</i>. Similarly,
the <a rel="DEFINITION" href=
"26_glo_f.htm#function"><i>function</i></a> <a rel="DEFINITION"
href="f_rd_lin.htm#read-line"><b>read-line</b></a> successfully
reads the last line of a file even if that line is terminated by
end-of-file rather than the newline character. Ignorable text, such
as lines containing only <a rel="DEFINITION" href=
"26_glo_w.htm#whitespace"><i>whitespace</i></a>[2] or comments, are
not considered to begin an <a rel="DEFINITION" href=
"26_glo_o.htm#object"><i>object</i></a>; if <a rel="DEFINITION"
href="f_rd_rd.htm#read"><b>read</b></a> begins to read an <a rel=
"DEFINITION" href="26_glo_e.htm#expression"><i>expression</i></a>
but sees only such ignorable text, it does not consider the file to
end in the middle of an <a rel="DEFINITION" href=
"26_glo_o.htm#object"><i>object</i></a>. Thus an <i>eof-error-p</i>
argument controls what happens when the file ends between <a rel=
"DEFINITION" href="26_glo_o.htm#object"><i>objects</i></a>.</p>
<!-- Common Lisp HyperSpec (TM), version 7.0 generated by Kent M. Pitman on Mon, 11-Apr-2005 2:31am EDT -->
<h2>23.1.3.2 The RECURSIVE-P argument</h2>
<p>If <i>recursive-p</i> is supplied and not <a rel="DEFINITION"
href="a_nil.htm#nil"><b>nil</b></a>, it specifies that this
function call is not an outermost call to <a rel="DEFINITION" href=
"f_rd_rd.htm#read"><b>read</b></a> but an embedded call, typically
from a <a rel="DEFINITION" href=
"26_glo_r.htm#reader_macro_function"><i>reader macro
function</i></a>. It is important to distinguish such recursive
calls for three reasons.</p>
<dl>
<dt>1. An outermost call establishes the context within which the
<tt>#</tt><i>n</i><tt>=</tt> and <tt>#</tt><i>n</i><tt>#</tt>
syntax is scoped. Consider, for example, the expression<br></dt>
<dd>
<pre>
 (cons '#3=(p q r) '(x y . #3#))
</pre>
If the <a rel="DEFINITION" href=
"26_glo_s.htm#single-quote"><i>single-quote</i></a> <a rel=
"DEFINITION" href="26_glo_r.htm#reader_macro"><i>reader
macro</i></a> were defined in this way:
<pre>
 (set-macro-character #\'       ;incorrect
    #'(lambda (stream char)
         (declare (ignore char))
         (list 'quote (read stream))))
</pre>
<p>then each call to the <a rel="DEFINITION" href=
"26_glo_s.htm#single-quote"><i>single-quote</i></a> <a rel=
"DEFINITION" href="26_glo_r.htm#reader_macro_function"><i>reader
macro function</i></a> would establish independent contexts for the
scope of <a rel="DEFINITION" href=
"f_rd_rd.htm#read"><b>read</b></a> information, including the scope
of identifications between markers like "<tt>#3=</tt>" and
"<tt>#3#</tt>". However, for this expression, the scope was clearly
intended to be determined by the outer set of parentheses, so such
a definition would be incorrect. The correct way to define the
<a rel="DEFINITION" href=
"26_glo_s.htm#single-quote"><i>single-quote</i></a> <a rel=
"DEFINITION" href="26_glo_r.htm#reader_macro"><i>reader
macro</i></a> uses <i>recursive-p</i>:</p>
<pre>
 (set-macro-character #\'       ;correct
    #'(lambda (stream char)
         (declare (ignore char))
         (list 'quote (read stream t nil t))))
</pre></dd>
<dt>2. A recursive call does not alter whether the reading process
is to preserve <a rel="DEFINITION" href=
"26_glo_w.htm#whitespace"><i>whitespace</i></a>[2] or not (as
determined by whether the outermost call was to <a rel="DEFINITION"
href="f_rd_rd.htm#read"><b>read</b></a> or <a rel="DEFINITION"
href="f_rd_rd.htm#read-preserving-whitespace"><b>read-preserving-whitespace</b></a>).
Suppose again that <a rel="DEFINITION" href=
"26_glo_s.htm#single-quote"><i>single-quote</i></a> were to be
defined as shown above in the incorrect definition. Then a call to
<a rel="DEFINITION" href=
"f_rd_rd.htm#read-preserving-whitespace"><b>read-preserving-whitespace</b></a>
that read the expression <tt>'foo&lt;Space&gt;</tt> would fail to
preserve the space character following the symbol <tt>foo</tt>
because the <a rel="DEFINITION" href=
"26_glo_s.htm#single-quote"><i>single-quote</i></a> <a rel=
"DEFINITION" href="26_glo_r.htm#reader_macro_function"><i>reader
macro function</i></a> calls <a rel="DEFINITION" href=
"f_rd_rd.htm#read"><b>read</b></a>, not <a rel="DEFINITION" href=
"f_rd_rd.htm#read-preserving-whitespace"><b>read-preserving-whitespace</b></a>,
to read the following expression (in this case <tt>foo</tt>). The
correct definition, which passes the value <a rel="DEFINITION"
href="26_glo_t.htm#true"><i>true</i></a> for <i>recursive-p</i> to
<a rel="DEFINITION" href="f_rd_rd.htm#read"><b>read</b></a>, allows
the outermost call to determine whether <a rel="DEFINITION" href=
"26_glo_w.htm#whitespace"><i>whitespace</i></a>[2] is
preserved.<br></dt>
<dt>3. When end-of-file is encountered and the <i>eof-error-p</i>
argument is not <a rel="DEFINITION" href=
"a_nil.htm#nil"><b>nil</b></a>, the kind of error that is signaled
may depend on the value of <i>recursive-p</i>. If
<i>recursive-p</i> is <a rel="DEFINITION" href=
"26_glo_t.htm#true"><i>true</i></a>, then the end-of-file is deemed
to have occurred within the middle of a printed representation; if
<i>recursive-p</i> is <a rel="DEFINITION" href=
"26_glo_f.htm#false"><i>false</i></a>, then the end-of-file may be
deemed to have occurred between <a rel="DEFINITION" href=
"26_glo_o.htm#object"><i>objects</i></a> rather than within the
middle of one.<br></dt>
</dl>
</body>
</html>
