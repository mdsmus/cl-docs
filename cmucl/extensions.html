<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
"http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<meta name="generator" content=
"HTML Tidy for Mac OS X (vers 31 October 2006 - Apple Inc. build 13), see www.w3.org">
<meta http-equiv="Content-Type" content=
"text/html; charset=us-ascii">
<meta name="GENERATOR" content="hevea 1.06">
<link rel="stylesheet" href="cmucl.css" type="text/css">
<meta http-equiv="Content-Language" content="en">
<title>CMUCL User's Manual: Design Choices and Extensions</title>
</head>
<body>
<a href="introduction.html"><img src="previous_motif.gif" alt=
"Previous"></a> <a href="index.html"><img src="contents_motif.gif"
alt="Up"></a> <a href="debugger.html"><img src="next_motif.gif"
alt="Next"></a>
<hr>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFBC">
<div align="center">
<table>
<tr>
<td><a name="htoc5" id="htoc5"><b><font size=
"6">Chapter&nbsp;2</font></b></a></td>
<td width="100%" align="center"><b><font size="6">Design Choices
and Extensions</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<ul>
<li><a href="extensions.html#toc4">Data Types</a>
<ul>
<li><a href="extensions.html#toc5">Integers</a></li>
<li><a href="extensions.html#toc6">Floats</a>
<ul>
<li><a href="extensions.html#toc7">IEEE Special Values</a></li>
<li><a href="extensions.html#toc8">Negative Zero</a></li>
<li><a href="extensions.html#toc9">Denormalized Floats</a></li>
<li><a href="extensions.html#toc10">Floating Point
Exceptions</a></li>
<li><a href="extensions.html#toc11">Floating Point Rounding
Mode</a>
<ul>
<li><a href="extensions.html#toc12">Warning:</a></li>
</ul>
</li>
<li><a href="extensions.html#toc13">Accessing the Floating Point
Modes</a></li>
</ul>
</li>
<li><a href="extensions.html#toc14">Extended Floats</a></li>
<li><a href="extensions.html#toc15">Characters</a></li>
<li><a href="extensions.html#toc16">Array Initialization</a></li>
<li><a href="extensions.html#toc17">Hash tables</a></li>
</ul>
</li>
<li><a href="extensions.html#toc18">Default Interrupts for
Lisp</a></li>
<li><a href="extensions.html#toc19">Implementation-Specific
Packages</a></li>
<li><a href="extensions.html#toc20">Hierarchical Packages</a>
<ul>
<li><a href="extensions.html#toc21">Introduction</a></li>
<li><a href="extensions.html#toc22">Relative Package Names</a></li>
<li><a href="extensions.html#toc23">Compatibility with ANSI Common
Lisp</a>
<ul>
<li><a href="extensions.html#toc24">Changes to <tt class=
"code">cl:find-package</tt></a></li>
<li><a href="extensions.html#toc25">Using Hierarchical Packages
without Modifying cl:find-package</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="extensions.html#toc26">Package Locks</a>
<ul>
<li><a href="extensions.html#toc27">Rationale</a></li>
<li><a href="extensions.html#toc28">Disabling package
locks</a></li>
</ul>
</li>
<li><a href="extensions.html#toc29">The Editor</a></li>
<li><a href="extensions.html#toc30">Garbage Collection</a>
<ul>
<li><a href="extensions.html#toc31">GC Parameters</a></li>
<li><a href="extensions.html#toc32">Generational GC</a></li>
<li><a href="extensions.html#toc33">Weak Pointers</a></li>
<li><a href="extensions.html#toc34">Finalization</a></li>
</ul>
</li>
<li><a href="extensions.html#toc35">Describe</a></li>
<li><a href="extensions.html#toc36">The Inspector</a>
<ul>
<li><a href="extensions.html#toc37">The Graphical
Interface</a></li>
<li><a href="extensions.html#toc38">The TTY Inspector</a></li>
</ul>
</li>
<li><a href="extensions.html#toc39">Load</a></li>
<li><a href="extensions.html#toc40">The Reader</a>
<ul>
<li><a href="extensions.html#toc41">Reader Extensions</a></li>
<li><a href="extensions.html#toc42">Reader Parameters</a></li>
</ul>
</li>
<li><a href="extensions.html#toc43">Stream Extensions</a></li>
<li><a href="extensions.html#toc44">Simple Streams</a></li>
<li><a href="extensions.html#toc45">Running Programs from Lisp</a>
<ul>
<li><a href="extensions.html#toc46">Process Accessors</a></li>
</ul>
</li>
<li><a href="extensions.html#toc47">Saving a Core Image</a></li>
<li><a href="extensions.html#toc48">Pathnames</a>
<ul>
<li><a href="extensions.html#toc49">Unix Pathnames</a></li>
<li><a href="extensions.html#toc50">Wildcard Pathnames</a></li>
<li><a href="extensions.html#toc51">Logical Pathnames</a></li>
<li><a href="extensions.html#toc52">Search Lists</a></li>
<li><a href="extensions.html#toc53">Predefined
Search-Lists</a></li>
<li><a href="extensions.html#toc54">Search-List Operations</a></li>
<li><a href="extensions.html#toc55">Search List Example</a></li>
</ul>
</li>
<li><a href="extensions.html#toc56">Filesystem Operations</a>
<ul>
<li><a href="extensions.html#toc57">Wildcard Matching</a></li>
<li><a href="extensions.html#toc58">File Name Completion</a></li>
<li><a href="extensions.html#toc59">Miscellaneous Filesystem
Operations</a></li>
</ul>
</li>
<li><a href="extensions.html#toc60">Time Parsing and
Formatting</a></li>
<li><a href="extensions.html#toc61">Random Number Generation</a>
<ul>
<li><a href="extensions.html#toc62">Original Generator</a></li>
<li><a href="extensions.html#toc63">New Generator</a></li>
<li><a href="extensions.html#toc64">MT-19937 Generator</a></li>
</ul>
</li>
<li><a href="extensions.html#toc65">Lisp Threads</a></li>
<li><a href="extensions.html#toc66">Lisp Library</a></li>
<li><a href="extensions.html#toc67">Generalized Function
Names</a></li>
<li><a href="extensions.html#toc68">CLOS</a>
<ul>
<li><a href="extensions.html#toc69">Primary Method Errors</a></li>
<li><a href="extensions.html#toc70">Slot Type Checking</a></li>
<li><a href="extensions.html#toc71">Slot Access Optimization</a>
<ul>
<li><a href="extensions.html#toc72"><tt class=
"code">slot-boundp</tt> Declaration</a></li>
<li><a href="extensions.html#toc73"><tt class="code">inline</tt>
Declaration</a></li>
<li><a href="extensions.html#toc74">Automatic Method
Recompilation</a></li>
</ul>
</li>
<li><a href="extensions.html#toc75">Inlining Methods in Effective
Methods</a></li>
<li><a href="extensions.html#toc76">Effective Method
Precomputation</a></li>
<li><a href="extensions.html#toc77">Sealing</a></li>
<li><a href="extensions.html#toc78">Method Tracing and
Profiling</a></li>
<li><a href="extensions.html#toc79">Misc</a></li>
</ul>
</li>
<li><a href="extensions.html#toc80">Differences from ANSI Common
Lisp</a>
<ul>
<li><a href="extensions.html#toc81">Extensions</a></li>
</ul>
</li>
<li><a href="extensions.html#toc82">Function Wrappers</a></li>
<li><a href="extensions.html#toc83">Dynamic-Extent Declarations</a>
<ul>
<li><a href="extensions.html#toc84"><tt class="code">&amp;rest</tt>
argument lists</a></li>
<li><a href="extensions.html#toc85">Closures</a></li>
<li><a href="extensions.html#toc86"><tt class="code">list</tt>,
<tt class="code">list*</tt>, and <tt class=
"code">cons</tt></a></li>
</ul>
</li>
<li><a href="extensions.html#toc87">Modular Arithmetic</a></li>
<li><a href="extensions.html#toc88">Extension to REQUIRE</a></li>
</ul>
<br>
Several design choices in Common Lisp are left to the individual
implementation, and some essential parts of the programming
environment are left undefined. This chapter discusses the most
important design choices and extensions.<br>
<br>
<a name="toc4" id="toc4"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc6" id="htoc6"><b><font size=
"5">2.1</font></b></a></td>
<td width="100%" align="center"><b><font size="5">Data
Types</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
<a name="toc5" id="toc5"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc7" id="htoc7"><b><font size=
"4">2.1.1</font></b></a></td>
<td width="100%" align="center"><b><font size=
"4">Integers</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
The <a name="@types0"></a><tt class="code">fixnum</tt> type is
equivalent to <tt class="code">(signed-byte 30)</tt>. Integers
outside this range are represented as a <a name=
"@types1"></a><tt class="code">bignum</tt> or a word integer (see
section&nbsp;<a href=
"compiler-hint.html#word-integers">5.11.6</a>.) Almost all integers
that appear in programs can be represented as a <tt class=
"code">fixnum</tt>, so integer number consing is rare.<br>
<br>
<a name="toc6" id="toc6"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc8" id="htoc8"><b><font size=
"4">2.1.2</font></b></a></td>
<td width="100%" align="center"><b><font size=
"4">Floats</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="ieee-float" id="ieee-float"></a><br>
CMUCL supports three floating point formats: <a name=
"@types2"></a><tt class="code">single-float</tt>, <a name=
"@types3"></a><tt class="code">double-float</tt> and <a name=
"@types4"></a><tt class="code">double-double-float</tt>. The first
two are implemented with IEEE single and double float arithmetic,
respectively. The last is an extension; see section&nbsp;<a href=
"#extended-float">2.1.3</a> for more information. <tt class=
"code">short-float</tt> is a synonym for <tt class=
"code">single-float</tt>, and <tt class="code">long-float</tt> is a
synonym for <tt class="code">double-float</tt>. The initial value
of <a name="@vars0"></a><tt class=
"code">*read-default-float-format*</tt> is <tt class=
"code">single-float</tt>.<br>
<br>
Both <tt class="code">single-float</tt> and <tt class=
"code">double-float</tt> are represented with a pointer descriptor,
so float operations can cause number consing. Number consing is
greatly reduced if programs are written to allow the use of
non-descriptor representations (see section&nbsp;<a href=
"compiler-hint.html#numeric-types">5.11</a>.)<br>
<br>
<a name="toc7" id="toc7"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFED">
<div align="center">
<table>
<tr>
<td><b>2.1.2.1</b></td>
<td width="100%" align="center"><b>IEEE Special Values</b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
CMUCL supports the IEEE infinity and NaN special values. These
non-numeric values will only be generated when trapping is disabled
for some floating point exception (see section&nbsp;<a href=
"#float-traps">2.1.2.4</a>), so users of the default configuration
need not concern themselves with special values.<br>
<br>
<br>
<div align="left">[Constant]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">short-float-positive-infinity</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote>
<div align="left">[Constant]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">short-float-negative-infinity</tt>
&nbsp;&nbsp;&nbsp;</div>
<div align="left">[Constant]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">single-float-positive-infinity</tt>
&nbsp;&nbsp;&nbsp;</div>
<div align="left">[Constant]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">single-float-negative-infinity</tt>
&nbsp;&nbsp;&nbsp;</div>
<div align="left">[Constant]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">double-float-positive-infinity</tt>
&nbsp;&nbsp;&nbsp;</div>
<div align="left">[Constant]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">double-float-negative-infinity</tt>
&nbsp;&nbsp;&nbsp;</div>
<div align="left">[Constant]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">long-float-positive-infinity</tt>
&nbsp;&nbsp;&nbsp;</div>
<div align="left">[Constant]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">long-float-negative-infinity</tt>
&nbsp;&nbsp;&nbsp;</div>
<br>
The values of these constants are the IEEE positive and negative
infinity objects for each float format.</blockquote>
<br>
<a name="@funs1"></a><a name="FN:float-infinity-p" id=
"FN:float-infinity-p"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">float-infinity-p</tt> <tt class="variable">x</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function returns true if <tt class="variable">x</tt> is an
IEEE float infinity (of either sign.) <tt class="variable">x</tt>
must be a float.</blockquote>
<br>
<a name="@funs2"></a><a name="FN:float-nan-p" id=
"FN:float-nan-p"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">float-nan-p</tt> <tt class="variable">x</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
<a name="@funs3"></a><a name="FN:float-trapping-nan-p" id=
"FN:float-trapping-nan-p"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">float-trapping-nan-p</tt> <tt class=
"variable">x</tt> &nbsp;&nbsp;&nbsp;</div>
<br>
<br>
<tt class="code">float-nan-p</tt> returns true if <tt class=
"variable">x</tt> is an IEEE NaN (Not A Number) object. <tt class=
"code">float-trapping-nan-p</tt> returns true only if <tt class=
"variable">x</tt> is a trapping NaN. With either function,
<tt class="variable">x</tt> must be a float.</blockquote>
<a name="toc8" id="toc8"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFED">
<div align="center">
<table>
<tr>
<td><b>2.1.2.2</b></td>
<td width="100%" align="center"><b>Negative Zero</b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
The IEEE float format provides for distinct positive and negative
zeros. To test the sign on zero (or any other float), use the
Common Lisp <a name="@funs4"></a><tt class="code">float-sign</tt>
function. Negative zero prints as <tt class="code">-0.0f0</tt> or
<tt class="code">-0.0d0</tt>.<br>
<br>
<a name="toc9" id="toc9"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFED">
<div align="center">
<table>
<tr>
<td><b>2.1.2.3</b></td>
<td width="100%" align="center"><b>Denormalized Floats</b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
CMUCL supports IEEE denormalized floats. Denormalized floats
provide a mechanism for gradual underflow. The Common Lisp <a name=
"@funs5"></a><tt class="code">float-precision</tt> function returns
the actual precision of a denormalized float, which will be less
than <a name="@funs6"></a><tt class="code">float-digits</tt>. Note
that in order to generate (or even print) denormalized floats,
trapping must be disabled for the underflow exception (see
section&nbsp;<a href="#float-traps">2.1.2.4</a>.) The Common Lisp
<tt class="code">least-positive-</tt><tt class=
"variable">format</tt>-<tt class="code">float</tt> constants are
denormalized.<br>
<br>
<br>
<a name="@funs7"></a><a name="FN:float-denormalized-p" id=
"FN:float-denormalized-p"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">float-denormalized-p</tt> <tt class=
"variable">x</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function returns true if <tt class="variable">x</tt> is a
denormalized float. <tt class="variable">x</tt> must be a
float.</blockquote>
<a name="toc10" id="toc10"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFED">
<div align="center">
<table>
<tr>
<td><b>2.1.2.4</b></td>
<td width="100%" align="center"><b>Floating Point
Exceptions</b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="float-traps" id="float-traps"></a><br>
The IEEE floating point standard defines several exceptions that
occur when the result of a floating point operation is unclear or
undesirable. Exceptions can be ignored, in which case some default
action is taken, such as returning a special value. When trapping
is enabled for an exception, a error is signalled whenever that
exception occurs. These are the possible floating point exceptions:
<dl compact="compact">
<dt><tt class="code">:underflow</tt><br></dt>
<dd>This exception occurs when the result of an operation is too
small to be represented as a normalized float in its format. If
trapping is enabled, the <a name="@types5"></a><tt class=
"code">floating-point-underflow</tt> condition is signalled.
Otherwise, the operation results in a denormalized float or
zero.<br>
<br></dd>
<dt><tt class="code">:overflow</tt><br></dt>
<dd>This exception occurs when the result of an operation is too
large to be represented as a float in its format. If trapping is
enabled, the <a name="@types6"></a><tt class=
"code">floating-point-overflow</tt> exception is signalled.
Otherwise, the operation results in the appropriate infinity.<br>
<br></dd>
<dt><tt class="code">:inexact</tt><br></dt>
<dd>This exception occurs when the result of a floating point
operation is not exact, i.e. the result was rounded. If trapping is
enabled, the <tt class=
"code">extensions:floating-point-inexact</tt> condition is
signalled. Otherwise, the rounded result is returned.<br>
<br></dd>
<dt><tt class="code">:invalid</tt><br></dt>
<dd>This exception occurs when the result of an operation is
ill-defined, such as <tt class="code">(/ 0.0 0.0)</tt>. If trapping
is enabled, the <tt class=
"code">extensions:floating-point-invalid</tt> condition is
signalled. Otherwise, a quiet NaN is returned.<br>
<br></dd>
<dt><tt class="code">:divide-by-zero</tt><br></dt>
<dd>This exception occurs when a float is divided by zero. If
trapping is enabled, the <a name="@types7"></a><tt class=
"code">divide-by-zero</tt> condition is signalled. Otherwise, the
appropriate infinity is returned.</dd>
</dl>
<a name="toc11" id="toc11"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFED">
<div align="center">
<table>
<tr>
<td><b>2.1.2.5</b></td>
<td width="100%" align="center"><b>Floating Point Rounding
Mode</b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="float-rounding-modes" id="float-rounding-modes"></a><br>
IEEE floating point specifies four possible rounding modes:
<dl compact="compact">
<dt><tt class="code">:nearest</tt><br></dt>
<dd>In this mode, the inexact results are rounded to the nearer of
the two possible result values. If the neither possibility is
nearer, then the even alternative is chosen. This form of rounding
is also called ``round to even'', and is the form of rounding
specified for the Common Lisp <a name="@funs8"></a><tt class=
"code">round</tt> function.<br>
<br></dd>
<dt><tt class="code">:positive-infinity</tt><br></dt>
<dd>This mode rounds inexact results to the possible value closer
to positive infinity. This is analogous to the Common Lisp <a name=
"@funs9"></a><tt class="code">ceiling</tt> function.<br>
<br></dd>
<dt><tt class="code">:negative-infinity</tt><br></dt>
<dd>This mode rounds inexact results to the possible value closer
to negative infinity. This is analogous to the Common Lisp <a name=
"@funs10"></a><tt class="code">floor</tt> function.<br>
<br></dd>
<dt><tt class="code">:zero</tt><br></dt>
<dd>This mode rounds inexact results to the possible value closer
to zero. This is analogous to the Common Lisp <a name=
"@funs11"></a><tt class="code">truncate</tt> function.</dd>
</dl>
<a name="toc12" id="toc12"></a>
<h5>Warning:</h5>
Although the rounding mode can be changed with <tt class=
"code">set-floating-point-modes</tt>, use of any value other than
the default (<tt class="code">:nearest</tt>) can cause unusual
behavior, since it will affect rounding done by Common Lisp system
code as well as rounding in user code. In particular, the unary
<tt class="code">round</tt> function will stop doing
round-to-nearest on floats, and instead do the selected form of
rounding.<br>
<br>
<a name="toc13" id="toc13"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFED">
<div align="center">
<table>
<tr>
<td><b>2.1.2.6</b></td>
<td width="100%" align="center"><b>Accessing the Floating Point
Modes</b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
These functions can be used to modify or read the floating point
modes:<br>
<br>
<br>
<a name="@funs12"></a><a name="FN:set-floating-point-modes" id=
"FN:set-floating-point-modes"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">set-floating-point-modes</tt> <tt class=
"code">&amp;key</tt> <tt class="code">:traps</tt> <tt class=
"code">:rounding-mode</tt><br>
<tt class="code">:fast-mode</tt> <tt class=
"code">:accrued-exceptions</tt><br>
<tt class="code">:current-exceptions</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
<a name="@funs13"></a><a name="FN:get-floating-point-modes" id=
"FN:get-floating-point-modes"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">get-floating-point-modes</tt>
&nbsp;&nbsp;&nbsp;</div>
<br>
The keyword arguments to <tt class=
"code">set-floating-point-modes</tt> set various modes controlling
how floating point arithmetic is done:
<dl compact="compact">
<dt><tt class="code">:traps</tt><br></dt>
<dd>A list of the exception conditions that should cause traps.
Possible exceptions are <tt class="code">:underflow</tt>,
<tt class="code">:overflow</tt>, <tt class="code">:inexact</tt>,
<tt class="code">:invalid</tt> and <tt class=
"code">:divide-by-zero</tt>. Initially all traps except <tt class=
"code">:inexact</tt> are enabled. See section&nbsp;<a href=
"#float-traps">2.1.2.4</a>.<br>
<br></dd>
<dt><tt class="code">:rounding-mode</tt><br></dt>
<dd>The rounding mode to use when the result is not exact. Possible
values are <tt class="code">:nearest</tt>, <tt class=
"code">:positive-infinity</tt>, <tt class=
"code">:negative-infinity</tt> and <tt class="code">:zero</tt>.
Initially, the rounding mode is <tt class="code">:nearest</tt>. See
the warning in section <a href="#float-rounding-modes">2.1.2.5</a>
about use of other rounding modes.<br>
<br></dd>
<dt><tt class="code">:current-exceptions</tt>, <tt class=
"code">:accrued-exceptions</tt><br></dt>
<dd>Lists of exception keywords used to set the exception flags.
The <tt class="variable">current-exceptions</tt> are the exceptions
for the previous operation, so setting it is not very useful. The
<tt class="variable">accrued-exceptions</tt> are a cumulative
record of the exceptions that occurred since the last time these
flags were cleared. Specifying <tt class="code">()</tt> will clear
any accrued exceptions.<br>
<br></dd>
<dt><tt class="code">:fast-mode</tt><br></dt>
<dd>Set the hardware's ``fast mode'' flag, if any. When set, IEEE
conformance or debuggability may be impaired. Some machines may not
have this feature, in which case the value is always <tt class=
"code">nil</tt>. Sparc platforms support a fast mode where denormal
numbers are silently truncated to zero.</dd>
</dl>
If a keyword argument is not supplied, then the associated state is
not changed.<br>
<br>
<tt class="code">get-floating-point-modes</tt> returns a list
representing the state of the floating point modes. The list is in
the same format as the keyword arguments to <tt class=
"code">set-floating-point-modes</tt>, so <tt class=
"code">apply</tt> could be used with <tt class=
"code">set-floating-point-modes</tt> to restore the modes in effect
at the time of the call to <tt class=
"code">get-floating-point-modes</tt>.</blockquote>
To make handling control of floating-point exceptions, the
following macro is useful.<br>
<br>
<br>
<a name="@funs14"></a><a name="FN:with-float-traps-masked" id=
"FN:with-float-traps-masked"></a>
<div align="left">[Macro]<br>
<tt class="function-name">ext:</tt><tt class=
"function-name">with-float-traps-masked</tt> traps <tt class=
"code">&amp;body</tt> body &nbsp;&nbsp;&nbsp;</div>
<blockquote><tt class="code">body</tt> is executed with the
selected floating-point exceptions given by <tt class=
"code">traps</tt> masked out (disabled). <tt class=
"code">traps</tt> should be a list of possible floating-point
exceptions that should be ignored. Possible values are <tt class=
"code">:underflow</tt>, <tt class="code">:overflow</tt>, <tt class=
"code">:inexact</tt>, <tt class="code">:invalid</tt> and <tt class=
"code">:divide-by-zero</tt>.<br>
<br>
This is equivalent to saving the current traps from <tt class=
"code">get-floating-point-modes</tt>, setting the floating-point
modes to the desired exceptions, running the <tt class=
"code">body</tt>, and restoring the saved floating-point modes. The
advantage of this macro is that it causes less consing to
occur.<br>
<br>
Some points about the with-float-traps-masked:
<ul>
<li>Two approaches are available for detecting FP exceptions:
<ol type="1">
<li>enabling the traps and handling the exceptions</li>
<li>disabling the traps and either handling the return values or
checking the accrued exceptions.</li>
</ol>
Of these the latter is the most portable because on the alpha port
it is not possible to enable some traps at run-time.<br>
<br></li>
<li>To assist the checking of the exceptions within the body any
accrued exceptions matching the given traps are cleared at the
start of the body when the traps are masked.<br>
<br></li>
<li>To allow the macros to be nested these accrued exceptions are
restored at the end of the body to their values at the start of the
body. Thus any exceptions that occurred within the body will not
affect the accrued exceptions outside the macro.<br>
<br></li>
<li>Note that only the given exceptions are restored at the end of
the body so other exception will be visible in the accrued
exceptions outside the body.<br>
<br></li>
<li>On the x86, setting the accrued exceptions of an unmasked
exception would cause a FP trap. The macro behaviour of restoring
the accrued exceptions ensures than if an accrued exception is
initially not flagged and occurs within the body it will be
restored/cleared at the exit of the body and thus not cause a
trap.<br>
<br></li>
<li>On the x86, and, perhaps, the hppa, the FP exceptions may be
delivered at the next FP instruction which requires a FP <tt class=
"code">wait</tt> instruction (<tt class=
"code">x86::float-wait</tt>) if using the lisp conditions to catch
trap within a <tt class="code">handler-bind</tt>. The <tt class=
"code">handler-bind</tt> macro does the right thing and inserts a
float-wait (at the end of its body on the x86). The masking and
noting of exceptions is also safe here.<br>
<br></li>
<li>The setting of the FP flags uses the <tt class=
"code">(floating-point-modes)</tt> and the <tt class="code">(set
(floating-point-modes)...)</tt> VOPs. These VOPs blindly update the
flags which may include other state. We assume this state hasn't
changed in between getting and setting the state. For example, if
you used the FP unit between the above calls, the state may be
incorrectly restored! The <tt class=
"code">with-float-traps-masked</tt> macro keeps the intervening
code to a minimum and uses only integer operations.</li>
</ul>
</blockquote>
<a name="toc14" id="toc14"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc9" id="htoc9"><b><font size=
"4">2.1.3</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Extended
Floats</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="extended-float" id="extended-float"></a><br>
CMUCL also has an extension to support <tt class=
"code">double-double-float</tt> type. This float format provides
extended precision of about 31 decimal digits, with the same
exponent range as <tt class="code">double-float</tt>. It is
completely integrated into CMUCL, and can be used just like any
other floating-point object, including arrays, complex <tt class=
"code">double-double-float</tt>'s, and special functions. With
appropriate declarations, no boxing is needed, just like <tt class=
"code">single-float</tt> and <tt class=
"code">double-float</tt>.<br>
<br>
The exponent marker for a double-double float number is ``W'', so
``1.234w0'' is a double-double float number.<br>
<br>
Note that there are a few shortcomings with <tt class=
"code">double-double-float</tt>'s:
<ul>
<li>There are no equivalents to <tt class=
"code">most-positive-double-float</tt>, <tt class=
"code">double-float-positive-infinity</tt>, <i>etc</i>. This is
because these are not really well defined for <tt class=
"code">double-double-float</tt>'s.</li>
<li>Underflow and overflow may be prematurely signaled. This is due
to how <tt class="code">double-double-float</tt>'s are
implemented.</li>
<li>Basic arithmetic operations are inlined, so the code size is
fairly large.</li>
<li><tt class="code">double-double-float</tt> arithmetic is quite a
bit slower than <tt class="code">double-float</tt> since there is
no hardware support for this type.</li>
<li>The constant <tt class="code">pi</tt> is still a <tt class=
"code">double-float</tt> instead of a <tt class=
"code">double-double-float</tt>. Use <tt class=
"code">ext:dd-pi</tt> if you want a <tt class=
"code">double-double-float</tt> value for <font face=
"symbol">p</font>.</li>
</ul>
<br>
<br>
<a name="@types8"></a>
<div align="left">[float]<br>
<tt class="function-name">extensions:double-double-float</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote>The <tt class="code">double-double-float</tt> type. It
is in the <tt class="code">EXTENSIONS</tt> package.</blockquote>
<br>
<div align="left">[Constant]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">dd-pi</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote>A <tt class="code">double-double-float</tt>
approximation to <font face="symbol">p</font>.</blockquote>
<a name="toc15" id="toc15"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc10" id="htoc10"><b><font size=
"4">2.1.4</font></b></a></td>
<td width="100%" align="center"><b><font size=
"4">Characters</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
CMUCL implements characters according to <i>Common Lisp: The
Language II</i>. The main difference from the first version is that
character bits and font have been eliminated, and the names of the
types have been changed. <a name="@types9"></a><tt class=
"code">base-character</tt> is the new equivalent of the old
<a name="@types10"></a><tt class="code">string-char</tt>. In this
implementation, all characters are base characters (there are no
extended characters.) Character codes range between <tt class=
"code">0</tt> and <tt class="code">255</tt>, using the ASCII
encoding. Table&nbsp;<a href="#tbl:chars">2.1</a>&nbsp;tbl:chars
shows characters recognized by CMUCL.
<blockquote>
<div align="center">
<hr width="80%" size="2"></div>
<div align="center">
<table border="1" cellspacing="0" cellpadding="1">
<tr>
<td align="center" nowrap colspan="2">ASCII</td>
<td align="center" nowrap>Lisp</td>
<td align="center" nowrap colspan="3">&nbsp;</td>
</tr>
<tr>
<td align="center" nowrap>Name</td>
<td align="center" nowrap>Code</td>
<td align="center" nowrap>Name</td>
<td align="center" nowrap colspan="3">1.5exAlternatives</td>
</tr>
<tr>
<td align="center" nowrap><tt class="code">nul</tt></td>
<td align="center" nowrap>0</td>
<td align="left" nowrap><tt class="code">#\NULL</tt></td>
<td align="left" nowrap><tt class="code">#\NUL</tt></td>
<td align="left" nowrap>&nbsp;</td>
<td align="left" nowrap>&nbsp;</td>
</tr>
<tr>
<td align="center" nowrap><tt class="code">bel</tt></td>
<td align="center" nowrap>7</td>
<td align="left" nowrap><tt class="code">#\BELL</tt></td>
<td align="left" nowrap>&nbsp;</td>
<td align="left" nowrap>&nbsp;</td>
<td align="left" nowrap>&nbsp;</td>
</tr>
<tr>
<td align="center" nowrap><tt class="code">bs</tt></td>
<td align="center" nowrap>8</td>
<td align="left" nowrap><tt class="code">#\BACKSPACE</tt></td>
<td align="left" nowrap><tt class="code">#\BS</tt></td>
<td align="left" nowrap>&nbsp;</td>
<td align="left" nowrap>&nbsp;</td>
</tr>
<tr>
<td align="center" nowrap><tt class="code">tab</tt></td>
<td align="center" nowrap>9</td>
<td align="left" nowrap><tt class="code">#\TAB</tt></td>
<td align="left" nowrap>&nbsp;</td>
<td align="left" nowrap>&nbsp;</td>
<td align="left" nowrap>&nbsp;</td>
</tr>
<tr>
<td align="center" nowrap><tt class="code">lf</tt></td>
<td align="center" nowrap>10</td>
<td align="left" nowrap><tt class="code">#\NEWLINE</tt></td>
<td align="left" nowrap><tt class="code">#\NL</tt></td>
<td align="left" nowrap><tt class="code">#\LINEFEED</tt></td>
<td align="left" nowrap><tt class="code">#\LF</tt></td>
</tr>
<tr>
<td align="center" nowrap><tt class="code">ff</tt></td>
<td align="center" nowrap>11</td>
<td align="left" nowrap><tt class="code">#\VT</tt></td>
<td align="left" nowrap><tt class="code">#\PAGE</tt></td>
<td align="left" nowrap><tt class="code">#\FORM</tt></td>
<td align="left" nowrap>&nbsp;</td>
</tr>
<tr>
<td align="center" nowrap><tt class="code">cr</tt></td>
<td align="center" nowrap>13</td>
<td align="left" nowrap><tt class="code">#\RETURN</tt></td>
<td align="left" nowrap><tt class="code">#\CR</tt></td>
<td align="left" nowrap>&nbsp;</td>
<td align="left" nowrap>&nbsp;</td>
</tr>
<tr>
<td align="center" nowrap><tt class="code">esc</tt></td>
<td align="center" nowrap>27</td>
<td align="left" nowrap><tt class="code">#\ESCAPE</tt></td>
<td align="left" nowrap><tt class="code">#\ESC</tt></td>
<td align="left" nowrap><tt class="code">#\ALTMODE</tt></td>
<td align="left" nowrap><tt class="code">#\ALT</tt></td>
</tr>
<tr>
<td align="center" nowrap><tt class="code">sp</tt></td>
<td align="center" nowrap>32</td>
<td align="left" nowrap><tt class="code">#\SPACE</tt></td>
<td align="left" nowrap><tt class="code">#\SP</tt></td>
<td align="left" nowrap>&nbsp;</td>
<td align="left" nowrap>&nbsp;</td>
</tr>
<tr>
<td align="center" nowrap><tt class="code">del</tt></td>
<td align="center" nowrap>127</td>
<td align="left" nowrap><tt class="code">#\DELETE</tt></td>
<td align="left" nowrap><tt class="code">#\RUBOUT</tt></td>
<td align="left" nowrap>&nbsp;</td>
<td align="left" nowrap>&nbsp;</td>
</tr>
</table>
<br>
<div align="center">Table 2.1: Characters recognized by CMUCL</div>
<br>
<a name="tbl:chars" id="tbl:chars"></a></div>
<div align="center">
<hr width="80%" size="2"></div>
</blockquote>
<a name="toc16" id="toc16"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc11" id="htoc11"><b><font size=
"4">2.1.5</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Array
Initialization</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
If no <tt class="code">:initial-value</tt> is specified, arrays are
initialized to zero.<br>
<br>
<a name="toc17" id="toc17"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc12" id="htoc12"><b><font size=
"4">2.1.6</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Hash
tables</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
The <a name="@types11"></a><tt class="code">hash-tables</tt>
defined by Common Lisp have limited utility because they are
limited to testing their keys using the equality predicates
provided by (pre-CLOS) Common Lisp. CMUCL overcomes this limitation
by allowing its users to specify new hash table tests and hashing
methods. The hashing method must also be specified, since the
compiler is unable to determine a good hashing function for an
arbitrary equality (equivalence) predicate.<br>
<br>
<br>
<a name="@funs15"></a><a name="FN:define-hash-table-test" id=
"FN:define-hash-table-test"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">define-hash-table-test</tt> <tt class=
"variable">hash-table-test-name</tt> <tt class=
"variable">test-function</tt> <tt class=
"variable">hash-function</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
The <tt class="variable">hash-table-test-name</tt> must be a
symbol. The <tt class="variable">test-function</tt> takes two
objects and returns true iff they are the same. The <tt class=
"variable">hash-function</tt> takes one object and returns two
values: the (positive fixnum) hash value and true if the hashing
depends on pointer values and will have to be redone if the object
moves.<br>
<br>
To create a hash-table using this new ``test'' (really, a
test/hash-function pair), use <tt class="code">(<a name=
"@funs16"></a>make-hash-table :test <tt class=
"variable">hash-table-test-name</tt> ...)</tt>.<br>
<br>
Note that it is the <tt class="variable">hash-table-test-name</tt>
that will be returned by the function <a name=
"@funs17"></a><tt class="code">hash-table-test</tt>, when applied
to a hash-table created using this function.<br>
<br>
This function updates <a name="@vars1"></a><tt class=
"code">*hash-table-tests*</tt>, which is now internal.</blockquote>
CMUCL also supports a number of weak hash tables. These weak tables
are created using the <tt class="code">:weak-p</tt> argument to
<tt class="code">make-hash-table</tt>. Normally, a reference to an
object as either the key or value of the hash-table will prevent
that object from being garbage-collected. However, in a weak table,
if the only reference is the hash-table, the object can be
collected.<br>
<br>
The possible values for <tt class="code">:weak-p</tt> are listed
below. An entry in the table remains if the condition holds
<dl compact="compact">
<dt><tt class="code">:key</tt><br></dt>
<dd>The key is referenced elsewhere</dd>
<dt><tt class="code">:value</tt><br></dt>
<dd>The value is referenced elsewhere</dd>
<dt><tt class="code">:key-and-value</tt><br></dt>
<dd>Both the key and value are referenced elsewhere</dd>
<dt><tt class="code">:key-or-value</tt><br></dt>
<dd>Either the key or value are referenced elsewhere</dd>
<dt>T<br></dt>
<dd>For backward compatibility, this means the same as <tt class=
"code">:key</tt>.</dd>
</dl>
If the condition does not hold, the object can be removed from the
hash table.<br>
<br>
Weak hash tables can only be created if the test is <tt class=
"code">eq</tt> or <tt class="code">eql</tt>. An error is signaled
if this is not the case.<br>
<br>
<br>
<a name="@funs18"></a><a name="FN:make-hash-table" id=
"FN:make-hash-table"></a>
<div align="left">[Function]<br>
<tt class="function-name">make-hash-table</tt> <tt class=
"code">&amp;key</tt> <tt class="code">:test</tt> <tt class=
"code">:size</tt> <tt class="code">:rehash-size</tt> <tt class=
"code">:rehash-threshold</tt> <tt class="code">:weak-p</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote>Creates a hash-table with the specified
properties.</blockquote>
<a name="toc18" id="toc18"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc13" id="htoc13"><b><font size=
"5">2.2</font></b></a></td>
<td width="100%" align="center"><b><font size="5">Default
Interrupts for Lisp</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
CMUCL has several interrupt handlers defined when it starts up, as
follows:
<dl compact="compact">
<dt><tt class="code">SIGINT</tt> (<tt class=
"code">Ctrl-c</tt>)<br></dt>
<dd>causes Lisp to enter a break loop. This puts you into the
debugger which allows you to look at the current state of the
computation. If you proceed from the break loop, the computation
will proceed from where it was interrupted.<br>
<br></dd>
<dt><tt class="code">SIGQUIT</tt> (<tt class=
"code">Ctrl-L</tt>)<br></dt>
<dd>causes Lisp to do a throw to the top-level. This causes the
current computation to be aborted, and control returned to the
top-level read-eval-print loop.<br>
<br></dd>
<dt><tt class="code">SIGTSTP</tt> (<tt class=
"code">Ctrl-z</tt>)<br></dt>
<dd>causes Lisp to suspend execution and return to the Unix shell.
If control is returned to Lisp, the computation will proceed from
where it was interrupted.<br>
<br></dd>
<dt><tt class="code">SIGILL</tt>, <tt class="code">SIGBUS</tt>,
<tt class="code">SIGSEGV</tt>, and <tt class=
"code">SIGFPE</tt><br></dt>
<dd>cause Lisp to signal an error.</dd>
</dl>
For keyboard interrupt signals, the standard interrupt character is
in parentheses. Your <tt class="filename">.login</tt> may set up
different interrupt characters. When a signal is generated, there
may be some delay before it is processed since Lisp cannot be
interrupted safely in an arbitrary place. The computation will
continue until a safe point is reached and then the interrupt will
be processed. See section&nbsp;<a href=
"unix.html#signal-handlers">6.8.1</a> to define your own signal
handlers.<br>
<br>
<a name="toc19" id="toc19"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc14" id="htoc14"><b><font size=
"5">2.3</font></b></a></td>
<td width="100%" align="center"><b><font size=
"5">Implementation-Specific Packages</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
When CMUCL is first started up, the default package is the
<tt class="code">common-lisp-user</tt> package. The <tt class=
"code">common-lisp-user</tt> package uses the <tt class=
"code">common-lisp</tt> and <tt class="code">extensions</tt>
packages. The symbols exported from these three packages can be
referenced without package qualifiers. This section describes
packages which have exported interfaces that may concern users. The
numerous internal packages which implement parts of the system are
not described here. Package nicknames are in parenthesis after the
full name.<br>
<br>
<dl compact="compact">
<dt><tt class="code">alien</tt>, <tt class=
"code">c-call</tt><br></dt>
<dd>Export the features of the Alien foreign data structure
facility (see section&nbsp;<a href="aliens.html#aliens">8</a>.)<br>
<br></dd>
<dt><tt class="code">pcl</tt><br></dt>
<dd>This package contains PCL (Portable CommonLoops), which is a
portable implementation of CLOS (the Common Lisp Object System.)
This implements most (but not all) of the features in the CLOS
chapter of <i>Common Lisp: The Language II</i>.<br>
<br></dd>
<dt><tt class="code">clos-mop (mop)</tt><br></dt>
<dd>This package contains an implementation of the CLOS Metaobject
Protocol, as per the book <i>The Art of the Metaobject
Protocol</i>.<br>
<br></dd>
<dt><tt class="code">debug</tt><br></dt>
<dd>The <tt class="code">debug</tt> package contains the
command-line oriented debugger. It exports utility various
functions and switches.<br>
<br></dd>
<dt><tt class="code">debug-internals</tt><br></dt>
<dd>The <tt class="code">debug-internals</tt> package exports the
primitives used to write debuggers. See section&nbsp;<a href=
"debug-internals.html#debug-internals">11</a>.<br>
<br></dd>
<dt><tt class="code">extensions (ext)</tt><br></dt>
<dd>The <tt class="code">extensions</tt> packages exports local
extensions to Common Lisp that are documented in this manual.
Examples include the <tt class="code">save-lisp</tt> function and
time parsing.<br>
<br></dd>
<dt><tt class="code">hemlock (ed)</tt><br></dt>
<dd>The <tt class="code">hemlock</tt> package contains all the code
to implement Hemlock commands. The <tt class="code">hemlock</tt>
package currently exports no symbols.<br>
<br></dd>
<dt><tt class="code">hemlock-internals (hi)</tt><br></dt>
<dd>The <tt class="code">hemlock-internals</tt> package contains
code that implements low level primitives and exports those symbols
used to write Hemlock commands.<br>
<br></dd>
<dt><tt class="code">keyword</tt><br></dt>
<dd>The <tt class="code">keyword</tt> package contains keywords
(e.g., <tt class="code">:start</tt>). All symbols in the <tt class=
"code">keyword</tt> package are exported and evaluate to themselves
(i.e., the value of the symbol is the symbol itself).<br>
<br></dd>
<dt><tt class="code">profile</tt><br></dt>
<dd>The <tt class="code">profile</tt> package exports a simple
run-time profiling facility (see section&nbsp;<a href=
"compiler-hint.html#profiling">5.14</a>).<br>
<br></dd>
<dt><tt class="code">common-lisp (cl)</tt><br></dt>
<dd>The <tt class="code">common-lisp</tt> package exports all the
symbols defined by <i>Common Lisp: The Language</i> and only those
symbols. Strictly portable Lisp code will depend only on the
symbols exported from the <tt class="code">common-lisp</tt>
package.<br>
<br></dd>
<dt><tt class="code">unix</tt><br></dt>
<dd>This package exports system call interfaces to Unix (see
section&nbsp;<a href="unix.html#unix-interface">6</a>).<br>
<br></dd>
<dt><tt class="code">system (sys)</tt><br></dt>
<dd>The <tt class="code">system</tt> package contains functions and
information necessary for system interfacing. This package is used
by the <tt class="code">lisp</tt> package and exports several
symbols that are necessary to interface to system code.<br>
<br></dd>
<dt><tt class="code">xlib</tt><br></dt>
<dd>The <tt class="code">xlib</tt> package contains the Common Lisp
X interface (CLX) to the X11 protocol. This is mostly Lisp code
with a couple of functions that are defined in C to connect to the
server.<br>
<br></dd>
<dt><tt class="code">wire</tt><br></dt>
<dd>The <tt class="code">wire</tt> package exports a remote
procedure call facility (see section&nbsp;<a href=
"ipc.html#remote">9</a>).<br>
<br></dd>
<dt><tt class="code">stream</tt><br></dt>
<dd>The <tt class="code">stream</tt> package exports the public
interface to the simple-streams implementation (see
section&nbsp;<a href="#simple-streams">2.13</a>).</dd>
</dl>
<a name="toc20" id="toc20"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc15" id="htoc15"><b><font size=
"5">2.4</font></b></a></td>
<td width="100%" align="center"><b><font size="5">Hierarchical
Packages</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept1"></a><br>
<a name="toc21" id="toc21"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc16" id="htoc16"><b><font size=
"4">2.4.1</font></b></a></td>
<td width="100%" align="center"><b><font size=
"4">Introduction</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
The Common Lisp package system, designed and standardized several
years ago, is not hierarchical. Since Common Lisp was standardized,
other languages, including Java and Perl, have evolved namespaces
which are hierarchical. This document describes a hierarchical
package naming scheme for Common Lisp. The scheme was proposed by
Franz Inc and implemented in their <i>Allegro Common Lisp</i>
product; a compatible implementation of the naming scheme is
implemented in CMUCL. This documentation is based on the Franz Inc.
documentation, and is included with permission.<br>
<br>
The goals of hierarchical packages in Common Lisp are:
<ul>
<li>Reduce collisions with user-defined packages: it is a
well-known problem that package names used by the Lisp
implementation and those defined by users can easily conflict. The
intent of hierarchical packages is to reduce such conflicts to a
minimum.<br>
<br></li>
<li>Improve modularity: the current organization of packages in
various implementations has grown over the years and appears
somewhat random. Organizing future packages into a hierarchy will
help make the intention of the implementation more clear.<br>
<br></li>
<li>Foster growth in Common Lisp programs, or modules, available to
the CL community: the Perl and Java communities are able to
contribute code to repositories, with minimal fear of collision,
because of the hierarchical nature of the name spaces used by the
contributed code. We want the Lisp community to benefit from shared
modules in the same way.</li>
</ul>
In a nutshell, a dot (<code>.</code>) is used to separate levels in
package names, and a leading dot signifies a relative package name.
The choice of dot follows Java. Perl, another language with
hierarchical packages, uses a colon (<code>:</code>) as a
delimiter, but the colon is already reserved in Common Lisp.
Absolute package names require no modifications to the underlying
Common Lisp implementation. Relative package names require only
small and simple modifications.<br>
<br>
<a name="toc22" id="toc22"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc17" id="htoc17"><b><font size=
"4">2.4.2</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Relative Package
Names</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
Relative package names are needed for the same reason as relative
pathnames, for brevity and to reduce the brittleness of absolute
names. A relative package name is one that begins with one or more
dots. A single dot means the current package, two dots mean the
parent of the current package, and so on.<br>
<br>
Table&nbsp;<a href="#tbl:hierarchical-packages">2.2</a> presents a
number of examples, assuming that the packages named
<code>foo</code>, <code>foo.bar</code>, <code>mypack</code>,
<code>mypack.foo</code>, <code>mypack.foo.bar</code>,
<code>mypack.foo.baz</code>, <code>mypack.bar</code>, and
<code>mypack.bar.baz</code>, have all been created.
<blockquote>
<div align="center">
<hr width="80%" size="2"></div>
<div align="center">
<table border="1" cellspacing="0" cellpadding="1">
<tr>
<td align="left" nowrap>relative name</td>
<td align="left" nowrap>current package</td>
<td align="left" nowrap>absolute name of referenced package</td>
</tr>
<tr>
<td align="left" nowrap>foo</td>
<td align="left" nowrap>any</td>
<td align="left" nowrap>foo</td>
</tr>
<tr>
<td align="left" nowrap>foo.bar</td>
<td align="left" nowrap>any</td>
<td align="left" nowrap>foo.bar</td>
</tr>
<tr>
<td align="left" nowrap>.foo</td>
<td align="left" nowrap>mypack</td>
<td align="left" nowrap>mypack.foo</td>
</tr>
<tr>
<td align="left" nowrap>.foo.bar</td>
<td align="left" nowrap>mypack</td>
<td align="left" nowrap>mypack.foo.bar</td>
</tr>
<tr>
<td align="left" nowrap>..foo</td>
<td align="left" nowrap>mypack.bar</td>
<td align="left" nowrap>mypack.foo</td>
</tr>
<tr>
<td align="left" nowrap>..foo.baz</td>
<td align="left" nowrap>mypack.bar</td>
<td align="left" nowrap>mypack.foo.baz</td>
</tr>
<tr>
<td align="left" nowrap>...foo</td>
<td align="left" nowrap>mypack.bar.baz</td>
<td align="left" nowrap>mypack.foo</td>
</tr>
<tr>
<td align="left" nowrap>.</td>
<td align="left" nowrap>mypack.bar.baz</td>
<td align="left" nowrap>mypack.bar.baz</td>
</tr>
<tr>
<td align="left" nowrap>..</td>
<td align="left" nowrap>mypack.bar.baz</td>
<td align="left" nowrap>mypack.bar</td>
</tr>
<tr>
<td align="left" nowrap>...</td>
<td align="left" nowrap>mypack.bar.baz</td>
<td align="left" nowrap>mypack</td>
</tr>
</table>
</div>
<br>
<div align="center">Table 2.2: Examples of hierarchical
packages</div>
<br>
<a name="tbl:hierarchical-packages" id=
"tbl:hierarchical-packages"></a>
<div align="center">
<hr width="80%" size="2"></div>
</blockquote>
Additional notes:
<ol type="1">
<li>All packages in the hierarchy must exist.<br>
<br></li>
<li><b>Warning about nicknames</b>: Unless you provide nicknames
for your hierarchical packages (and we recommend against doing so
because the number gets quite large), you can only use the names
supplied. You cannot mix in nicknames or alternate names.
<tt class="code">cl-user</tt> is nickname of the <tt class=
"code">common-lisp-user</tt> package. Consider the following:
<pre>
   (defpackage :cl-user.foo)
</pre>
When the current package (the value of the variable <tt class=
"code">*package*</tt>) is <tt class="code">common-lisp-user</tt>,
you might expect <code>.foo</code> to refer to
<code>cl-user.foo</code>, but it does not. It actually refers to
the non-existent package <code>common-lisp-user.foo</code>. Note
that the purpose of nicknames is to provide shorter names in place
of the longer names that are designed to be fully descriptive. The
hope is that hierarchical packages makes longer names unnecessary
and thus makes nicknames unnecessary.<br>
<br></li>
<li>Multiple dots can only appear at the beginning of a package
name. For example, <code>foo.bar..baz</code> does not mean
<code>foo.baz</code> -- it is invalid. (Of course, it is perfectly
legal to name a package <code>foo.bar..baz</code>, but <tt class=
"code">cl:find-package</tt> will not process such a name to find
<code>foo.baz</code> in the package hierarchy.)</li>
</ol>
<a name="toc23" id="toc23"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc18" id="htoc18"><b><font size=
"4">2.4.3</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Compatibility
with ANSI Common Lisp</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
The implementation of hierarchical packages modifies the <tt class=
"code">cl:find-package</tt> function, and provides certain
auxiliary functions, <tt class="code">package-parent</tt>,
<tt class="code">package-children</tt>, and <tt class=
"code">relative-package-name-to-package</tt>, as described in this
section. The function <tt class="code">defpackage</tt> itself
requires no modification.<br>
<br>
While the changes to <tt class="code">cl:find-package</tt> are
small and described below, it is an important consideration for
authors who would like their programs to run on a variety of
implementations that using hierarchical packages will work in an
implementation without the modifications discussed in this
document. We show why after describing the changes to <tt class=
"code">cl:find-package</tt>.<br>
<br>
Absolute hierarchical package names require no changes in the
underlying Common Lisp implementation.<br>
<br>
<a name="toc24" id="toc24"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFED">
<div align="center">
<table>
<tr>
<td><b>2.4.3.1</b></td>
<td width="100%" align="center"><b>Changes to</b> <tt class=
"code"><b>cl:find-package</b></tt></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
Using relative hierarchical package names requires a simple
modification of <tt class="code">cl:find-package</tt>.<br>
<br>
In ANSI Common Lisp, <tt class="code">cl:find-package</tt>, if
passed a package object, returns it; if passed a string, <tt class=
"code">cl:find-package</tt> looks for a package with that string as
its name or nickname, and returns the package if it finds one, or
returns nil if it does not; if passed a symbol, the symbol name (a
string) is extracted and <tt class="code">cl:find-package</tt>
proceeds as it does with a string.<br>
<br>
For implementing hierarchical packages, the behavior when the
argument is a package object (return it) does not change. But when
the argument is a string starting with one or more dots not
directly naming a package, <tt class="code">cl:find-package</tt>
will, instead of returning nil, check whether the string can be
resolved as naming a relative package, and if so, return the
associated absolute package object. (If the argument is a symbol,
the symbol name is extracted and <tt class=
"code">cl:find-package</tt> proceeds as it does with a string
argument.)<br>
<br>
Note that you should not use leading dots in package names when
using hierarchical packages.<br>
<br>
<a name="toc25" id="toc25"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFED">
<div align="center">
<table>
<tr>
<td><b>2.4.3.2</b></td>
<td width="100%" align="center"><b>Using Hierarchical Packages
without Modifying cl:find-package</b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
Even without the modifications to <tt class=
"code">cl:find-package</tt>, authors need not avoid using relative
package names, but the ability to reuse relative package names is
restricted. Consider for example a module <i>foo</i> which is
composed of the <code>my.foo.bar</code> and <code>my.foo.baz</code>
packages. In the code for each of the these packages there are
relative package references, <code>..bar</code> and
<code>..baz</code>.<br>
<br>
Implementations that have the new <tt class=
"code">cl:find-package</tt> would have
<code>:relative-package-names</code> on their <tt class=
"code">*features*</tt> list (this is the case of CMUCL releases
starting from 18d). Then, in the <i>foo</i> module, there would be
definitions of the <code>my.foo.bar</code> and
<code>my.foo.baz</code> packages like so:
<pre>
   (defpackage :my.foo.bar
     #-relative-package-names (:nicknames #:..bar)
     ...)

   (defpackage :my.foo.baz
     #-relative-package-names (:nicknames #:..baz)
     ...)
</pre>
Then, in a <code>#-relative-package-names</code> implementation,
the symbol <code>my.foo.bar:blam</code> would be visible from
<code>my.foo.baz</code> as <code>..bar:blam</code>, just as it
would from a <code>#+relative-package-names</code>
implementation.<br>
<br>
So, even without the implementation of the augmented <tt class=
"code">cl:find-package</tt>, one can still write Common Lisp code
that will work in both types of implementations, but
<code>..bar</code> and <code>..baz</code> are now used, so you
cannot also have <code>otherpack.foo.bar</code> and
<code>otherpack.foo.baz</code> and use <code>..bar</code> and
<code>..baz</code> as relative names. (The point of hierarchical
packages, of course, is to allow reusing relative package
names.)<br>
<br>
<br>
<br>
<a name="toc26" id="toc26"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc19" id="htoc19"><b><font size=
"5">2.5</font></b></a></td>
<td width="100%" align="center"><b><font size="5">Package
Locks</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept2"></a><br>
CMUCL provides two types of package locks, as an extension to the
ANSI Common Lisp standard. The package-lock protects a package from
changes in its structure (the set of exported symbols, its use
list, etc). The package-definition-lock protects the symbols in the
package from being redefined due to the execution of a <tt class=
"code">defun</tt>, <tt class="code">defmacro</tt>, <tt class=
"code">defstruct</tt>, <tt class="code">deftype</tt> or <tt class=
"code">defclass</tt> form.<br>
<br>
<a name="toc27" id="toc27"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc20" id="htoc20"><b><font size=
"4">2.5.1</font></b></a></td>
<td width="100%" align="center"><b><font size=
"4">Rationale</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
Package locks are an aid to program development, by helping to
detect inadvertent name collisions and function redefinitions. They
are consistent with the principle that a package ``belongs to'' its
implementor, and that noone other than the package's developer
should be making or modifying definitions on symbols in that
package. Package locks are compatible with the ANSI Common Lisp
standard, which states that the consequences of redefining
functions in the <tt class="code">COMMON-LISP</tt> package are
undefined.<br>
<br>
Violation of a package lock leads to a continuable error of type
<tt class="code">lisp::package-locked-error</tt> being signaled.
The user may choose to ignore the lock and proceed, or to abort the
computation. Two other restarts are available, one which disables
all locks on all packages, and one to disable only the package-lock
or package-definition-lock that was tripped.<br>
<br>
The following transcript illustrates the behaviour seen when
attempting to redefine a standard macro in the <tt class=
"code">COMMON-LISP</tt> package, or to redefine a function in one
of CMUCL's implementation-defined packages:
<pre>
CL-USER&gt; (defmacro 1+ (x) (* x 2))
Attempt to modify the locked package COMMON-LISP, by defining macro 1+
   [Condition of type LISP::PACKAGE-LOCKED-ERROR]

Restarts:
  0: [continue      ] Ignore the lock and continue
  1: [unlock-package] Disable the package's definition-lock then continue
  2: [unlock-all    ] Unlock all packages, then continue
  3: [abort         ] Return to Top-Level.

CL-USER&gt; (defun ext:gc () t)
Attempt to modify the locked package EXTENSIONS, by redefining function GC
   [Condition of type LISP::PACKAGE-LOCKED-ERROR]

Restarts:
  0: [continue      ] Ignore the lock and continue
  1: [unlock-package] Disable package's definition-lock, then continue
  2: [unlock-all    ] Disable all package locks, then continue
  3: [abort         ] Return to Top-Level.
</pre>
The following transcript illustrates the behaviour seen when an
attempt to modify the structure of a package is made:
<pre>
CL-USER&gt; (unexport 'load-foreign :ext)
Attempt to modify the locked package EXTENSIONS, by unexporting symbols LOAD-FOREIGN
   [Condition of type lisp::package-locked-error]

Restarts:
  0: [continue      ] Ignore the lock and continue
  1: [unlock-package] Disable package's lock then continue
  2: [unlock-all    ] Unlock all packages, then continue
  3: [abort         ] Return to Top-Level.
</pre>
The <tt class="code">COMMON-LISP</tt> package and the
CMUCL-specific implementation packages are locked on startup. Users
can lock their own packages by using the <tt class=
"code">ext:package-lock</tt> and <tt class=
"code">ext:package-definition-lock</tt> accessors.<br>
<br>
<a name="toc28" id="toc28"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc21" id="htoc21"><b><font size=
"4">2.5.2</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Disabling package
locks</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
A package's locks can be enabled or disabled by using the
<tt class="code">ext:package-lock</tt> and <tt class=
"code">ext:package-definition-lock</tt> accessors, as follows:
<blockquote class="lisp">
<pre>
   (setf (ext:package-lock (find-package "UNIX")) nil)
   (setf (ext:package-definition-lock (find-package "UNIX")) nil)
</pre></blockquote>
<br>
<a name="@funs19"></a><a name="FN:package-lock" id=
"FN:package-lock"></a>
<div align="left">[Function]<br>
<tt class="function-name">ext:</tt><tt class=
"function-name">package-lock</tt> <tt class="variable">package</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote>This function is an accessor for a package's structural
lock, which protects it against modifications to its list of
exported symbols.</blockquote>
<br>
<a name="@funs20"></a><a name="FN:package-definition-lock" id=
"FN:package-definition-lock"></a>
<div align="left">[Function]<br>
<tt class="function-name">ext:</tt><tt class=
"function-name">package-definition-lock</tt> <tt class=
"variable">package</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote>This function is an accessor for a package's
definition-lock, which protects symbols in that package from
redefinition. As well as protecting the symbol's fdefinition from
change, attempts to change the symbol's definition using <tt class=
"code">defstruct</tt>, <tt class="code">defclass</tt> or <tt class=
"code">deftype</tt> will be trapped.</blockquote>
<br>
<a name="@funs21"></a><a name="FN:without-package-locks" id=
"FN:without-package-locks"></a>
<div align="left">[Macro]<br>
<tt class="function-name">ext:</tt><tt class=
"function-name">without-package-locks</tt> <tt class=
"code">&amp;rest</tt> <tt class="variable">body</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote>This macro can be used to execute forms with all
package locks (both structure and definition locks)
disabled.</blockquote>
<br>
<a name="@funs22"></a><a name="FN:unlock-all-packages" id=
"FN:unlock-all-packages"></a>
<div align="left">[Function]<br>
<tt class="function-name">ext:</tt><tt class=
"function-name">unlock-all-packages</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote>This function disables both structure and definition
locks on all currently defined packages. Note that package locks
are reset when CMUCL is restarted, so the effect of this function
is limited to the current session.</blockquote>
<br>
<br>
<a name="toc29" id="toc29"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc22" id="htoc22"><b><font size=
"5">2.6</font></b></a></td>
<td width="100%" align="center"><b><font size="5">The
Editor</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
The <tt class="code">ed</tt> function invokes the Hemlock editor
which is described in <i>Hemlock User's Manual</i> and <i>Hemlock
Command Implementor's Manual</i>. Most users at CMU prefer to use
Hemlock's slave Common Lisp mechanism which provides an interactive
buffer for the <tt class="code">read-eval-print</tt> loop and
editor commands for evaluating and compiling text from a buffer
into the slave Common Lisp. Since the editor runs in the Common
Lisp, using slaves keeps users from trashing their editor by
developing in the same Common Lisp with Hemlock.<br>
<br>
<a name="toc30" id="toc30"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc23" id="htoc23"><b><font size=
"5">2.7</font></b></a></td>
<td width="100%" align="center"><b><font size="5">Garbage
Collection</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
CMUCL uses either a stop-and-copy garbage collector or a
generational, mostly copying garbage collector. Which collector is
available depends on the platform and the features of the platform.
The stop-and-copy GC is available on all RISC platforms. The x86
platform supports a conservative stop-and-copy collector, which is
now rarely used, and a generational conservative collector. On the
Sparc platform, both the stop-and-copy GC and the generational GC
are available, but the stop-and-copy GC is deprecated in favor of
the generational GC.<br>
<br>
The generational GC is available if <tt class=
"variable">*features*</tt> contains <tt class=
"code">:gencgc</tt>.<br>
<br>
The following functions invoke the garbage collector or control
whether automatic garbage collection is in effect:<br>
<br>
<br>
<a name="@funs23"></a><a name="FN:-" id="FN:-"></a>
<div align="left">[Function]<br>
<tt class="function-name">[</tt><tt class="function-name">-</tt> c
&nbsp;&nbsp;&nbsp;</div>
<blockquote>heney]extensions:gc<tt class="code">&amp;optional</tt>
<tt class="variable">verbose-p</tt><br>
<br>
This function runs the garbage collector. If <tt class=
"code">ext:*gc-verbose*</tt> is non-<tt class="code">nil</tt>, then
it invokes <tt class="code">ext:*gc-notify-before*</tt> before
GC'ing and <tt class="code">ext:*gc-notify-after*</tt>
afterwards.<br>
<br>
<tt class="code">verbose-p</tt> indicates whether GC statistics are
printed or not.</blockquote>
<br>
<a name="@funs24"></a><a name="FN:gc-off" id="FN:gc-off"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">gc-off</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function inhibits automatic garbage collection. After calling
it, the system will not GC unless you call <tt class=
"code">ext:gc</tt> or <tt class="code">ext:gc-on</tt>.</blockquote>
<br>
<a name="@funs25"></a><a name="FN:gc-on" id="FN:gc-on"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">gc-on</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function reinstates automatic garbage collection. If the
system would have GC'ed while automatic GC was inhibited, then this
will call <tt class="code">ext:gc</tt>.</blockquote>
<a name="toc31" id="toc31"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc24" id="htoc24"><b><font size=
"4">2.7.1</font></b></a></td>
<td width="100%" align="center"><b><font size="4">GC
Parameters</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
The following variables control the behavior of the garbage
collector:<br>
<br>
<br>
<a name="@vars2"></a><a name="VR:bytes-consed-between-gcs" id=
"VR:bytes-consed-between-gcs"></a>
<div align="left">[Variable]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">*bytes-consed-between-gcs*</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
CMUCL automatically GC's whenever the amount of memory allocated to
dynamic objects exceeds the value of an internal variable. After
each GC, the system sets this internal variable to the amount of
dynamic space in use at that point plus the value of the variable
<tt class="code">ext:*bytes-consed-between-gcs*</tt>. The default
value is 2000000.</blockquote>
<br>
<a name="@vars3"></a><a name="VR:gc-verbose" id=
"VR:gc-verbose"></a>
<div align="left">[Variable]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">*gc-verbose*</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This variable controls whether <tt class="code">ext:gc</tt> invokes
the functions in <tt class="code">ext:*gc-notify-before*</tt> and
<tt class="code">ext:*gc-notify-after*</tt>. If <tt class=
"code">*gc-verbose*</tt> is <tt class="code">nil</tt>, <tt class=
"code">ext:gc</tt> foregoes printing any messages. The default
value is <tt class="code">T</tt>.</blockquote>
<br>
<a name="@vars4"></a><a name="VR:gc-notify-before" id=
"VR:gc-notify-before"></a>
<div align="left">[Variable]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">*gc-notify-before*</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This variable's value is a function that should notify the user
that the system is about to GC. It takes one argument, the amount
of dynamic space in use before the GC measured in bytes. The
default value of this variable is a function that prints a message
similar to the following:
<pre>
   [GC threshold exceeded with 2,107,124 bytes in use.  Commencing GC.]
</pre></blockquote>
<br>
<a name="@vars5"></a><a name="VR:gc-notify-after" id=
"VR:gc-notify-after"></a>
<div align="left">[Variable]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">*gc-notify-after*</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This variable's value is a function that should notify the user
when a GC finishes. The function must take three arguments, the
amount of dynamic spaced retained by the GC, the amount of dynamic
space freed, and the new threshold which is the minimum amount of
space in use before the next GC will occur. All values are byte
quantities. The default value of this variable is a function that
prints a message similar to the following:
<pre>
    [GC completed with 25,680 bytes retained and 2,096,808 bytes freed.]
    [GC will next occur when at least 2,025,680 bytes are in use.]
  
</pre></blockquote>
Note that a garbage collection will not happen at exactly the new
threshold printed by the default <tt class=
"code">ext:*gc-notify-after*</tt> function. The system periodically
checks whether this threshold has been exceeded, and only then does
a garbage collection.<br>
<br>
<br>
<a name="@vars6"></a><a name="VR:gc-inhibit-hook" id=
"VR:gc-inhibit-hook"></a>
<div align="left">[Variable]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">*gc-inhibit-hook*</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This variable's value is either a function of one argument or
<tt class="code">nil</tt>. When the system has triggered an
automatic GC, if this variable is a function, then the system calls
the function with the amount of dynamic space currently in use
(measured in bytes). If the function returns <tt class=
"code">nil</tt>, then the GC occurs; otherwise, the system inhibits
automatic GC as if you had called <tt class="code">ext:gc-off</tt>.
The writer of this hook is responsible for knowing when automatic
GC has been turned off and for calling or providing a way to call
<tt class="code">ext:gc-on</tt>. The default value of this variable
is <tt class="code">nil</tt>.</blockquote>
<br>
<a name="@vars7"></a><a name="VR:before-gc-hooks" id=
"VR:before-gc-hooks"></a>
<div align="left">[Variable]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">*before-gc-hooks*</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
<a name="@vars8"></a><a name="VR:after-gc-hooks" id=
"VR:after-gc-hooks"></a>
<div align="left">[Variable]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">*after-gc-hooks*</tt> &nbsp;&nbsp;&nbsp;</div>
<br>
These variables' values are lists of functions to call before or
after any GC occurs. The system provides these purely for
side-effect, and the functions take no arguments.</blockquote>
<a name="toc32" id="toc32"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc25" id="htoc25"><b><font size=
"4">2.7.2</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Generational
GC</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
Generational GC also supports some additional functions and
variables to control it.<br>
<br>
<br>
<a name="@funs26"></a><a name="FN:-" id="FN:-"></a>
<div align="left">[Function]<br>
<tt class="function-name">[</tt><tt class="function-name">-</tt> g
&nbsp;&nbsp;&nbsp;</div>
<blockquote>encgc]extensions:gc<tt class="code">&amp;key</tt>
<tt class="code">:verbose</tt> <tt class="code">:gen</tt>
<tt class="code">:full</tt><br>
<br>
This function runs the garbage collector. If <tt class=
"code">ext:*gc-verbose*</tt> is non-<tt class="code">nil</tt>, then
it invokes <tt class="code">ext:*gc-notify-before*</tt> before
GC'ing and <tt class="code">ext:*gc-notify-after*</tt>
afterwards.<br>
<br>
<dl compact="compact">
<dt><tt class="code">verbose</tt><br></dt>
<dd>Print GC statistics if non-<tt class="code">NIL</tt>.</dd>
<dt><tt class="code">gen</tt><br></dt>
<dd>The number of generations to be collected.</dd>
<dt><tt class="code">full</tt><br></dt>
<dd>If non-<tt class="code">NIL</tt>, a full collection of all
generations is performed.</dd>
</dl>
</blockquote>
<br>
<a name="@funs27"></a><a name="FN:gencgc-stats" id=
"FN:gencgc-stats"></a>
<div align="left">[Function]<br>
<tt class="function-name">lisp::</tt><tt class=
"function-name">gencgc-stats</tt> <tt class=
"variable">generation</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote>Returns statistics about the generation, as multiple
values:
<ol type="1">
<li>Bytes allocated in this generation</li>
<li>The GC trigger for this generation. When this many bytes have
been allocated, a GC is started automatically.</li>
<li>The number of bytes consed between GCs.</li>
<li>The number of GCs that have been done on this generation. This
is reset to zero when the generation is raised.</li>
<li>The trigger age, which is the maximum number of GCs to perform
before this generation is raised.</li>
<li>The total number of bytes allocated to this generation.</li>
<li>Average age of the objects in this generations. The average age
is the cumulative bytes allocated divided by current number of
bytes allocated.</li>
</ol>
</blockquote>
<br>
<a name="@funs28"></a><a name="FN:set-gc-trigger" id=
"FN:set-gc-trigger"></a>
<div align="left">[Function]<br>
<tt class="function-name">lisp::</tt><tt class=
"function-name">set-gc-trigger</tt> <tt class="variable">gen</tt>
<tt class="variable">trigger</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote>Sets the GC trigger value for the specified
generation.</blockquote>
<br>
<a name="@funs29"></a><a name="FN:set-trigger-age" id=
"FN:set-trigger-age"></a>
<div align="left">[Function]<br>
<tt class="function-name">lisp::</tt><tt class=
"function-name">set-trigger-age</tt> <tt class="variable">gen</tt>
<tt class="variable">trigger-age</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote>Sets the GC trigger age for the specified
generation.</blockquote>
<br>
<a name="@funs30"></a><a name="FN:set-min-mem-age" id=
"FN:set-min-mem-age"></a>
<div align="left">[Function]<br>
<tt class="function-name">lisp::</tt><tt class=
"function-name">set-min-mem-age</tt> <tt class="variable">gen</tt>
<tt class="variable">min-mem-age</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote>Sets the minimum average memory age for the specified
generation. If the computed memory age is below this, GC is not
performed, which helps prevent a GC when a large number of new live
objects have been added in which case a GC would usually be a waste
of time.</blockquote>
<a name="toc33" id="toc33"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc26" id="htoc26"><b><font size=
"4">2.7.3</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Weak
Pointers</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
A weak pointer provides a way to maintain a reference to an object
without preventing an object from being garbage collected. If the
garbage collector discovers that the only pointers to an object are
weak pointers, then it breaks the weak pointers and deallocates the
object.<br>
<br>
<br>
<a name="@funs31"></a><a name="FN:make-weak-pointer" id=
"FN:make-weak-pointer"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">make-weak-pointer</tt> <tt class=
"variable">object</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
<a name="@funs32"></a><a name="FN:weak-pointer-value" id=
"FN:weak-pointer-value"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">weak-pointer-value</tt> <tt class=
"variable">weak-pointer</tt> &nbsp;&nbsp;&nbsp;</div>
<br>
<br>
<tt class="code">make-weak-pointer</tt> returns a weak pointer to
an object. <tt class="code">weak-pointer-value</tt> follows a weak
pointer, returning the two values: the object pointed to (or
<tt class="code">nil</tt> if broken) and a boolean value which is
<tt class="code">nil</tt> if the pointer has been broken, and true
otherwise.</blockquote>
<a name="toc34" id="toc34"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc27" id="htoc27"><b><font size=
"4">2.7.4</font></b></a></td>
<td width="100%" align="center"><b><font size=
"4">Finalization</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
Finalization provides a ``hook'' that is triggered when the garbage
collector reclaims an object. It is usually used to recover
non-Lisp resources that were allocated to implement the finalized
Lisp object. For example, when a unix file-descriptor stream is
collected, finalization is used to close the underlying file
descriptor.<br>
<br>
<br>
<a name="@funs33"></a><a name="FN:finalize" id="FN:finalize"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">finalize</tt> <tt class="variable">object</tt>
<tt class="variable">function</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function registers <tt class="variable">object</tt> for
finalization. <tt class="variable">function</tt> is called with no
arguments when <tt class="variable">object</tt> is reclaimed.
Normally <tt class="variable">function</tt> will be a closure over
the underlying state that needs to be freed, e.g. the unix file
descriptor in the fd-stream case. Note that <tt class=
"variable">function</tt> must not close over <tt class=
"variable">object</tt> itself, as this prevents the object from
ever becoming garbage.</blockquote>
<br>
<a name="@funs34"></a><a name="FN:cancel-finalization" id=
"FN:cancel-finalization"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">cancel-finalization</tt> <tt class=
"variable">object</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function cancel any finalization request for <tt class=
"variable">object</tt>.</blockquote>
<a name="toc35" id="toc35"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc28" id="htoc28"><b><font size=
"5">2.8</font></b></a></td>
<td width="100%" align="center"><b><font size=
"5">Describe</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
<br>
<a name="@funs35"></a><a name="FN:describe" id="FN:describe"></a>
<div align="left">[Function]<br>
<tt class="function-name">describe</tt> <tt class=
"variable">object</tt> &amp;optional <tt class=
"variable">stream</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
The <tt class="code">describe</tt> function prints useful
information about <tt class="variable">object</tt> on <tt class=
"variable">stream</tt>, which defaults to <tt class=
"code">*standard-output*</tt>. For any object, <tt class=
"code">describe</tt> will print out the type. Then it prints other
information based on the type of <tt class="variable">object</tt>.
The types which are presently handled are:<br>
<br>
<dl compact="compact">
<dt><a name="@types12"></a><tt class=
"code">hash-table</tt><br></dt>
<dd><tt class="code">describe</tt> prints the number of entries
currently in the hash table and the number of buckets currently
allocated.<br>
<br></dd>
<dt><a name="@types13"></a><tt class="code">function</tt><br></dt>
<dd><tt class="code">describe</tt> prints a list of the function's
name (if any) and its formal parameters. If the name has function
documentation, then it will be printed. If the function is
compiled, then the file where it is defined will be printed as
well.<br>
<br></dd>
<dt><a name="@types14"></a><tt class="code">fixnum</tt><br></dt>
<dd><tt class="code">describe</tt> prints whether the integer is
prime or not.<br>
<br></dd>
<dt><a name="@types15"></a><tt class="code">symbol</tt><br></dt>
<dd>The symbol's value, properties, and documentation are printed.
If the symbol has a function definition, then the function is
described.</dd>
</dl>
If there is anything interesting to be said about some component of
the object, describe will invoke itself recursively to describe
that object. The level of recursion is indicated by indenting
output.</blockquote>
A number of switches can be used to control <tt class=
"code">describe</tt>'s behavior.<br>
<br>
<br>
<a name="@vars9"></a><a name="VR:describe-level" id=
"VR:describe-level"></a>
<div align="left">[Variable]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">*describe-level*</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
The maximum level of recursive description allowed. Initially
two.</blockquote>
<br>
<a name="@vars10"></a><a name="VR:describe-indentation" id=
"VR:describe-indentation"></a>
<div align="left">[Variable]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">*describe-indentation*</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
The number of spaces to indent for each level of recursive
description, initially three.</blockquote>
<br>
<a name="@vars11"></a><a name="VR:describe-print-level" id=
"VR:describe-print-level"></a>
<div align="left">[Variable]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">*describe-print-level*</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
<a name="@vars12"></a><a name="VR:describe-print-length" id=
"VR:describe-print-length"></a>
<div align="left">[Variable]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">*describe-print-length*</tt>
&nbsp;&nbsp;&nbsp;</div>
<br>
The values of <tt class="code">*print-level*</tt> and <tt class=
"code">*print-length*</tt> during description. Initially two and
five.</blockquote>
<a name="toc36" id="toc36"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc29" id="htoc29"><b><font size=
"5">2.9</font></b></a></td>
<td width="100%" align="center"><b><font size="5">The
Inspector</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
CMUCL has both a graphical inspector that uses the X Window System,
and a simple terminal-based inspector.<br>
<br>
<br>
<a name="@funs36"></a><a name="FN:inspect" id="FN:inspect"></a>
<div align="left">[Function]<br>
<tt class="function-name">inspect</tt> <tt class=
"code">&amp;optional</tt> <tt class="variable">object</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
<br>
<tt class="code">inspect</tt> calls the inspector on the optional
argument <tt class="variable">object</tt>. If <tt class=
"variable">object</tt> is unsupplied, <tt class="code">inspect</tt>
immediately returns <tt class="code">nil</tt>. Otherwise, the
behavior of inspect depends on whether Lisp is running under X.
When <tt class="code">inspect</tt> is eventually exited, it returns
some selected Lisp object.</blockquote>
<a name="toc37" id="toc37"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc30" id="htoc30"><b><font size=
"4">2.9.1</font></b></a></td>
<td width="100%" align="center"><b><font size="4">The Graphical
Interface</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="motif-interface" id="motif-interface"></a><br>
CMUCL has an interface to Motif which is functionally similar to
CLM, but works better in CMUCL. This interface is documented in
separate manuals <i>CMUCL Motif Toolkit</i> and <i>Design Notes on
the Motif Toolkit</i>, which are distributed with CMUCL.<br>
<br>
This motif interface has been used to write the inspector and
graphical debugger. There is also a Lisp control panel with a
simple file management facility, apropos and inspector dialogs, and
controls for setting global options. See the <tt class=
"code">interface</tt> and <tt class="code">toolkit</tt>
packages.<br>
<br>
<br>
<a name="@funs37"></a><a name="FN:lisp-control-panel" id=
"FN:lisp-control-panel"></a>
<div align="left">[Function]<br>
<tt class="function-name">interface:</tt><tt class=
"function-name">lisp-control-panel</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function creates a control panel for the Lisp
process.</blockquote>
<br>
<a name="@vars13"></a><a name="VR:interface-style" id=
"VR:interface-style"></a>
<div align="left">[Variable]<br>
<tt class="function-name">interface:</tt><tt class=
"function-name">*interface-style*</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
When the graphical interface is loaded, this variable controls
whether it is used by <tt class="code">inspect</tt> and the error
system. If the value is <tt class="code">:graphics</tt> (the
default) and the <tt class="code">DISPLAY</tt> environment variable
is defined, the graphical inspector and debugger will be invoked by
<a name="@funs38"></a><tt class="code">inspect</tt> or when an
error is signalled. Possible values are <tt class=
"code">:graphics</tt> and tty. If the value is <tt class=
"code">:graphics</tt>, but there is no X display, then we quietly
use the TTY interface.</blockquote>
<a name="toc38" id="toc38"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc31" id="htoc31"><b><font size=
"4">2.9.2</font></b></a></td>
<td width="100%" align="center"><b><font size="4">The TTY
Inspector</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
If X is unavailable, a terminal inspector is invoked. The TTY
inspector is a crude interface to <tt class="code">describe</tt>
which allows objects to be traversed and maintains a history. This
inspector prints information about and object and a numbered list
of the components of the object. The command-line based interface
is a normal <tt class="code">read</tt>--<tt class=
"code">eval</tt>--<tt class="code">print</tt> loop, but an integer
<tt class="variable">n</tt> descends into the <tt class=
"variable">n</tt>'th component of the current object, and symbols
with these special names are interpreted as commands:<br>
<br>
<dl compact="compact">
<dt>U<br></dt>
<dd>Move back to the enclosing object. As you descend into the
components of an object, a stack of all the objects previously seen
is kept. This command pops you up one level of this stack.<br>
<br></dd>
<dt>Q, E<br></dt>
<dd>Return the current object from <tt class=
"code">inspect</tt>.<br>
<br></dd>
<dt>R<br></dt>
<dd>Recompute object display, and print again. Useful if the object
may have changed.<br>
<br></dd>
<dt>D<br></dt>
<dd>Display again without recomputing.<br>
<br></dd>
<dt>H, ?<br></dt>
<dd>Show help message.</dd>
</dl>
<a name="toc39" id="toc39"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc32" id="htoc32"><b><font size=
"5">2.10</font></b></a></td>
<td width="100%" align="center"><b><font size=
"5">Load</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
<br>
<a name="@funs39"></a><a name="FN:load" id="FN:load"></a>
<div align="left">[Function]<br>
<tt class="function-name">load</tt> <tt class=
"variable">filename</tt> <tt class="code">&amp;key</tt> <tt class=
"code">:verbose</tt> <tt class="code">:print</tt> <tt class=
"code">:if-does-not-exist</tt><br>
<tt class="code">:if-source-newer</tt> <tt class=
"code">:contents</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
As in standard Common Lisp, this function loads a file containing
source or object code into the running Lisp. Several CMU extensions
have been made to <tt class="code">load</tt> to conveniently
support a variety of program file organizations. <tt class=
"variable">filename</tt> may be a wildcard pathname such as
<tt class="filename">*.lisp</tt>, in which case all matching files
are loaded.<br>
<br>
If <tt class="variable">filename</tt> has a <tt class=
"code">pathname-type</tt> (or extension), then that exact file is
loaded. If the file has no extension, then this tells <tt class=
"code">load</tt> to use a heuristic to load the ``right'' file. The
<tt class="code">*load-source-types*</tt> and <tt class=
"code">*load-object-types*</tt> variables below are used to
determine the default source and object file types. If only the
source or the object file exists (but not both), then that file is
quietly loaded. Similarly, if both the source and object file
exist, and the object file is newer than the source file, then the
object file is loaded. The value of the <tt class=
"variable">if-source-newer</tt> argument is used to determine what
action to take when both the source and object files exist, but the
object file is out of date:
<dl compact="compact">
<dt><tt class="code">:load-object</tt><br></dt>
<dd>The object file is loaded even though the source file is
newer.<br>
<br></dd>
<dt><tt class="code">:load-source</tt><br></dt>
<dd>The source file is loaded instead of the older object file.<br>
<br></dd>
<dt><tt class="code">:compile</tt><br></dt>
<dd>The source file is compiled and then the new object file is
loaded.<br>
<br></dd>
<dt><tt class="code">:query</tt><br></dt>
<dd>The user is asked a yes or no question to determine whether the
source or object file is loaded.</dd>
</dl>
This argument defaults to the value of <tt class=
"code">ext:*load-if-source-newer*</tt> (initially <tt class=
"code">:load-object</tt>.)<br>
<br>
The <tt class="variable">contents</tt> argument can be used to
override the heuristic (based on the file extension) that normally
determines whether to load the file as a source file or an object
file. If non-null, this argument must be either <tt class=
"code">:source</tt> or <tt class="code">:binary</tt>, which forces
loading in source and binary mode, respectively. You really
shouldn't ever need to use this argument.</blockquote>
<br>
<a name="@vars14"></a><a name="VR:load-source-types" id=
"VR:load-source-types"></a>
<div align="left">[Variable]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">*load-source-types*</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
<a name="@vars15"></a><a name="VR:load-object-types" id=
"VR:load-object-types"></a>
<div align="left">[Variable]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">*load-object-types*</tt> &nbsp;&nbsp;&nbsp;</div>
<br>
These variables are lists of possible <tt class=
"code">pathname-type</tt> values for source and object files to be
passed to <tt class="code">load</tt>. These variables are only used
when the file passed to <tt class="code">load</tt> has no type; in
this case, the possible source and object types are used to default
the type in order to determine the names of the source and object
files.</blockquote>
<br>
<a name="@vars16"></a><a name="VR:load-if-source-newer" id=
"VR:load-if-source-newer"></a>
<div align="left">[Variable]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">*load-if-source-newer*</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This variable determines the default value of the <tt class=
"variable">if-source-newer</tt> argument to <tt class=
"code">load</tt>. Its initial value is <tt class=
"code">:load-object</tt>.</blockquote>
<a name="toc40" id="toc40"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc33" id="htoc33"><b><font size=
"5">2.11</font></b></a></td>
<td width="100%" align="center"><b><font size="5">The
Reader</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
<a name="toc41" id="toc41"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc34" id="htoc34"><b><font size=
"4">2.11.1</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Reader
Extensions</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
CMUCL supports an ANSI-compatible extension to enable reading of
specialized arrays. Thus
<blockquote class="example">
<pre>
  * (setf *print-readably* nil)
  NIL
  * (make-array '(2 2) :element-type '(signed-byte 8))
  #2A((0 0) (0 0))
  * (setf *print-readably* t)
  T
  * (make-array '(2 2) :element-type '(signed-byte 8))
  #A((SIGNED-BYTE 8) (2 2) ((0 0) (0 0)))
  * (type-of (read-from-string "#A((SIGNED-BYTE 8) (2 2) ((0 0) (0 0)))"))
  (SIMPLE-ARRAY (SIGNED-BYTE 8) (2 2))
  * (setf *print-readably* nil)
  NIL
  * (type-of (read-from-string "#A((SIGNED-BYTE 8) (2 2) ((0 0) (0 0)))"))
  (SIMPLE-ARRAY (SIGNED-BYTE 8) (2 2))
</pre></blockquote>
<a name="toc42" id="toc42"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc35" id="htoc35"><b><font size=
"4">2.11.2</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Reader
Parameters</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
<br>
<a name="@vars17"></a><a name="VR:ignore-extra-close-parentheses"
id="VR:ignore-extra-close-parentheses"></a>
<div align="left">[Variable]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">*ignore-extra-close-parentheses*</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
If this variable is <tt class="code">t</tt> (the default), then the
reader merely prints a warning when an extra close parenthesis is
detected (instead of signalling an error.)</blockquote>
<a name="toc43" id="toc43"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc36" id="htoc36"><b><font size=
"5">2.12</font></b></a></td>
<td width="100%" align="center"><b><font size="5">Stream
Extensions</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
<br>
<a name="@funs40"></a><a name="FN:read-n-bytes" id=
"FN:read-n-bytes"></a>
<div align="left">[Function]<br>
<tt class="function-name">sys:</tt><tt class=
"function-name">read-n-bytes</tt> <tt class="variable">stream
buffer start numbytes</tt> <tt class="code">&amp;optional</tt>
<tt class="variable">eof-error-p</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
On streams that support it, this function reads multiple bytes of
data into a buffer. The buffer must be a <tt class=
"code">simple-string</tt> or <tt class="code">(simple-array
(unsigned-byte 8) (*))</tt>. The argument <tt class=
"variable">nbytes</tt> specifies the desired number of bytes, and
the return value is the number of bytes actually read.
<ul>
<li>If <tt class="variable">eof-error-p</tt> is true, an <a name=
"@types16"></a><tt class="code">end-of-file</tt> condition is
signalled if end-of-file is encountered before <tt class=
"variable">count</tt> bytes have been read.<br>
<br></li>
<li>If <tt class="variable">eof-error-p</tt> is false, <tt class=
"code">read-n-bytes reads</tt> as much data is currently available
(up to count bytes.) On pipes or similar devices, this function
returns as soon as any data is available, even if the amount read
is less than <tt class="variable">count</tt> and eof has not been
hit. See also <a name="@funs41"></a><tt class=
"code">make-fd-stream</tt>.</li>
</ul>
</blockquote>
<a name="toc44" id="toc44"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc37" id="htoc37"><b><font size=
"5">2.13</font></b></a></td>
<td width="100%" align="center"><b><font size="5">Simple
Streams</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept3"></a> <a name="simple-streams" id=
"simple-streams"></a><br>
CMUCL includes a partial implementation of <em>Simple Streams</em>,
a protocol that allows user-extensible streams<sup><a name="text1"
href="#note1" id="text1"><font size="2">1</font></a></sup>. The
protocol was proposed by Franz, Inc. and is intended to replace the
<em>Gray Streams</em> method of extending streams. Simple streams
are distributed as a CMUCL subsystem, that can be loaded into the
image by saying
<blockquote class="lisp">
<pre>
   (require :simple-streams)
</pre></blockquote>
Note that CMUCL's implementation of simple streams is incomplete,
and in particular is currently missing support for the functions
<tt class="code">read-sequence</tt> and <tt class=
"code">write-sequence</tt>. Please consult the <i>Allegro Common
Lisp</i> documentation for more information on simple streams.<br>
<br>
<br>
<br>
<a name="toc45" id="toc45"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc38" id="htoc38"><b><font size=
"5">2.14</font></b></a></td>
<td width="100%" align="center"><b><font size="5">Running Programs
from Lisp</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
It is possible to run programs from Lisp by using the following
function.<br>
<br>
<br>
<a name="@funs42"></a><a name="FN:run-program" id=
"FN:run-program"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">run-program</tt> <tt class="variable">program</tt>
<tt class="variable">args</tt> <tt class="code">&amp;key</tt>
<tt class="code">:env</tt> <tt class="code">:wait</tt> <tt class=
"code">:pty</tt> <tt class="code">:input</tt><br>
<tt class="code">:if-input-does-not-exist</tt><br>
<tt class="code">:output</tt> <tt class=
"code">:if-output-exists</tt><br>
<tt class="code">:error</tt> <tt class=
"code">:if-error-exists</tt><br>
<tt class="code">:status-hook</tt> <tt class=
"code">:before-execve</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
<br>
<tt class="code">run-program</tt> runs <tt class=
"variable">program</tt> in a child process. <tt class=
"variable">Program</tt> should be a pathname or string naming the
program. <tt class="variable">Args</tt> should be a list of strings
which this passes to <tt class="variable">program</tt> as normal
Unix parameters. For no arguments, specify <tt class=
"variable">args</tt> as <tt class="code">nil</tt>. The value
returned is either a process structure or <tt class=
"code">nil</tt>. The process interface follows the description of
<tt class="code">run-program</tt>. If <tt class=
"code">run-program</tt> fails to fork the child process, it returns
<tt class="code">nil</tt>.<br>
<br>
Except for sharing file descriptors as explained in keyword
argument descriptions, <tt class="code">run-program</tt> closes all
file descriptors in the child process before running the program.
When you are done using a process, call <tt class=
"code">process-close</tt> to reclaim system resources. You only
need to do this when you supply <tt class="code">:stream</tt> for
one of <tt class="code">:input</tt>, <tt class="code">:output</tt>,
or <tt class="code">:error</tt>, or you supply <tt class=
"code">:pty</tt> non-<tt class="code">nil</tt>. You can call
<tt class="code">process-close</tt> regardless of whether you must
to reclaim resources without penalty if you feel safer.<br>
<br>
<tt class="code">run-program</tt> accepts the following keyword
arguments:<br>
<br>
<dl compact="compact">
<dt><tt class="code">:env</tt><br></dt>
<dd>This is an a-list mapping keywords and simple-strings. The
default is <tt class="code">ext:*environment-list*</tt>. If
<tt class="code">:env</tt> is specified, <tt class=
"code">run-program</tt> uses the value given and does not combine
the environment passed to Lisp with the one specified.<br>
<br></dd>
<dt><tt class="code">:wait</tt><br></dt>
<dd>If non-<tt class="code">nil</tt> (the default), wait until the
child process terminates. If <tt class="code">nil</tt>, continue
running Lisp while the child process runs.<br>
<br></dd>
<dt><tt class="code">:pty</tt><br></dt>
<dd>This should be one of <tt class="code">t</tt>, <tt class=
"code">nil</tt>, or a stream. If specified non-<tt class=
"code">nil</tt>, the subprocess executes under a Unix PTY. If
specified as a stream, the system collects all output to this pty
and writes it to this stream. If specified as <tt class=
"code">t</tt>, the <tt class="code">process-pty</tt> slot contains
a stream from which you can read the program's output and to which
you can write input for the program. The default is <tt class=
"code">nil</tt>.<br>
<br></dd>
<dt><tt class="code">:input</tt><br></dt>
<dd>This specifies how the program gets its input. If specified as
a string, it is the name of a file that contains input for the
child process. <tt class="code">run-program</tt> opens the file as
standard input. If specified as <tt class="code">nil</tt> (the
default), then standard input is the file <tt class=
"filename">/dev/null</tt>. If specified as <tt class="code">t</tt>,
the program uses the current standard input. This may cause some
confusion if <tt class="code">:wait</tt> is <tt class=
"code">nil</tt> since two processes may use the terminal at the
same time. If specified as <tt class="code">:stream</tt>, then the
<tt class="code">process-input</tt> slot contains an output stream.
Anything written to this stream goes to the program as input.
<tt class="code">:input</tt> may also be an input stream that
already contains all the input for the process. In this case
<tt class="code">run-program</tt> reads all the input from this
stream before returning, so this cannot be used to interact with
the process.<br>
<br></dd>
<dt><tt class="code">:if-input-does-not-exist</tt><br></dt>
<dd>This specifies what to do if the input file does not exist. The
following values are valid: <tt class="code">nil</tt> (the default)
causes <tt class="code">run-program</tt> to return <tt class=
"code">nil</tt> without doing anything; <tt class=
"code">:create</tt> creates the named file; and <tt class=
"code">:error</tt> signals an error.<br>
<br></dd>
<dt><tt class="code">:output</tt><br></dt>
<dd>This specifies what happens with the program's output. If
specified as a pathname, it is the name of a file that contains
output the program writes to its standard output. If specified as
<tt class="code">nil</tt> (the default), all output goes to
<tt class="filename">/dev/null</tt>. If specified as <tt class=
"code">t</tt>, the program writes to the Lisp process's standard
output. This may cause confusion if <tt class="code">:wait</tt> is
<tt class="code">nil</tt> since two processes may write to the
terminal at the same time. If specified as <tt class=
"code">:stream</tt>, then the <tt class="code">process-output</tt>
slot contains an input stream from which you can read the program's
output.<br>
<br></dd>
<dt><tt class="code">:if-output-exists</tt><br></dt>
<dd>This specifies what to do if the output file already exists.
The following values are valid: <tt class="code">nil</tt> causes
<tt class="code">run-program</tt> to return <tt class=
"code">nil</tt> without doing anything; <tt class=
"code">:error</tt> (the default) signals an error; <tt class=
"code">:supersede</tt> overwrites the current file; and <tt class=
"code">:append</tt> appends all output to the file.<br>
<br></dd>
<dt><tt class="code">:error</tt><br></dt>
<dd>This is similar to <tt class="code">:output</tt>, except the
file becomes the program's standard error. Additionally, <tt class=
"code">:error</tt> can be <tt class="code">:output</tt> in which
case the program's error output is routed to the same place
specified for <tt class="code">:output</tt>. If specified as
<tt class="code">:stream</tt>, the <tt class=
"code">process-error</tt> contains a stream similar to the
<tt class="code">process-output</tt> slot when specifying the
<tt class="code">:output</tt> argument.<br>
<br></dd>
<dt><tt class="code">:if-error-exists</tt><br></dt>
<dd>This specifies what to do if the error output file already
exists. It accepts the same values as <tt class=
"code">:if-output-exists</tt>.<br>
<br></dd>
<dt><tt class="code">:status-hook</tt><br></dt>
<dd>This specifies a function to call whenever the process changes
status. This is especially useful when specifying <tt class=
"code">:wait</tt> as <tt class="code">nil</tt>. The function takes
the process as a required argument.<br>
<br></dd>
<dt><tt class="code">:before-execve</tt><br></dt>
<dd>This specifies a function to run in the child process before it
becomes the program to run. This is useful for actions such as
authenticating the child process without modifying the parent Lisp
process.</dd>
</dl>
</blockquote>
<a name="toc46" id="toc46"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc39" id="htoc39"><b><font size=
"4">2.14.1</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Process
Accessors</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
The following functions interface the process returned by
<tt class="code">run-program</tt>:<br>
<br>
<br>
<a name="@funs43"></a><a name="FN:process-p" id="FN:process-p"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">process-p</tt> <tt class="variable">thing</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function returns <tt class="code">t</tt> if <tt class=
"variable">thing</tt> is a process. Otherwise it returns <tt class=
"code">nil</tt></blockquote>
<br>
<a name="@funs44"></a><a name="FN:process-pid" id=
"FN:process-pid"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">process-pid</tt> <tt class="variable">process</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function returns the process ID, an integer, for the
<tt class="variable">process</tt>.</blockquote>
<br>
<a name="@funs45"></a><a name="FN:process-status" id=
"FN:process-status"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">process-status</tt> <tt class=
"variable">process</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function returns the current status of <tt class=
"variable">process</tt>, which is one of <tt class=
"code">:running</tt>, <tt class="code">:stopped</tt>, <tt class=
"code">:exited</tt>, or <tt class=
"code">:signaled</tt>.</blockquote>
<br>
<a name="@funs46"></a><a name="FN:process-exit-code" id=
"FN:process-exit-code"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">process-exit-code</tt> <tt class=
"variable">process</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function returns either the exit code for <tt class=
"variable">process</tt>, if it is <tt class="code">:exited</tt>, or
the termination signal <tt class="variable">process</tt> if it is
<tt class="code">:signaled</tt>. The result is undefined for
processes that are still alive.</blockquote>
<br>
<a name="@funs47"></a><a name="FN:process-core-dumped" id=
"FN:process-core-dumped"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">process-core-dumped</tt> <tt class=
"variable">process</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function returns <tt class="code">t</tt> if someone used a
Unix signal to terminate the <tt class="variable">process</tt> and
caused it to dump a Unix core image.</blockquote>
<br>
<a name="@funs48"></a><a name="FN:process-pty" id=
"FN:process-pty"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">process-pty</tt> <tt class="variable">process</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function returns either the two-way stream connected to
<tt class="variable">process</tt>'s Unix PTY connection or
<tt class="code">nil</tt> if there is none.</blockquote>
<br>
<a name="@funs49"></a><a name="FN:process-input" id=
"FN:process-input"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">process-input</tt> <tt class=
"variable">process</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
<a name="@funs50"></a><a name="FN:process-output" id=
"FN:process-output"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">process-output</tt> <tt class=
"variable">process</tt> &nbsp;&nbsp;&nbsp;</div>
<br>
<a name="@funs51"></a><a name="FN:process-error" id=
"FN:process-error"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">process-error</tt> <tt class=
"variable">process</tt> &nbsp;&nbsp;&nbsp;</div>
<br>
If the corresponding stream was created, these functions return the
input, output or error fd-stream. <tt class="code">nil</tt> is
returned if there is no stream.</blockquote>
<br>
<a name="@funs52"></a><a name="FN:process-status-hook" id=
"FN:process-status-hook"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">process-status-hook</tt> <tt class=
"variable">process</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function returns the current function to call whenever
<tt class="variable">process</tt>'s status changes. This function
takes the <tt class="variable">process</tt> as a required argument.
<tt class="code">process-status-hook</tt> is <tt class=
"code">setf</tt>'able.</blockquote>
<br>
<a name="@funs53"></a><a name="FN:process-plist" id=
"FN:process-plist"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">process-plist</tt> <tt class=
"variable">process</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function returns annotations supplied by users, and it is
<tt class="code">setf</tt>'able. This is available solely for users
to associate information with <tt class="variable">process</tt>
without having to build a-lists or hash tables of process
structures.</blockquote>
<br>
<a name="@funs54"></a><a name="FN:process-wait" id=
"FN:process-wait"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">process-wait</tt> <tt class="variable">process</tt>
<tt class="code">&amp;optional</tt> <tt class=
"variable">check-for-stopped</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function waits for <tt class="variable">process</tt> to
finish. If <tt class="variable">check-for-stopped</tt> is
non-<tt class="code">nil</tt>, this also returns when <tt class=
"variable">process</tt> stops.</blockquote>
<br>
<a name="@funs55"></a><a name="FN:process-kill" id=
"FN:process-kill"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">process-kill</tt> <tt class="variable">process</tt>
<tt class="variable">signal</tt> <tt class=
"code">&amp;optional</tt> <tt class="variable">whom</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function sends the Unix <tt class="variable">signal</tt> to
<tt class="variable">process</tt>. <tt class="variable">Signal</tt>
should be the number of the signal or a keyword with the Unix name
(for example, <tt class="code">:sigsegv</tt>). <tt class=
"variable">Whom</tt> should be one of the following:
<dl compact="compact">
<dt><tt class="code">:pid</tt><br></dt>
<dd>This is the default, and it indicates sending the signal to
<tt class="variable">process</tt> only.<br>
<br></dd>
<dt><tt class="code">:process-group</tt><br></dt>
<dd>This indicates sending the signal to <tt class=
"variable">process</tt>'s group.<br>
<br></dd>
<dt><tt class="code">:pty-process-group</tt><br></dt>
<dd>This indicates sending the signal to the process group
currently in the foreground on the Unix PTY connected to <tt class=
"variable">process</tt>. This last option is useful if the running
program is a shell, and you wish to signal the program running
under the shell, not the shell itself. If <tt class=
"code">process-pty</tt> of <tt class="variable">process</tt> is
<tt class="code">nil</tt>, using this option is an error.</dd>
</dl>
</blockquote>
<br>
<a name="@funs56"></a><a name="FN:process-alive-p" id=
"FN:process-alive-p"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">process-alive-p</tt> <tt class=
"variable">process</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function returns <tt class="code">t</tt> if <tt class=
"variable">process</tt>'s status is either <tt class=
"code">:running</tt> or <tt class=
"code">:stopped</tt>.</blockquote>
<br>
<a name="@funs57"></a><a name="FN:process-close" id=
"FN:process-close"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">process-close</tt> <tt class=
"variable">process</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function closes all the streams associated with <tt class=
"variable">process</tt>. When you are done using a process, call
this to reclaim system resources.</blockquote>
<a name="toc47" id="toc47"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc40" id="htoc40"><b><font size=
"5">2.15</font></b></a></td>
<td width="100%" align="center"><b><font size="5">Saving a Core
Image</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
A mechanism has been provided to save a running Lisp core image and
to later restore it. This is convenient if you don't want to load
several files into a Lisp when you first start it up. The main
problem is the large size of each saved Lisp image, typically at
least 20 megabytes.<br>
<br>
<br>
<a name="@funs58"></a><a name="FN:save-lisp" id="FN:save-lisp"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">save-lisp</tt> <tt class="variable">file</tt>
<tt class="code">&amp;key</tt> <tt class="code">:purify</tt>
<tt class="code">:root-structures</tt> <tt class=
"code">:init-function</tt><br>
<tt class="code">:load-init-file</tt> <tt class=
"code">:print-herald</tt> <tt class="code">:site-init</tt><br>
<tt class="code">:process-command-line</tt> <tt class=
"code">:batch-mode</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
The <tt class="code">save-lisp</tt> function saves the state of the
currently running Lisp core image in <tt class=
"variable">file</tt>. The keyword arguments have the following
meaning:
<dl compact="compact">
<dt><tt class="code">:purify</tt><br></dt>
<dd>If non-<tt class="code">nil</tt> (the default), the core image
is purified before it is saved (see <a name=
"@funs59"></a><tt class="code">purify</tt>.) This reduces the
amount of work the garbage collector must do when the resulting
core image is being run. Also, if more than one Lisp is running on
the same machine, this maximizes the amount of memory that can be
shared between the two processes.<br>
<br></dd>
<dt><tt class="code">:root-structures</tt><br></dt>
<dd>This should be a list of the main entry points in any newly
loaded systems. This need not be supplied, but locality and/or GC
performance will be better if they are. Meaningless if <tt class=
"code">:purify</tt> is <tt class="code">nil</tt>. See <a name=
"@funs60"></a><tt class="code">purify</tt>.<br>
<br></dd>
<dt><tt class="code">:init-function</tt><br></dt>
<dd>This is the function that starts running when the created core
file is resumed. The default function simply invokes the top level
read-eval-print loop. If the function returns the lisp will
exit.<br>
<br></dd>
<dt><tt class="code">:load-init-file</tt><br></dt>
<dd>If non-NIL, then load an init file; either the one specified on
the command line or ``<tt class="filename">init.</tt><tt class=
"variable">fasl-type</tt>'', or, if ``<tt class=
"filename">init.</tt><tt class="variable">fasl-type</tt>'' does not
exist, <tt class="code">init.lisp</tt> from the user's home
directory. If the init file is found, it is loaded into the resumed
core file before the read-eval-print loop is entered.<br>
<br></dd>
<dt><tt class="code">:site-init</tt><br></dt>
<dd>If non-NIL, the name of the site init file to quietly load. The
default is <tt class="filename">library:site-init</tt>. No error is
signalled if the file does not exist.<br>
<br></dd>
<dt><tt class="code">:print-herald</tt><br></dt>
<dd>If non-NIL (the default), then print out the standard Lisp
herald when starting.<br>
<br></dd>
<dt><tt class="code">:process-command-line</tt><br></dt>
<dd>If non-NIL (the default), processes the command line switches
and performs the appropriate actions.<br>
<br></dd>
<dt><tt class="code">:batch-mode</tt><br></dt>
<dd>If NIL (the default), then the presence of the -batch
command-line switch will invoke batch-mode processing upon resuming
the saved core. If non-NIL, the produced core will always be in
batch-mode, regardless of any command-line switches.<br>
<br></dd>
<dt><tt class="code">:executable</tt><br></dt>
<dd>If non-NIL, an executable image is created. Normally, CMUCL
consists of the C runtime along with a core file image. When
<tt class="code">:executable</tt> is non-NIL, the core file is
incorporated into the C runtime, so one (large) executable is
created instead of a new separate core file.<br>
<br>
This feature is only available on some platforms. Currently only
x86 on Linux and FreeBSD support this.</dd>
</dl>
</blockquote>
To resume a saved file, type:
<blockquote class="example">
<pre>
lisp -core file
</pre></blockquote>
<br>
<a name="@funs61"></a><a name="FN:purify" id="FN:purify"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">purify</tt> <tt class="variable">file</tt>
<tt class="code">&amp;key</tt> <tt class=
"code">:root-structures</tt> <tt class=
"code">:environment-name</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function optimizes garbage collection by moving all currently
live objects into non-collected storage. Once statically allocated,
the objects can never be reclaimed, even if all pointers to them
are dropped. This function should generally be called after a large
system has been loaded and initialized.<br>
<br>
<dl compact="compact">
<dt><tt class="code">:root-structures</tt><br></dt>
<dd>is an optional list of objects which should be copied first to
maximize locality. This should be a list of the main entry points
for the resulting core image. The purification process tries to
localize symbols, functions, etc., in the core image so that paging
performance is improved. The default value is NIL which means that
Lisp objects will still be localized but probably not as optimally
as they could be.<br>
<br>
<tt class="variable">defstruct</tt> structures defined with the
<tt class="code">(:pure t)</tt> option are moved into read-only
storage, further reducing GC cost. List and vector slots of pure
structures are also moved into read-only storage.<br>
<br></dd>
<dt><tt class="code">:environment-name</tt><br></dt>
<dd>is gratuitous documentation for the compacted version of the
current global environment (as seen in <tt class=
"code">c::*info-environment*</tt>.) If <tt class="code">nil</tt> is
supplied, then environment compaction is inhibited.</dd>
</dl>
</blockquote>
<a name="toc48" id="toc48"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc41" id="htoc41"><b><font size=
"5">2.16</font></b></a></td>
<td width="100%" align="center"><b><font size=
"5">Pathnames</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
In Common Lisp quite a few aspects of <a name=
"@types17"></a><tt class="code">pathname</tt> semantics are left to
the implementation.<br>
<br>
<a name="toc49" id="toc49"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc42" id="htoc42"><b><font size=
"4">2.16.1</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Unix
Pathnames</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept4"></a><br>
Unix pathnames are always parsed with a <tt class=
"code">unix-host</tt> object as the host and <tt class=
"code">nil</tt> as the device. The last two dots (<tt class=
"code">.</tt>) in the namestring mark the type and version, however
if the first character is a dot, it is considered part of the name.
If the last character is a dot, then the pathname has the
empty-string as its type. The type defaults to <tt class=
"code">nil</tt> and the version defaults to <tt class=
"code">:newest</tt>.
<blockquote class="example">
<pre>
(defun parse (x)
  (values (pathname-name x) (pathname-type x) (pathname-version x)))

(parse "foo") ==&gt; "foo", NIL, :NEWEST
(parse "foo.bar") ==&gt; "foo", "bar", :NEWEST
(parse ".foo") ==&gt; ".foo", NIL, :NEWEST
(parse ".foo.bar") ==&gt; ".foo", "bar", :NEWEST
(parse "..") ==&gt; ".", "", :NEWEST
(parse "foo.") ==&gt; "foo", "", :NEWEST
(parse "foo.bar.1") ==&gt; "foo", "bar", 1
(parse "foo.bar.baz") ==&gt; "foo.bar", "baz", :NEWEST
</pre></blockquote>
The directory of pathnames beginning with a slash (or a
search-list, see section&nbsp;<a href="#search-lists">2.16.4</a>)
is starts <tt class="code">:absolute</tt>, others start with
<tt class="code">:relative</tt>. The <tt class="code">..</tt>
directory is parsed as <tt class="code">:up</tt>; there is no
namestring for <tt class="code">:back</tt>:
<blockquote class="example">
<pre>
(pathname-directory "/usr/foo/bar.baz") ==&gt; (:ABSOLUTE "usr" "foo")
(pathname-directory "../foo/bar.baz") ==&gt; (:RELATIVE :UP "foo")
</pre></blockquote>
<a name="toc50" id="toc50"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc43" id="htoc43"><b><font size=
"4">2.16.2</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Wildcard
Pathnames</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
Wildcards are supported in Unix pathnames. If `<tt class=
"code">*</tt>' is specified for a part of a pathname, that is
parsed as <tt class="code">:wild</tt>. `<tt class="code">**</tt>'
can be used as a directory name to indicate <tt class=
"code">:wild-inferiors</tt>. Filesystem operations treat <tt class=
"code">:wild-inferiors</tt> the same as <tt class=
"code">:wild</tt>, but pathname pattern matching (e.g. for logical
pathname translation, see section&nbsp;<a href=
"#logical-pathnames">2.16.3</a>) matches any number of directory
parts with `<tt class="code">**</tt>' (see see
section&nbsp;<a href="#wildcard-matching">2.17.1</a>.)<br>
<br>
`<tt class="code">*</tt>' embedded in a pathname part matches any
number of characters. Similarly, `<tt class="code">?</tt>' matches
exactly one character, and `<tt class="code">[a,b]</tt>' matches
the characters `<tt class="code">a</tt>' or `<tt class=
"code">b</tt>'. These pathname parts are parsed as <tt class=
"code">pattern</tt> objects.<br>
<br>
Backslash can be used as an escape character in namestring parsing
to prevent the next character from being treated as a wildcard.
Note that if typed in a string constant, the backslash must be
doubled, since the string reader also uses backslash as a quote:
<blockquote class="example">
<pre>
(pathname-name "foo\\*bar") =&gt; "foo*bar"
</pre></blockquote>
<a name="toc51" id="toc51"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc44" id="htoc44"><b><font size=
"4">2.16.3</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Logical
Pathnames</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept5"></a> <a name="logical-pathnames" id=
"logical-pathnames"></a><br>
If a namestring begins with the name of a defined logical pathname
host followed by a colon, then it will be parsed as a logical
pathname. Both `<tt class="code">*</tt>' and `<tt class=
"code">**</tt>' wildcards are implemented. <a name=
"@funs62"></a><tt class=
"code">load-logical-pathname-translations</tt> on <tt class=
"variable">name</tt> looks for a logical host definition file in
<tt class="filename">library:<tt class=
"variable">name</tt>.translations</tt>. Note that <tt class=
"filename">library:</tt> designates the search list (see
section&nbsp;<a href="#search-lists">2.16.4</a>) initialized to the
CMUCL <tt class="filename">lib/</tt> directory, not a logical
pathname. The format of the file is a single list of two-lists of
the from and to patterns:
<blockquote class="example">
<pre>
(("foo;*.text" "/usr/ram/foo/*.txt")
 ("foo;*.lisp" "/usr/ram/foo/*.l"))
</pre></blockquote>
<a name="toc52" id="toc52"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc45" id="htoc45"><b><font size=
"4">2.16.4</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Search
Lists</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept6"></a> <a name="search-lists" id=
"search-lists"></a><br>
Search lists are an extension to Common Lisp pathnames. They serve
a function somewhat similar to Common Lisp logical pathnames, but
work more like Unix PATH variables. Search lists are used for two
purposes:
<ul>
<li>They provide a convenient shorthand for commonly used directory
names, and<br>
<br></li>
<li>They allow the abstract (directory structure independent)
specification of file locations in program pathname constants
(similar to logical pathnames.)</li>
</ul>
Each search list has an associated list of directories (represented
as pathnames with no name or type component.) The namestring for
any relative pathname may be prefixed with ``<tt class=
"variable">slist</tt><tt class="code">:</tt>'', indicating that the
pathname is relative to the search list <tt class=
"variable">slist</tt> (instead of to the current working
directory.) Once qualified with a search list, the pathname is no
longer considered to be relative.<br>
<br>
When a search list qualified pathname is passed to a file-system
operation such as <tt class="code">open</tt>, <tt class=
"code">load</tt> or <tt class="code">truename</tt>, each directory
in the search list is successively used as the root of the pathname
until the file is located. When a file is written to a search list
directory, the file is always written to the first directory in the
list.<br>
<br>
<a name="toc53" id="toc53"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc46" id="htoc46"><b><font size=
"4">2.16.5</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Predefined
Search-Lists</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
These search-lists are initialized from the Unix environment or
when Lisp was built:
<dl compact="compact">
<dt><tt class="code">default:</tt><br></dt>
<dd>The current directory at startup.<br>
<br></dd>
<dt><tt class="code">home:</tt><br></dt>
<dd>The user's home directory.<br>
<br></dd>
<dt><tt class="code">library:</tt><br></dt>
<dd>The CMUCL <tt class="filename">lib/</tt> directory (<tt class=
"code">CMUCLLIB</tt> environment variable.)<br>
<br></dd>
<dt><tt class="code">path:</tt><br></dt>
<dd>The Unix command path (<tt class="code">PATH</tt> environment
variable.)<br>
<br></dd>
<dt><tt class="code">target:</tt><br></dt>
<dd>The root of the tree where CMUCL was compiled.</dd>
</dl>
It can be useful to redefine these search-lists, for example,
<tt class="filename">library:</tt> can be augmented to allow
logical pathname translations to be located, and <tt class=
"filename">target:</tt> can be redefined to point to where CMUCL
system sources are locally installed.<br>
<br>
<a name="toc54" id="toc54"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc47" id="htoc47"><b><font size=
"4">2.16.6</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Search-List
Operations</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
These operations define and access search-list definitions. A
search-list name may be parsed into a pathname before the
search-list is actually defined, but the search-list must be
defined before it can actually be used in a filesystem
operation.<br>
<br>
<br>
<a name="@funs63"></a><a name="FN:search-list" id=
"FN:search-list"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">search-list</tt> <tt class="variable">name</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function returns the list of directories associated with the
search list <tt class="variable">name</tt>. If <tt class=
"variable">name</tt> is not a defined search list, then an error is
signaled. When set with <tt class="code">setf</tt>, the list of
directories is changed to the new value. If the new value is just a
namestring or pathname, then it is interpreted as a one-element
list. Note that (unlike Unix pathnames), search list names are
case-insensitive.</blockquote>
<br>
<a name="@funs64"></a><a name="FN:search-list-defined-p" id=
"FN:search-list-defined-p"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">search-list-defined-p</tt> <tt class=
"variable">name</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
<a name="@funs65"></a><a name="FN:clear-search-list" id=
"FN:clear-search-list"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">clear-search-list</tt> <tt class=
"variable">name</tt> &nbsp;&nbsp;&nbsp;</div>
<br>
<br>
<tt class="code">search-list-defined-p</tt> returns <tt class=
"code">t</tt> if <tt class="variable">name</tt> is a defined search
list name, <tt class="code">nil</tt> otherwise. <tt class=
"code">clear-search-list</tt> make the search list <tt class=
"variable">name</tt> undefined.</blockquote>
<br>
<a name="@funs66"></a><a name="FN:enumerate-search-list" id=
"FN:enumerate-search-list"></a>
<div align="left">[Macro]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">enumerate-search-list</tt> (<tt class=
"variable">var</tt> <tt class="variable">pathname</tt> <tt class=
"code">{result}</tt>) <tt class="code">{form}</tt><sup><font size=
"2">*</font></sup> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This macro provides an interface to search list resolution. The
body <tt class="variable">forms</tt> are executed with <tt class=
"variable">var</tt> bound to each successive possible expansion for
<tt class="variable">name</tt>. If <tt class="variable">name</tt>
does not contain a search-list, then the body is executed exactly
once. Everything is wrapped in a block named <tt class=
"code">nil</tt>, so <tt class="code">return</tt> can be used to
terminate early. The <tt class="variable">result</tt> form (default
<tt class="code">nil</tt>) is evaluated to determine the result of
the iteration.</blockquote>
<a name="toc55" id="toc55"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc48" id="htoc48"><b><font size=
"4">2.16.7</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Search List
Example</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
The search list <tt class="code">code:</tt> can be defined as
follows:
<blockquote class="example">
<pre>
(setf (ext:search-list "code:") '("/usr/lisp/code/"))
</pre></blockquote>
It is now possible to use <tt class="code">code:</tt> as an
abbreviation for the directory <tt class=
"filename">/usr/lisp/code/</tt> in all file operations. For
example, you can now specify <tt class="code">code:eval.lisp</tt>
to refer to the file <tt class=
"filename">/usr/lisp/code/eval.lisp</tt>.<br>
<br>
To obtain the value of a search-list name, use the function
search-list as follows:
<blockquote class="example">
<pre>
(ext:search-list <tt class="variable">name</tt>)
</pre></blockquote>
Where <tt class="variable">name</tt> is the name of a search list
as described above. For example, calling <tt class=
"code">ext:search-list</tt> on <tt class="code">code:</tt> as
follows:
<blockquote class="example">
<pre>
(ext:search-list "code:")
</pre></blockquote>
returns the list <tt class="code">("/usr/lisp/code/")</tt>.<br>
<br>
<a name="toc56" id="toc56"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc49" id="htoc49"><b><font size=
"5">2.17</font></b></a></td>
<td width="100%" align="center"><b><font size="5">Filesystem
Operations</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
CMUCL provides a number of extensions and optional features beyond
those required by the Common Lisp specification.<br>
<br>
<a name="toc57" id="toc57"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc50" id="htoc50"><b><font size=
"4">2.17.1</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Wildcard
Matching</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="wildcard-matching" id="wildcard-matching"></a><br>
Unix filesystem operations such as <tt class="code">open</tt> will
accept wildcard pathnames that match a single file (of course,
<tt class="code">directory</tt> allows any number of matches.)
Filesystem operations treat <tt class="code">:wild-inferiors</tt>
the same as <tt class="code">:wild</tt>.<br>
<br>
<br>
<a name="@funs67"></a><a name="FN:directory" id="FN:directory"></a>
<div align="left">[Function]<br>
<tt class="function-name">directory</tt> <tt class=
"variable">wildname</tt> <tt class="code">&amp;key</tt> <tt class=
"code">:all</tt> <tt class="code">:check-for-subdirs</tt>
<tt class="code">:truenamep</tt><br>
<tt class="code">:follow-links</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
The keyword arguments to this Common Lisp function are a CMUCL
extension. The arguments (all default to <tt class="code">t</tt>)
have the following functions:
<dl compact="compact">
<dt><tt class="code">:all</tt><br></dt>
<dd>Include files beginning with dot such as <tt class=
"filename">.login</tt>, similar to ``<tt class="code">ls
-a</tt>''.<br>
<br></dd>
<dt><tt class="code">:check-for-subdirs</tt><br></dt>
<dd>Test whether files are directories, similar to ``<tt class=
"code">ls -F</tt>''.<br>
<br></dd>
<dt><tt class="code">:truenamep</tt><br></dt>
<dd>Call <tt class="code">truename</tt> on each file, which expands
out all symbolic links. Note that this option can easily result in
pathnames being returned which have a different directory from the
one in the <tt class="variable">wildname</tt> argument.<br>
<br></dd>
<dt><tt class="code">:follow-links</tt><br></dt>
<dd>Follow symbolic links when searching for matching
directories.</dd>
</dl>
</blockquote>
<br>
<a name="@funs68"></a><a name="FN:print-directory" id=
"FN:print-directory"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">print-directory</tt> <tt class=
"variable">wildname</tt> <tt class="code">&amp;optional</tt>
<tt class="variable">stream</tt> <tt class="code">&amp;key</tt>
<tt class="code">:all</tt> <tt class="code">:verbose</tt><br>
<tt class="code">:return-list</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
Print a directory of <tt class="variable">wildname</tt> listing to
<tt class="variable">stream</tt> (default <tt class=
"code">*standard-output*</tt>.) <tt class="code">:all</tt> and
<tt class="code">:verbose</tt> both default to <tt class=
"code">nil</tt> and correspond to the ``<tt class="code">-a</tt>''
and ``<tt class="code">-l</tt>'' options of <tt class=
"filename">ls</tt>. Normally this function returns <tt class=
"code">nil</tt>, but if <tt class="code">:return-list</tt> is true,
a list of the matched pathnames are returned.</blockquote>
<a name="toc58" id="toc58"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc51" id="htoc51"><b><font size=
"4">2.17.2</font></b></a></td>
<td width="100%" align="center"><b><font size="4">File Name
Completion</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
<br>
<a name="@funs69"></a><a name="FN:complete-file" id=
"FN:complete-file"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">complete-file</tt> <tt class=
"variable">pathname</tt> <tt class="code">&amp;key</tt> <tt class=
"code">:defaults</tt> <tt class="code">:ignore-types</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
Attempt to complete a file name to the longest unambiguous prefix.
If supplied, directory from <tt class="code">:defaults</tt> is used
as the ``working directory'' when doing completion. <tt class=
"code">:ignore-types</tt> is a list of strings of the pathname
types (a.k.a. extensions) that should be disregarded as possible
matches (binary file names, etc.)</blockquote>
<br>
<a name="@funs70"></a><a name="FN:ambiguous-files" id=
"FN:ambiguous-files"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">ambiguous-files</tt> <tt class=
"variable">pathname</tt> <tt class="code">&amp;optional</tt>
<tt class="variable">defaults</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
Return a list of pathnames for all the possible completions of
<tt class="variable">pathname</tt> with respect to <tt class=
"variable">defaults</tt>.</blockquote>
<a name="toc59" id="toc59"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc52" id="htoc52"><b><font size=
"4">2.17.3</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Miscellaneous
Filesystem Operations</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
<br>
<a name="@funs71"></a><a name="FN:default-directory" id=
"FN:default-directory"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">default-directory</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
Return the current working directory as a pathname. If set with
<tt class="code">setf</tt>, set the working directory.</blockquote>
<br>
<a name="@funs72"></a><a name="FN:file-writable" id=
"FN:file-writable"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">file-writable</tt> <tt class="variable">name</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function accepts a pathname and returns <tt class=
"code">t</tt> if the current process can write it, and <tt class=
"code">nil</tt> otherwise.</blockquote>
<br>
<a name="@funs73"></a><a name="FN:unix-namestring" id=
"FN:unix-namestring"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">unix-namestring</tt> <tt class=
"variable">pathname</tt> <tt class="code">&amp;optional</tt>
<tt class="variable">for-input</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
This function converts <tt class="variable">pathname</tt> into a
string that can be used with UNIX system calls. Search-lists and
wildcards are expanded. <tt class="variable">for-input</tt>
controls the treatment of search-lists: when true (the default) and
the file exists anywhere on the search-list, then that absolute
pathname is returned; otherwise the first element of the
search-list is used as the directory.</blockquote>
<a name="toc60" id="toc60"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc53" id="htoc53"><b><font size=
"5">2.18</font></b></a></td>
<td width="100%" align="center"><b><font size="5">Time Parsing and
Formatting</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
<a name="@concept7"></a> <a name="@concept8"></a> Functions are
provided to allow parsing strings containing time information and
printing time in various formats are available.<br>
<br>
<br>
<a name="@funs74"></a><a name="FN:parse-time" id=
"FN:parse-time"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">parse-time</tt> <tt class=
"variable">time-string</tt> <tt class="code">&amp;key</tt>
<tt class="code">:error-on-mismatch</tt> <tt class=
"code">:default-seconds</tt><br>
<tt class="code">:default-minutes</tt> <tt class=
"code">:default-hours</tt><br>
<tt class="code">:default-day</tt> <tt class=
"code">:default-month</tt><br>
<tt class="code">:default-year</tt> <tt class=
"code">:default-zone</tt><br>
<tt class="code">:default-weekday</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
<br>
<tt class="code">parse-time</tt> accepts a string containing a time
(e.g., "<tt class="code">Jan 12, 1952</tt>") and returns the
universal time if it is successful. If it is unsuccessful and the
keyword argument <tt class="code">:error-on-mismatch</tt> is
non-<tt class="code">nil</tt>, it signals an error. Otherwise it
returns <tt class="code">nil</tt>. The other keyword arguments have
the following meaning:<br>
<br>
<dl compact="compact">
<dt><tt class="code">:default-seconds</tt><br></dt>
<dd>specifies the default value for the seconds value if one is not
provided by <tt class="variable">time-string</tt>. The default
value is 0.<br>
<br></dd>
<dt><tt class="code">:default-minutes</tt><br></dt>
<dd>specifies the default value for the minutes value if one is not
provided by <tt class="variable">time-string</tt>. The default
value is 0.<br>
<br></dd>
<dt><tt class="code">:default-hours</tt><br></dt>
<dd>specifies the default value for the hours value if one is not
provided by <tt class="variable">time-string</tt>. The default
value is 0.<br>
<br></dd>
<dt><tt class="code">:default-day</tt><br></dt>
<dd>specifies the default value for the day value if one is not
provided by <tt class="variable">time-string</tt>. The default
value is the current day.<br>
<br></dd>
<dt><tt class="code">:default-month</tt><br></dt>
<dd>specifies the default value for the month value if one is not
provided by <tt class="variable">time-string</tt>. The default
value is the current month.<br>
<br></dd>
<dt><tt class="code">:default-year</tt><br></dt>
<dd>specifies the default value for the year value if one is not
provided by <tt class="variable">time-string</tt>. The default
value is the current year.<br>
<br></dd>
<dt><tt class="code">:default-zone</tt><br></dt>
<dd>specifies the default value for the time zone value if one is
not provided by <tt class="variable">time-string</tt>. The default
value is the current time zone.<br>
<br></dd>
<dt><tt class="code">:default-weekday</tt><br></dt>
<dd>specifies the default value for the day of the week if one is
not provided by <tt class="variable">time-string</tt>. The default
value is the current day of the week.</dd>
</dl>
Any of the above keywords can be given the value <tt class=
"code">:current</tt> which means to use the current value as
determined by a call to the operating system.</blockquote>
<br>
<a name="@funs75"></a><a name="FN:format-universal-time" id=
"FN:format-universal-time"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">format-universal-time</tt> <tt class=
"variable">dest</tt> <tt class="variable">universal-time</tt><br>
<tt class="code">&amp;key</tt> <tt class="code">:timezone</tt><br>
<tt class="code">:style</tt> <tt class="code">:date-first</tt><br>
<tt class="code">:print-seconds</tt> <tt class=
"code">:print-meridian</tt><br>
<tt class="code">:print-timezone</tt> <tt class=
"code">:print-weekday</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote><br>
<a name="@funs76"></a><a name="FN:format-decoded-time" id=
"FN:format-decoded-time"></a>
<div align="left">[Function]<br>
<tt class="function-name">extensions:</tt><tt class=
"function-name">format-decoded-time</tt> <tt class=
"variable">dest</tt> <tt class="variable">seconds</tt> <tt class=
"variable">minutes</tt> <tt class="variable">hours</tt> <tt class=
"variable">day</tt> <tt class="variable">month</tt> <tt class=
"variable">year</tt><br>
<tt class="code">&amp;key</tt> <tt class="code">:timezone</tt><br>
<tt class="code">:style</tt> <tt class="code">:date-first</tt><br>
<tt class="code">:print-seconds</tt> <tt class=
"code">:print-meridian</tt><br>
<tt class="code">:print-timezone</tt> <tt class=
"code">:print-weekday</tt> &nbsp;&nbsp;&nbsp;</div>
<br>
<br>
<tt class="code">format-universal-time</tt> formats the time
specified by <tt class="variable">universal-time</tt>. <tt class=
"code">format-decoded-time</tt> formats the time specified by
<tt class="variable">seconds</tt>, <tt class=
"variable">minutes</tt>, <tt class="variable">hours</tt>,
<tt class="variable">day</tt>, <tt class="variable">month</tt>, and
<tt class="variable">year</tt>. <tt class="variable">Dest</tt> is
any destination accepted by the <tt class="code">format</tt>
function. The keyword arguments have the following meaning:
<dl compact="compact">
<dt><tt class="code">:timezone</tt><br></dt>
<dd>is an integer specifying the hours west of Greenwich.
<tt class="code">:timezone</tt> defaults to the current time
zone.<br>
<br></dd>
<dt><tt class="code">:style</tt><br></dt>
<dd>specifies the style to use in formatting the time. The legal
values are:
<dl compact="compact">
<dt><tt class="code">:short</tt><br></dt>
<dd>specifies to use a numeric date.<br>
<br></dd>
<dt><tt class="code">:long</tt><br></dt>
<dd>specifies to format months and weekdays as words instead of
numbers.<br>
<br></dd>
<dt><tt class="code">:abbreviated</tt><br></dt>
<dd>is similar to long except the words are abbreviated.<br>
<br></dd>
<dt><tt class="code">:government</tt><br></dt>
<dd>is similar to abbreviated, except the date is of the form ``day
month year'' instead of ``month day, year''.</dd>
</dl>
<br>
<br></dd>
<dt><tt class="code">:date-first</tt><br></dt>
<dd>if non-<tt class="code">nil</tt> (default) will place the date
first. Otherwise, the time is placed first.<br>
<br></dd>
<dt><tt class="code">:print-seconds</tt><br></dt>
<dd>if non-<tt class="code">nil</tt> (default) will format the
seconds as part of the time. Otherwise, the seconds will be
omitted.<br>
<br></dd>
<dt><tt class="code">:print-meridian</tt><br></dt>
<dd>if non-<tt class="code">nil</tt> (default) will format ``AM''
or ``PM'' as part of the time. Otherwise, the ``AM'' or ``PM'' will
be omitted.<br>
<br></dd>
<dt><tt class="code">:print-timezone</tt><br></dt>
<dd>if non-<tt class="code">nil</tt> (default) will format the time
zone as part of the time. Otherwise, the time zone will be
omitted.<br>
<br></dd>
<dt><tt class="code">:print-weekday</tt><br></dt>
<dd>if non-<tt class="code">nil</tt> (default) will format the
weekday as part of date. Otherwise, the weekday will be
omitted.</dd>
</dl>
</blockquote>
<a name="toc61" id="toc61"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc54" id="htoc54"><b><font size=
"5">2.19</font></b></a></td>
<td width="100%" align="center"><b><font size="5">Random Number
Generation</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept9"></a><br>
Common Lisp includes a random number generator as a standard part
of the language; however, the implementation of the generator is
not specified. Two random number generators are available in CMUCL,
depending on the version.<br>
<br>
<a name="toc62" id="toc62"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc55" id="htoc55"><b><font size=
"4">2.19.1</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Original
Generator</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
<a name="@concept10"></a> The default random number generator uses
a lagged Fibonacci generator given by<br>
<div align="center"><i>z</i>[<i>i</i>] = <i>z</i>[<i>i</i> - 24] -
<i>z</i>[<i>i</i> - 55] mod536870908</div>
<br>
where <i>z</i>[<i>i</i>] is the <i>i</i>'th random number. This
generator produces small integer-valued numbers. For larger
integer, the small random integers are concatenated to produce
larger integers. For floating-point numbers, the bits from this
generator are used as the bits of the floating-point
significand.<br>
<br>
<a name="toc63" id="toc63"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc56" id="htoc56"><b><font size=
"4">2.19.2</font></b></a></td>
<td width="100%" align="center"><b><font size="4">New
Generator</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept11"></a><br>
In some versions of CMUCL, the original generator above has been
replaced with a subtract-with-borrow generator combined with a Weyl
generator.<sup><a name="text2" href="#note2" id="text2"><font size=
"2">2</font></a></sup> The reason for the change was to use a
documented generator which has passed tests for randomness.<br>
<br>
The subtract-with-borrow generator is described by the following
equation
<div align="center"><i>z</i>[<i>i</i>] = <i>z</i>[<i>i</i> + 20] -
<i>z</i>[<i>i</i> + 5] - <i>b</i></div>
where <i>z</i>[<i>i</i>] is the <i>i</i>'th random number, which is
a <tt class="code">double-float</tt>. All of the indices in this
equation are interpreted modulo 32. The quantity <i>b</i> is
carried over from the previous iteration and is either 0 or
<tt class="code">double-float-epsilon</tt>. If <i>z</i>[<i>i</i>]
is positive, <i>b</i> is set to zero. Otherwise, <i>b</i> is set to
<tt class="code">double-float-epsilon</tt>.<br>
<br>
To increase the randomness of this generator, this generator is
combined with a Weyl generator defined by
<div align="center"><i>x</i>[<i>i</i>] = <i>x</i>[<i>i</i> - 1] -
<i>y</i> mod1,</div>
where <i>y</i> = 7097293079245107 &times; 2<sup><font size=
"2">-53</font></sup>. Thus, the resulting random number
<i>r</i>[<i>i</i>] is
<div align="center"><i>r</i>[<i>i</i>] = (<i>z</i>[<i>i</i>] -
<i>x</i>[<i>i</i>]) mod1</div>
<br>
This generator has been tested by Peter VanEynde using Marsaglia's
diehard test suite for random number generators; this generator
passes the test suite.<br>
<br>
This generator is designed for generating floating-point random
numbers. To obtain integers, the bits from the significand of the
floating-point number are used as the bits of the integer. As many
floating-point numbers as needed are generated to obtain the
desired number of bits in the random integer.<br>
<br>
For floating-point numbers, this generator can by significantly
faster than the original generator.<br>
<br>
<a name="toc64" id="toc64"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc57" id="htoc57"><b><font size=
"4">2.19.3</font></b></a></td>
<td width="100%" align="center"><b><font size="4">MT-19937
Generator</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept12"></a> On all platforms, this is the preferred
generator as indicated by <tt class="code">:rand-mt19937</tt> being
in <tt class="code">*features*</tt>. This is a Lisp implementation
of the MT-19937 generator of Makoto Matsumoto and T. Nishimura. We
refer the reader to their paper<sup><a name="text3" href="#note3"
id="text3"><font size="2">3</font></a></sup> or to their website at
<a href=
"http://www.math.keio.ac.jp/~matumoto/emt.html"><tt>http://www.math.keio.ac.jp/&nbsp;matsumoto/emt.html</tt></a>.<br>

<br>
<a name="toc65" id="toc65"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc58" id="htoc58"><b><font size=
"5">2.20</font></b></a></td>
<td width="100%" align="center"><b><font size="5">Lisp
Threads</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept13"></a><br>
CMUCL supports Lisp threads for the x86 platform.<br>
<br>
<a name="toc66" id="toc66"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc59" id="htoc59"><b><font size=
"5">2.21</font></b></a></td>
<td width="100%" align="center"><b><font size="5">Lisp
Library</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="lisp-lib" id="lisp-lib"></a><br>
The CMUCL project maintains a collection of useful or interesting
programs written by users of our system. The library is in
<tt class="filename">lib/contrib/</tt>. Two files there that users
should read are:
<dl compact="compact">
<dt>CATALOG.TXT<br></dt>
<dd>This file contains a page for each entry in the library. It
contains information such as the author, portability or dependency
issues, how to load the entry, etc.<br>
<br></dd>
<dt>READ-ME.TXT<br></dt>
<dd>This file describes the library's organization and all the
possible pieces of information an entry's catalog description could
contain.</dd>
</dl>
Hemlock has a command <tt class="code">Library Entry</tt> that
displays a list of the current library entries in an editor buffer.
There are mode specific commands that display catalog descriptions
and load entries. This is a simple and convenient way to browse the
library.<br>
<br>
<a name="toc67" id="toc67"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc60" id="htoc60"><b><font size=
"5">2.22</font></b></a></td>
<td width="100%" align="center"><b><font size="5">Generalized
Function Names</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
<br>
<a name="@funs77"></a><a name="FN:define-function-name-syntax" id=
"FN:define-function-name-syntax"></a>
<div align="left">[Macro]<br>
<tt class="function-name">ext:</tt><tt class=
"function-name">define-function-name-syntax</tt> name (var)
<tt class="code">&amp;body</tt> body &nbsp;&nbsp;&nbsp;</div>
<blockquote>Define lists starting with the symbol <tt class=
"code">name</tt> as a new extended function name syntax.<br>
<br>
<tt class="code">body</tt> is executed with <tt class=
"code">var</tt> bound to an actual function name of that form, and
should return two values:
<ul>
<li>A generalized boolean that is true if <tt class="code">var</tt>
is a valid function name.</li>
<li>A symbol that can be used as a <tt class="code">block</tt> name
in functions whose name is <tt class="code">var</tt>. (For some
sorts of function names it might make sense to return <tt class=
"code">nil</tt> for the block name, or just return one value.)</li>
</ul>
Users should not define function names starting with a symbol that
CMUCL might be using internally. It is therefore advisable to only
define new function names starting with a symbol from a
user-defined package.</blockquote>
<br>
<a name="@funs78"></a><a name="FN:valid-function-name-p" id=
"FN:valid-function-name-p"></a>
<div align="left">[Function]<br>
<tt class="function-name">ext:</tt><tt class=
"function-name">valid-function-name-p</tt> name
&nbsp;&nbsp;&nbsp;</div>
<blockquote>Returns two values:
<ul>
<li>True if <tt class="code">name</tt> is a valid function
name.</li>
<li>A symbol that can be used as a <tt class="code">block</tt> name
in functions whose name is <tt class="code">name</tt>. This can be
<tt class="code">nil</tt> for some function names.</li>
</ul>
</blockquote>
<a name="toc68" id="toc68"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc61" id="htoc61"><b><font size=
"5">2.23</font></b></a></td>
<td width="100%" align="center"><b><font size=
"5">CLOS</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
<a name="toc69" id="toc69"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc62" id="htoc62"><b><font size=
"4">2.23.1</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Primary Method
Errors</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept14"></a><br>
The standard requires that an error is signaled when a generic
function is called and
<ul>
<li>no primary method is applicable to the generic function's
actual arguments, and</li>
<li>the generic function's method combination is either the
standard method combination or a method combination defined with
the short form of <tt class="code">define-method-combination</tt>.
The latter includes the standardized method combinations like
<tt class="code">progn</tt>, <tt class="code">and</tt>, etc.</li>
</ul>
<br>
<a name="@funs79"></a><a name=
"FN:no-primary-method-generic-generic" id=
"FN:no-primary-method-generic-generic"></a>
<div align="left">[Generic Function]<br>
<tt class="function-name">pcl:</tt><tt class=
"function-name">no-primary-method</tt> gf &amp;rest args
&nbsp;&nbsp;&nbsp;</div>
In CMUCL, this generic function is called in the above erroneous
cases. The parameter <tt class="code">gf</tt> is the generic
function being called, and <tt class="code">args</tt> is a list of
actual arguments in the generic function call.<br>
<br>
<br>
<a name="@funs80"></a><a name=
"FN:no-primary-method-method-standard" id=
"FN:no-primary-method-method-standard"></a>
<div align="left">[Method]<br>
<tt class="function-name">pcl:</tt><tt class=
"function-name">no-primary-method</tt> (gf
standard-generic-function) &amp;rest args &nbsp;&nbsp;&nbsp;</div>
This method signals a continuable error of type <tt class=
"code">pcl:no-primary-method-error</tt>.<br>
<br>
<a name="toc70" id="toc70"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc63" id="htoc63"><b><font size=
"4">2.23.2</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Slot Type
Checking</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept15"></a><br>
Declared slot types are used when
<ul>
<li>reading slot values with <tt class="code">slot-value</tt> in
methods, or<br>
<br></li>
<li>setting slots with <tt class="code">(setf slot-value)</tt> in
methods, or<br>
<br></li>
<li>creating instances with <tt class="code">make-instance</tt>,
when slots are initialized from initforms. This currently depends
on PCL being able to use its internal <tt class=
"code">make-instance</tt> optimization, which it usually can.</li>
</ul>
Example:
<blockquote class="example">
<pre>
(defclass foo ()
  ((a :type fixnum)))

(defmethod bar ((object foo) value)
  (with-slots (a) object
    (setf a value)))

(defmethod baz ((object foo))
  (&lt; (slot-value object 'a) 10))
</pre></blockquote>
In method <tt class="code">bar</tt>, and with a suitable safety
setting, a type error will occur if <tt class="code">value</tt> is
not a <tt class="code">fixnum</tt>. In method <tt class=
"code">baz</tt>, a <tt class="code">fixnum</tt> comparison can be
used by the compiler.<br>
<br>
<br>
<a name="@vars18"></a><a name="VR:use-slot-types-p" id=
"VR:use-slot-types-p"></a>
<div align="left">[Variable]<br>
<tt class="function-name">pcl::</tt><tt class=
"function-name">*use-slot-types-p*</tt> &nbsp;&nbsp;&nbsp;</div>
<blockquote>Slot type checking can be turned off by setting this
variable to <tt class="code">nil</tt>, which can be useful for
compiling code containing incorrect slot type
declarations.</blockquote>
<a name="toc71" id="toc71"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc64" id="htoc64"><b><font size=
"4">2.23.3</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Slot Access
Optimization</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept16"></a> <a name="@concept17"></a><br>
The declaration <tt class="code">ext:slots</tt> is used for
optimizing slot access in methods.
<blockquote class="example">
<pre>
declare (ext:slots specifier*)

specifier   ::= (quality class-entry*)
quality     ::= SLOT-BOUNDP | INLINE
class-entry ::= class | (class slot-name*)
class       ::= the name of a class
slot-name   ::= the name of a slot
</pre></blockquote>
The <tt class="code">slot-boundp</tt> quality specifies that all or
some slots of a class are always bound.<br>
<br>
The <tt class="code">inline</tt> quality specifies that access to
all or some slots of a class should be inlined, using compile-time
knowledge of class layouts.<br>
<br>
<a name="toc72" id="toc72"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFED">
<div align="center">
<table>
<tr>
<td><b>2.23.3.1</b></td>
<td width="100%" align="center"><tt class=
"code"><b>slot-boundp</b></tt> <b>Declaration</b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept18"></a><br>
Example:
<blockquote class="example">
<pre>
(defclass foo ()
  (a b))

(defmethod bar ((x foo))
  (declare (ext:slots (slot-boundp foo)))
  (list (slot-value x 'a) (slot-value x 'b)))
</pre></blockquote>
The <tt class="code">slot-boundp</tt> declaration in method
<tt class="code">bar</tt> specifies that the slots <tt class=
"code">a</tt> and <tt class="code">b</tt> accessed through
parameter <tt class="code">x</tt> in the scope of the declaration
are always bound, because parameter <tt class="code">x</tt> is
specialized on class <tt class="code">foo</tt> to which the
<tt class="code">slot-boundp</tt> declaration applies. The
PCL-generated code for the <tt class="code">slot-value</tt> forms
will thus not contain tests for the slots being bound or not. The
consequences are undefined should one of the accessed slots not be
bound.<br>
<br>
<a name="toc73" id="toc73"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFED">
<div align="center">
<table>
<tr>
<td><b>2.23.3.2</b></td>
<td width="100%" align="center"><tt class="code"><b>inline</b></tt>
<b>Declaration</b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept19"></a><br>
Example:
<blockquote class="example">
<pre>
(defclass foo ()
  (a b))

(defmethod bar ((x foo))
  (declare (ext:slots (inline (foo a))))
  (list (slot-value x 'a) (slot-value x 'b)))
</pre></blockquote>
The <tt class="code">inline</tt> declaration in method <tt class=
"code">bar</tt> tells PCL to use compile-time knowledge of slot
locations for accessing slot <tt class="code">a</tt> of class
<tt class="code">foo</tt>, in the scope of the declaration.<br>
<br>
Class <tt class="code">foo</tt> must be known at compile time for
this optimization to be possible. PCL prints a warning and uses
normal slot access If the class is not defined at compile time.<br>
<br>
If a class is <tt class="code">proclaim</tt>ed to use inline slot
access before it is defined, the class is defined at compile time.
Example:
<blockquote class="example">
<pre>
(declaim (ext:slots (inline (foo slot-a))))
(defclass foo () ...)
(defclass bar (foo) ...)
</pre></blockquote>
Class <tt class="code">foo</tt> will be defined at compile time
because it is declared to use inline slot access; methods accessing
slot <tt class="code">slot-a</tt> of <tt class="code">foo</tt> will
use inline slot access if otherwise possible. Class <tt class=
"code">bar</tt> will be defined at compile time because its
superclass <tt class="code">foo</tt> is declared to use inline slot
access. PCL uses compile-time information from subclasses to warn
about situations where using inline slot access is not
possible.<br>
<br>
Normal slot access will be used if PCL finds, at method compilation
time, that
<ul>
<li>class <tt class="code">foo</tt> has a subclass in which slot
<tt class="code">a</tt> is at a different location, or<br>
<br></li>
<li>there exists a <tt class="code">slot-value-using-class</tt>
method for <tt class="code">foo</tt> or a subclass of <tt class=
"code">foo</tt>.</li>
</ul>
When the declaration is used to optimize calls to slot accessor
generic functions in methods, as opposed to <tt class=
"code">slot-value</tt> or <tt class="code">(setf slot-value)</tt>,
the optimization is additionally not used if
<ul>
<li>there exist, at compile time, applicable methods on the
reader/writer generic function that are not standard accessor
methods (for instance, there exist around-methods), or<br>
<br></li>
<li>applicable reader/writer methods access different slots in a
class accessed inline, and one of its subclasses.</li>
</ul>
The consequences are undefined if the compile-time environment is
not the same as the run-time environment in these respects, or if
the definition of class <tt class="code">foo</tt> or any subclass
of <tt class="code">foo</tt> is changed in an incompatible way,
that is, if slot locations change.<br>
<br>
The effect of the <tt class="code">inline</tt> optimization
combined with the <tt class="code">slot-boundp</tt> optimization is
that CLOS slot access becomes as fast as structure slot access,
which is an order of magnitude faster than normal CLOS slot
access.<br>
<br>
<br>
<a name="@vars19"></a><a name="VR:optimize-inline-slot-access-p"
id="VR:optimize-inline-slot-access-p"></a>
<div align="left">[Variable]<br>
<tt class="function-name">pcl::</tt><tt class=
"function-name">*optimize-inline-slot-access-p*</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote>This variable controls if inline slot access
optimizations are performed. It is true by default.</blockquote>
<a name="toc74" id="toc74"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFED">
<div align="center">
<table>
<tr>
<td><b>2.23.3.3</b></td>
<td width="100%" align="center"><b>Automatic Method
Recompilation</b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept20"></a> <a name="@concept21"></a> <a name=
"@concept22"></a><br>
Methods using inline slot access can be automatically recompiled
after class changes. Two declarations control which methods are
automatically recompiled.
<blockquote class="example">
<pre>
declaim (ext:auto-compile specifier*)
declaim (ext:not-auto-compile specifier*)

specifier   ::= gf-name | (gf-name qualifier* (specializer*))
gf-name     ::= the name of a generic function
qualifier   ::= a method qualifier
specializer ::= a method specializer
</pre></blockquote>
If no specifier is given, auto-compilation is by default done/not
done for all methods of all generic functions using inline slot
access; current default is that it is not done. This global policy
can be overridden on a generic function and method basis. If
<tt class="code">specifier</tt> is a generic function name, it
applies to all methods of that generic function.<br>
<br>
Examples:
<blockquote class="example">
<pre>
(declaim (ext:auto-compile foo))
(defmethod foo :around ((x bar)) ...)
</pre></blockquote>
The around-method <tt class="code">foo</tt> will be automatically
recompiled because the declamation applies to all methods with name
<tt class="code">foo</tt>.
<blockquote class="example">
<pre>
(declaim (ext:auto-compile (foo (bar))))
(defmethod foo :around ((x bar)) ...)
(defmethod foo ((x bar)) ...)
</pre></blockquote>
The around-method will not be automatically recompiled, but the
primary method will.
<blockquote class="example">
<pre>
(declaim (ext:auto-compile foo))
(declaim (ext:not-auto-compile (foo :around (bar)))  
(defmethod foo :around ((x bar)) ...)
(defmethod foo ((x bar)) ...)
</pre></blockquote>
The around-method will not be automatically recompiled, because it
is explicitly declaimed not to be. The primary method will be
automatically recompiled because the first declamation applies to
it.<br>
<br>
Auto-recompilation works by recording method bodies using inline
slot access. When PCL determines that a recompilation is necessary,
a <tt class="code">defmethod</tt> form is constructed and
evaluated.<br>
<br>
Auto-compilation can only be done for methods defined in a null
lexical environment. PCL prints a warning and doesn't record the
method body if a method using inline slot access is defined in a
non-null lexical environment. Instead of doing a recompilation on
itself, PCL will then print a warning that the method must be
recompiled manually when classes are changed.<br>
<br>
<a name="toc75" id="toc75"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc65" id="htoc65"><b><font size=
"4">2.23.4</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Inlining Methods
in Effective Methods</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept23"></a> <a name="@concept24"></a> <a name=
"@concept25"></a> <a name="@concept26"></a><br>
When a generic function is called, an effective method is
constructed from applicable methods. The effective method is called
with the original arguments, and itself calls applicable methods
according to the generic function's method combination. Some of the
function call overhead in effective methods can be removed by
inlining methods in effective methods, at the expense of increased
code size.<br>
<br>
Inlining of methods is controlled by the usual <tt class=
"code">inline</tt> declaration. In the following example, both
<tt class="code">foo</tt> methods shown will be inlined in
effective methods:
<blockquote class="example">
<pre>
(declaim (inline (method foo (foo))
                 (method foo :before (foo))))
(defmethod foo ((x foo)) ...)
(defmethod foo :before ((x foo)) ...)
</pre></blockquote>
Please note that this form of inlining has no noticeable effect for
effective methods that consist of a primary method only, which
doesn't have keyword arguments. In such cases, PCL uses the primary
method directly for the effective method.<br>
<br>
When the definition of an inlined method is changed, effective
methods are <b>not</b> automatically updated to reflect the change.
This is just as it is when inlining normal functions. Different
from the normal case is that users do not have direct access to
effective methods, as it would be the case when a function is
inlined somewhere else. Because of this, the function <tt class=
"code">pcl:flush-emf-cache</tt> is provided for forcing such an
update of effective methods.<br>
<br>
<br>
<a name="@funs81"></a><a name="FN:flush-emf-cache" id=
"FN:flush-emf-cache"></a>
<div align="left">[Function]<br>
<tt class="function-name">pcl:</tt><tt class=
"function-name">flush-emf-cache</tt> &amp;optional gf
&nbsp;&nbsp;&nbsp;</div>
<blockquote>Flush cached effective method functions. If <tt class=
"code">gf</tt> is supplied, it should be a generic function
metaobject or the name of a generic function, and this function
flushes all cached effective methods for the given generic
function. If <tt class="code">gf</tt> is not supplied, all cached
effective methods are flushed.</blockquote>
<br>
<a name="@vars20"></a><a name="VR:inline-methods-in-emfs" id=
"VR:inline-methods-in-emfs"></a>
<div align="left">[Variable]<br>
<tt class="function-name">pcl::</tt><tt class=
"function-name">*inline-methods-in-emfs*</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote>If true, the default, perform method inlining as
described above. If false, don't.</blockquote>
<a name="toc76" id="toc76"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc66" id="htoc66"><b><font size=
"4">2.23.5</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Effective Method
Precomputation</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept27"></a> <a name="@concept28"></a> <a name=
"@concept29"></a><br>
When a generic function is called, the generic function's
discriminating function computes the set of methods applicable to
actual arguments and constructs an effective method function from
applicable methods, using the generic function's method
combination.<br>
<br>
Effective methods can be precomputed at method load time instead of
when the generic function is called depending on the value of
<tt class="code">pcl:*max-emf-precomputation-methods*</tt>.<br>
<br>
<br>
<a name="@vars21"></a><a name=
"VR:*max-emf-precomputation-methods*"></a>
<div align="left">[Variable]<br>
<tt class="function-name">pcl:</tt><tt class=
"function-name">**max-emf-precomputation-methods**</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote>If nonzero, the default value is 100, precompute
effective methods when methods are loaded, and the method's generic
function has less than the specified number of methods.<br>
<br>
If zero, compute effective methods only when the generic function
is called.</blockquote>
<a name="toc77" id="toc77"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc67" id="htoc67"><b><font size=
"4">2.23.6</font></b></a></td>
<td width="100%" align="center"><b><font size=
"4">Sealing</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept30"></a> <a name="@concept31"></a> <a name=
"@concept32"></a> <a name="@concept33"></a><br>
Support for sealing classes and generic functions have been
implemented. Please note that this interface is subject to
change.<br>
<br>
<br>
<a name="@funs82"></a><a name="FN:seal" id="FN:seal"></a>
<div align="left">[Macro]<br>
<tt class="function-name">pcl:</tt><tt class=
"function-name">seal</tt> name (var) <tt class=
"code">&amp;rest</tt> specifiers &nbsp;&nbsp;&nbsp;</div>
<blockquote>Seal <tt class="code">name</tt> with respect to the
given specifiers; <tt class="code">name</tt> can be the name of a
class or generic-function.<br>
<br>
Supported specifiers are <tt class="code">:subclasses</tt> for
classes, which prevents changing subclasses of a class, and
<tt class="code">:methods</tt> which prevents changing the methods
of a generic function.<br>
<br>
Sealing violations signal an error of type <tt class=
"code">pcl:sealed-error</tt>.</blockquote>
<br>
<a name="@funs83"></a><a name="FN:unseal" id="FN:unseal"></a>
<div align="left">[Function]<br>
<tt class="function-name">pcl:</tt><tt class=
"function-name">unseal</tt> name-or-object &nbsp;&nbsp;&nbsp;</div>
<blockquote>Remove seals from <tt class=
"code">name-or-object</tt>.</blockquote>
<a name="toc78" id="toc78"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc68" id="htoc68"><b><font size=
"4">2.23.7</font></b></a></td>
<td width="100%" align="center"><b><font size="4">Method Tracing
and Profiling</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="sec:method-tracing" id="sec:method-tracing"></a> <a name=
"@concept34"></a> <a name="@concept35"></a> <a name=
"@concept36"></a> <a name="@concept37"></a> <a name=
"@concept38"></a> <a name="@concept39"></a><br>
Methods can be traced with <tt class="code">trace</tt>, using
function names of the form <tt class="code">(method &lt;name&gt;
&lt;qualifiers&gt; &lt;specializers&gt;)</tt>. Example:
<blockquote class="example">
<pre>
(defmethod foo ((x integer)) x)
(defmethod foo :before ((x integer)) x)

(trace (method foo (integer)))
(trace (method foo :before (integer)))
(untrace (method foo :before (integer)))
</pre></blockquote>
<br>
<br>
<tt class="code">trace</tt> and <tt class="code">untrace</tt> also
allow a name specifier <tt class="code">:methods gf-form</tt> for
tracing all methods of a generic function:
<blockquote class="example">
<pre>
(trace :methods 'foo)
(untrace :methods 'foo)
</pre></blockquote>
Methods can also be specified for the <tt class=
"code">:wherein</tt> option to <tt class="code">trace</tt>. Because
this option is a name or a list of names, methods must be specified
as a list. Thus, to trace all calls of <tt class="code">foo</tt>
from the method <tt class="code">bar</tt> specialized on integer
argument, use
<blockquote class="example">
<pre>
  (trace foo :wherein ((method bar (integer))))
</pre></blockquote>
Before and after methods are supported as well:
<blockquote class="example">
<pre>
  (trace foo :wherein ((method bar :before (integer))))
</pre></blockquote>
Method profiling is done analogously to <tt class=
"code">trace</tt>:
<blockquote class="example">
<pre>
(defmethod foo ((x integer)) x)
(defmethod foo :before ((x integer)) x)

(profile:profile (method foo (integer)))
(profile:profile (method foo :before (integer)))
(profile:unprofile (method foo :before (integer)))

(profile:profile :methods 'foo)
(profile:unprofile :methods 'foo)

(profile:profile-all :methods t)
</pre></blockquote>
<a name="toc79" id="toc79"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc69" id="htoc69"><b><font size=
"4">2.23.8</font></b></a></td>
<td width="100%" align="center"><b><font size=
"4">Misc</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept40"></a><br>
<br>
<a name="@vars22"></a><a name="VR:compile-interpreted-methods-p"
id="VR:compile-interpreted-methods-p"></a>
<div align="left">[Variable]<br>
<tt class="function-name">pcl::</tt><tt class=
"function-name">*compile-interpreted-methods-p*</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote>This variable controls compilation of interpreted
method functions, e.g. for methods defined interactively at the
REPL. Default is true, that is, method functions are
compiled.</blockquote>
<a name="toc80" id="toc80"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc70" id="htoc70"><b><font size=
"5">2.24</font></b></a></td>
<td width="100%" align="center"><b><font size="5">Differences from
ANSI Common Lisp</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
This section describes some of the known differences between CMUCL
and ANSI Common Lisp. Some may be non-compliance issues; same may
be extensions.<br>
<br>
<a name="toc81" id="toc81"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc71" id="htoc71"><b><font size=
"4">2.24.1</font></b></a></td>
<td width="100%" align="center"><b><font size=
"4">Extensions</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<br>
<br>
<a name="@funs84"></a><a name="FN:constantly" id=
"FN:constantly"></a>
<div align="left">[Function]<br>
<tt class="function-name">constantly</tt> value &amp;optional val1
val2 &amp;rest more-values &nbsp;&nbsp;&nbsp;</div>
<blockquote>As an extension, CMUCL allows <tt class=
"code">constantly</tt> to accept more than one value which are
returned as multiple values.</blockquote>
<a name="toc82" id="toc82"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc72" id="htoc72"><b><font size=
"5">2.25</font></b></a></td>
<td width="100%" align="center"><b><font size="5">Function
Wrappers</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept41"></a> <a name="@concept42"></a><br>
Function wrappers, fwrappers for short, are a facility for
efficiently encapsulating functions<sup><a name="text4" href=
"#note4" id="text4"><font size="2">4</font></a></sup>.<br>
<br>
Functions in CMUCL are represented by <tt class=
"code">kernel:fdefn</tt> objects. Each <tt class="code">fdefn</tt>
object contains a reference to its function's actual code, which we
call the function's primary function.<br>
<br>
A function wrapper replaces the primary function in the <tt class=
"code">fdefn</tt> object with a function of its own, and records
the original function in an fwrapper object, a funcallable
instance. Thus, when the function is called, the fwrapper gets
called, which in turn might call the primary function, or a
previously installed fwrapper that was found in the <tt class=
"code">fdefn</tt> object when the second fwrapper was
installed.<br>
<br>
Example:
<blockquote class="lisp">
<pre>
(use-package :fwrappers)

(define-fwrapper foo (x y)
  (format t "x = ~s, y = ~s, user-data = ~s~%"
          x y (fwrapper-user-data fwrapper))
  (let ((value (call-next-function)))
    (format t "value = ~s~%" value)
    value))

(defun bar (x y)
  (+ x y))

(fwrap 'bar #'foo :type 'foo :user-data 42)

(bar 1 2)
 =&gt;
 x = 1, y = 2, user-data = 42
 value = 3
 3   
</pre></blockquote>
Fwrappers are used in the implementation of <tt class=
"code">trace</tt> and <tt class="code">profile</tt>.<br>
<br>
Please note that <tt class="code">fdefinition</tt> always returns
the primary definition of a function; if a function is fwrapped,
<tt class="code">fdefinition</tt> returns the primary function
stored in the innermost fwrapper object. Likewise, if a function is
fwrapped, <tt class="code">(setf fdefinition)</tt> will set the
primary function in the innermost fwrapper.<br>
<br>
<br>
<a name="@funs85"></a><a name="FN:define-fwrapper" id=
"FN:define-fwrapper"></a>
<div align="left">[Macro]<br>
<tt class="function-name">fwrappers:</tt><tt class=
"function-name">define-fwrapper</tt> name lambda-list <tt class=
"code">&amp;body</tt>body &nbsp;&nbsp;&nbsp;</div>
<blockquote>This macro is like <tt class="code">defun</tt>, but
defines a function named <tt class="variable">name</tt> that can be
used as an fwrapper definition.<br>
<br>
In <tt class="variable">body</tt>, the symbol <tt class=
"code">fwrapper</tt> is bound to the current fwrapper object.<br>
<br>
The macro <tt class="code">call-next-function</tt> can be used to
invoke the next fwrapper, or the primary function that is being
fwrapped. When called with no arguments, <tt class=
"code">call-next-function</tt> invokes the next function with the
original arguments passed to the fwrapper, unless you modify one of
the parameters. When called with arguments, <tt class=
"code">call-next-function</tt> invokes the next function with the
given arguments.</blockquote>
<br>
<a name="@funs86"></a><a name="FN:fwrap" id="FN:fwrap"></a>
<div align="left">[Function]<br>
<tt class="function-name">fwrappers:</tt><tt class=
"function-name">fwrap</tt> function-name fwrapper &amp;key type
user-data &nbsp;&nbsp;&nbsp;</div>
<blockquote>This function wraps function <tt class=
"code">function-name</tt> in an fwrapper <tt class=
"variable">fwrapper</tt> which was defined with <tt class=
"code">define-fwrapper</tt>.<br>
<br>
The value of <tt class="variable">type</tt>, if supplied, is used
as an identifying tag that can be used in various other
operations.<br>
<br>
The value of <tt class="variable">user-data</tt> is stored as
user-supplied data in the fwrapper object that is created for the
function encapsulation. User-data is accessible in the body of
fwrappers defined with <tt class="code">define-fwrapper</tt> as
<tt class="code">(fwrapper-user-data fwrapper)</tt>.<br>
<br>
Value is the fwrapper object created.</blockquote>
<br>
<a name="@funs87"></a><a name="FN:funwrap" id="FN:funwrap"></a>
<div align="left">[Function]<br>
<tt class="function-name">fwrappers:</tt><tt class=
"function-name">funwrap</tt> function-name &amp;key type test
&nbsp;&nbsp;&nbsp;</div>
<blockquote>Remove fwrappers from the function named <tt class=
"variable">function-name</tt>. If <tt class="variable">type</tt> is
supplied, remove fwrappers whose type is <tt class=
"code">equal</tt> to <tt class="variable">type</tt>. If <tt class=
"variable">test</tt> is supplied, remove fwrappers satisfying
<tt class="variable">test</tt>.</blockquote>
<br>
<a name="@funs88"></a><a name="FN:find-fwrapper" id=
"FN:find-fwrapper"></a>
<div align="left">[Function]<br>
<tt class="function-name">fwrappers:</tt><tt class=
"function-name">find-fwrapper</tt> function-name &amp;key type test
&nbsp;&nbsp;&nbsp;</div>
<blockquote>Find an fwrapper of <tt class=
"variable">function-name</tt>. If <tt class="variable">type</tt> is
supplied, find an fwrapper whose type is <tt class=
"code">equal</tt> to <tt class="variable">type</tt>. If <tt class=
"variable">test</tt> is supplied, find an fwrapper satisfying
<tt class="variable">test</tt>.</blockquote>
<br>
<a name="@funs89"></a><a name="FN:update-fwrapper" id=
"FN:update-fwrapper"></a>
<div align="left">[Function]<br>
<tt class="function-name">fwrappers:</tt><tt class=
"function-name">update-fwrapper</tt> fwrapper
&nbsp;&nbsp;&nbsp;</div>
<blockquote>Update the funcallable instance function of the
fwrapper object <tt class="variable">fwrapper</tt> from the
definition of its function that was defined with <tt class=
"code">define-fwrapper</tt>. This can be used to update fwrappers
after changing a <tt class=
"code">define-fwrapper</tt>.</blockquote>
<br>
<a name="@funs90"></a><a name="FN:update-fwrappers" id=
"FN:update-fwrappers"></a>
<div align="left">[Function]<br>
<tt class="function-name">fwrappers:</tt><tt class=
"function-name">update-fwrappers</tt> function-name &amp;key type
test &nbsp;&nbsp;&nbsp;</div>
<blockquote>Update fwrappers of <tt class=
"variable">function-name</tt>; see <tt class=
"code">update-fwrapper</tt>. If <tt class="variable">type</tt> is
supplied, update fwrappers whose type is <tt class=
"code">equal</tt> to <tt class="variable">type</tt>. If <tt class=
"variable">test</tt> is supplied, update fwrappers satisfying
<tt class="variable">test</tt>.</blockquote>
<br>
<a name="@funs91"></a><a name="FN:set-fwrappers" id=
"FN:set-fwrappers"></a>
<div align="left">[Function]<br>
<tt class="function-name">fwrappers:</tt><tt class=
"function-name">set-fwrappers</tt> function-name fwrappers
&nbsp;&nbsp;&nbsp;</div>
<blockquote>Set <tt class="variable">function-names</tt>'s
fwrappers to elements of the list <tt class=
"variable">fwrappers</tt>, which is assumed to be ordered from
outermost to innermost. <tt class="variable">fwrappers</tt> null
means remove all fwrappers.</blockquote>
<br>
<a name="@funs92"></a><a name="FN:list-fwrappers" id=
"FN:list-fwrappers"></a>
<div align="left">[Function]<br>
<tt class="function-name">fwrappers:</tt><tt class=
"function-name">list-fwrappers</tt> function-name
&nbsp;&nbsp;&nbsp;</div>
<blockquote>Return a list of all fwrappers of <tt class=
"variable">function-name</tt>, ordered from outermost to
innermost.</blockquote>
<br>
<a name="@funs93"></a><a name="FN:push-fwrapper" id=
"FN:push-fwrapper"></a>
<div align="left">[Function]<br>
<tt class="function-name">fwrappers:</tt><tt class=
"function-name">push-fwrapper</tt> fwrapper function-name
&nbsp;&nbsp;&nbsp;</div>
<blockquote>Prepend fwrapper <tt class="variable">fwrapper</tt> to
the definition of <tt class="variable">function-name</tt>. Signal
an error if <tt class="variable">function-name</tt> is an undefined
function.</blockquote>
<br>
<a name="@funs94"></a><a name="FN:delete-fwrapper" id=
"FN:delete-fwrapper"></a>
<div align="left">[Function]<br>
<tt class="function-name">fwrappers:</tt><tt class=
"function-name">delete-fwrapper</tt> fwrapper function-name
&nbsp;&nbsp;&nbsp;</div>
<blockquote>Remove fwrapper <tt class="variable">fwrapper</tt> from
the definition of <tt class="variable">function-name</tt>. Signal
an error if <tt class="variable">function-name</tt> is an undefined
function.</blockquote>
<br>
<a name="@funs95"></a><a name="FN:do-fwrappers" id=
"FN:do-fwrappers"></a>
<div align="left">[Macro]<br>
<tt class="function-name">fwrappers:</tt><tt class=
"function-name">do-fwrappers</tt> (var fdefn <tt class=
"code">&amp;optional</tt>result) <tt class=
"code">&amp;body</tt>body &nbsp;&nbsp;&nbsp;</div>
<blockquote>Evaluate <tt class="variable">body</tt> with <tt class=
"variable">var</tt> bound to consecutive fwrappers of <tt class=
"variable">fdefn</tt>. Return <tt class="variable">result</tt> at
the end. Note that <tt class="variable">fdefn</tt> must be an
<tt class="code">fdefn</tt> object. You can use <tt class=
"code">kernel:fdefn-or-lose</tt>, for instance, to get the
<tt class="code">fdefn</tt> object from a function
name.</blockquote>
<a name="toc83" id="toc83"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc73" id="htoc73"><b><font size=
"5">2.26</font></b></a></td>
<td width="100%" align="center"><b><font size="5">Dynamic-Extent
Declarations</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept43"></a><br>
<em>Note: As of the 19a release,</em> <tt class=
"code"><em>dynamic-extent</em></tt> <em>is unfortunately disabled
by default. It is known to cause some issues with CLX and Hemlock.
The cause is not known, but causes random errors and brokeness.
Enable at your own risk. However, it is safe enough to build all of
CMUCL without problems.</em><br>
<br>
On x86 and sparc, CMUCL can exploit <tt class=
"code">dynamic-extent</tt> declarations by allocating objects on
the stack instead of the heap.<br>
<br>
You can tell CMUCL to trust or not trust <tt class=
"code">dynamic-extent</tt> declarations by setting the variable
<tt class="variable">*trust-dynamic-extent-declarations*</tt>.<br>
<br>
<br>
<a name="@vars23"></a><a name=
"VR:trust-dynamic-extent-declarations" id=
"VR:trust-dynamic-extent-declarations"></a>
<div align="left">[Variable]<br>
<tt class="function-name">ext:</tt><tt class=
"function-name">*trust-dynamic-extent-declarations*</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote>If the value of <tt class=
"variable">*trust-dynamic-extent-declarations*</tt> is <tt class=
"code">NIL</tt>, <tt class="code">dynamic-extent</tt> declarations
are effectively ignored.<br>
<br>
If the value of this variable is a function, the function is called
with four arguments to determine if a <tt class=
"code">dynamic-extent</tt> declaration should be trusted. The
arguments are the safety, space, speed, and debug settings at the
point where the <tt class="code">dynamic-extent</tt> declaration is
used. If the function returns true, the declaration is trusted,
otherwise it is not trusted.<br>
<br>
In all other cases, <tt class="code">dynamic-extent</tt>
declarations are trusted.</blockquote>
Please note that stack-allocation is inherently unsafe. If you make
a mistake, and a stack-allocated object or part of it escapes,
CMUCL is likely to crash, or format your hard disk.<br>
<br>
<a name="toc84" id="toc84"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc74" id="htoc74"><b><font size=
"4">2.26.1</font></b></a></td>
<td width="100%" align="center"><tt class="code"><b><font size=
"4">&amp;rest</font></b></tt> <b><font size="4">argument
lists</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept44"></a><br>
Rest argument lists can be allocated on the stack by declaring the
rest argument variable <tt class="code">dynamic-extent</tt>.
Examples:
<blockquote class="lisp">
<pre>
(defun foo (x &amp;rest rest)
  (declare (dynamic-extent rest))
  ...)

(defun bar ()
  (lambda (&amp;rest rest)
    (declare (dynamic-extent rest))
    ...))
</pre></blockquote>
<a name="toc85" id="toc85"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc75" id="htoc75"><b><font size=
"4">2.26.2</font></b></a></td>
<td width="100%" align="center"><b><font size=
"4">Closures</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept45"></a><br>
Closures for local functions can be allocated on the stack if the
local function is declared <tt class="code">dynamic-extent</tt>,
and the closure appears as an argument in the call of a named
function. In the example:
<blockquote class="lisp">
<pre>
(defun foo (x)
  (flet ((bar () x))
    (declare (dynamic-extent #'bar))
    (baz #'bar)))
</pre></blockquote>
the closure passed to function <tt class="code">baz</tt> is
allocated on the stack. Likewise in the example:
<blockquote class="lisp">
<pre>
(defun foo (x)
  (flet ((bar () x))
    (baz #'bar)
    (locally (declare (dynamic-extent #'bar))
      (baz #'bar))))
</pre></blockquote>
<a name="@concept46"></a> Stack-allocation of closures can also
automatically take place when calling certain known CL functions
taking function arguments, for example <tt class="code">some</tt>
or <tt class="code">find-if</tt>.<br>
<br>
<a name="toc86" id="toc86"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFE2">
<div align="center">
<table>
<tr>
<td><a name="htoc76" id="htoc76"><b><font size=
"4">2.26.3</font></b></a></td>
<td width="100%" align="center"><tt class="code"><b><font size=
"4">list</font></b></tt><b><font size="4">,</font></b> <tt class=
"code"><b><font size="4">list*</font></b></tt><b><font size="4">,
and</font></b> <tt class="code"><b><font size=
"4">cons</font></b></tt></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept47"></a><br>
New conses allocated by <tt class="code">list</tt>, <tt class=
"code">list*</tt>, or <tt class="code">cons</tt> which are used to
initialize variables can be allocated from the stack if the
variables are declared <tt class="code">dynamic-extent</tt>. In the
case of <tt class="code">cons</tt>, only the outermost cons cell is
allocated from the stack; this is an arbitrary restriction.
<blockquote class="lisp">
<pre>
(let ((x (list 1 2))
      (y (list* 1 2 x))
      (z (cons 1 (cons 2 nil))))
  (declare (dynamic-extent x y z))
  ...
  (setq x (list 2 3))
  ...)
</pre></blockquote>
Please note that the <tt class="code">setq</tt> of <tt class=
"code">x</tt> in the example program assigns to <tt class=
"code">x</tt> a list that is allocated from the heap. This is
another arbitrary restriction that exists because other Lisps
behave that way.<br>
<br>
<a name="toc87" id="toc87"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc77" id="htoc77"><b><font size=
"5">2.27</font></b></a></td>
<td width="100%" align="center"><b><font size="5">Modular
Arithmetic</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept48"></a><br>
This section is mostly taken, with permission, from the
documentation for SBCL.<br>
<br>
Some numeric functions have a property: <tt class="code">N</tt>
lower bits of the result depend only on <tt class="code">N</tt>
lower bits of (all or some) arguments. If the compiler sees an
expression of form <tt class="code">(logand exp mask)</tt>, where
<tt class="code">exp</tt> is a tree of such ``good'' functions and
<tt class="code">mask</tt> is known to be of type <tt class=
"code">(unsigned-byte w)</tt>, where <tt class="code">w</tt> is a
"good" width, all intermediate results will be cut to <tt class=
"code">w</tt> bits (but it is not done for variables and
constants!). This often results in an ability to use simple machine
instructions for the functions.<br>
<br>
Consider an example.
<blockquote class="lisp">
<pre>
(defun i (x y)
  (declare (type (unsigned-byte 32) x y))
  (ldb (byte 32 0) (logxor x (lognot y))))
</pre></blockquote>
The result of <tt class="code">(lognot y)</tt> will be negative and
of type <tt class="code">(signed-byte 33)</tt>, so a naive
implementation on a 32-bit platform is unable to use 32-bit
arithmetic here. But modular arithmetic optimizer is able to do it:
because the result is cut down to 32 bits, the compiler will
replace <tt class="code">logxor</tt> and <tt class=
"code">lognot</tt> with versions cutting results to 32 bits, and
because terminals (here---expressions <tt class="code">x</tt> and
<tt class="code">y</tt>) are also of type <tt class=
"code">(unsigned-byte 32)</tt>, 32-bit machine arithmetic can be
used.<br>
<br>
Currently ``good'' functions are <tt class="code">+</tt>,
<tt class="code">-</tt>, <tt class="code">*</tt>; <tt class=
"code">logand</tt>, <tt class="code">logior</tt>, <tt class=
"code">logxor</tt>, <tt class="code">lognot</tt> and their
combinations; and <tt class="code">ash</tt> with the positive
second argument. ``Good'' widths are 32 on HPPA, MIPS, PPC, Sparc
and X86 and 64 on Alpha. While it is possible to support smaller
widths as well, currently it is not implemented.<br>
<br>
A more extensive description of modular arithmetic can be found in
the paper ``Efficient Hardware Arithmetic in Common Lisp'' by
Alexey Dejneka, and Christophe Rhodes, to be published.<br>
<br>
<a name="toc88" id="toc88"></a>
<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td bgcolor="#FFFFD3">
<div align="center">
<table>
<tr>
<td><a name="htoc78" id="htoc78"><b><font size=
"5">2.28</font></b></a></td>
<td width="100%" align="center"><b><font size="5">Extension to
REQUIRE</font></b></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<a name="@concept49"></a><br>
The behavior of <tt class="code">require</tt> when called with only
one argument is implementation-defined. In CMUCL, functions from
the list <tt class="variable">*module-provider-functions*</tt> are
called in order with the stringified module name as the argument.
The first function to return non-<tt class="variable">NIL</tt> is
assumed to have loaded the module.<br>
<br>
By default the functions <tt class=
"code">module-provide-cmucl-defmodule</tt> and <tt class=
"code">module-provide- cmucl-library</tt> are on this list of
functions, in that order.<br>
<br>
<br>
<a name="@vars24"></a><a name="VR:module-provider-functions" id=
"VR:module-provider-functions"></a>
<div align="left">[Variable]<br>
<tt class="function-name">ext:</tt><tt class=
"function-name">*module-provider-functions*</tt>
&nbsp;&nbsp;&nbsp;</div>
<blockquote>This is a list of functions taking a single argument.
<tt class="code">require</tt> calls each function in turn with the
stringified module name. The first function to return
non-<tt class="variable">NIL</tt> indicates that the module has
been loaded. The remaining functions, if any, are not called.<br>
<br>
To add new providers, push the new provider function onto the
beginning of this list.</blockquote>
<br>
<a name="@funs96"></a><a name="FN:defmodule" id="FN:defmodule"></a>
<div align="left">[Macro]<br>
<tt class="function-name">ext:</tt><tt class=
"function-name">defmodule</tt> name <tt class="code">&amp;rest</tt>
files &nbsp;&nbsp;&nbsp;</div>
<blockquote>Defines a module by registering the files that need to
be loaded when the module is required. If <tt class=
"variable">name</tt> is a symbol, its print name is used after
downcasing it.</blockquote>
<br>
<a name="@funs97"></a><a name="FN:module-provide-cmucl-defmodule"
id="FN:module-provide-cmucl-defmodule"></a>
<div align="left">[Function]<br>
<tt class="function-name">ext:</tt><tt class=
"function-name">module-provide-cmucl-defmodule</tt> module-name
&nbsp;&nbsp;&nbsp;</div>
<blockquote>This function is the module-provider for modules
registered by a <tt class="code">ext:defmodule</tt>
form.</blockquote>
<br>
<a name="@funs98"></a><a name="FN:module-provide-cmucl-library" id=
"FN:module-provide-cmucl-library"></a>
<div align="left">[Function]<br>
<tt class="function-name">ext:</tt><tt class=
"function-name">module-provide-cmucl-library</tt> module-name
&nbsp;&nbsp;&nbsp;</div>
<blockquote>This function is the module-provider for CMUCL's
libraries, including Gray streams, simple streams, CLX, CLM,
Hemlock, <em>etc</em>.<br>
<br>
This function causes a file to be loaded whose name is formed by
merging the search-list ``modules:'' and the concatenation of
module-name with the suffix ``-LIBRARY''. Note that both the
module-name and the suffix are each, separately, converted from
:case :common to :case :local. This merged name will be probed with
both a .lisp and .fasl extensions, calling <tt class=
"code">LOAD</tt> if it exists.</blockquote>
<hr width="50%" size="1">
<dl>
<dt><a name="note1" href="#text1" id="note1"><font size=
"5">1</font></a></dt>
<dd>This implementation was donated by Paul Foley</dd>
<dt><a name="note2" href="#text2" id="note2"><font size=
"5">2</font></a></dt>
<dd>The generator described here is available if the feature
<tt class="code">:new-random</tt> is available.</dd>
<dt><a name="note3" href="#text3" id="note3"><font size=
"5">3</font></a></dt>
<dd>``Mersenne Twister: A 623-Dimensionally Equidistributed Uniform
Pseudorandom Number Generator,'' ACM Trans. on Modeling and
Computer Simulation, Vol. 8, No. 1, January 1998, pp.3--30</dd>
<dt><a name="note4" href="#text4" id="note4"><font size=
"5">4</font></a></dt>
<dd>This feature was independently developed, but the interface is
modelled after a similar feature in Allegro. Some names, however,
have been changed.</dd>
</dl>
<hr>
<a href="introduction.html"><img src="previous_motif.gif" alt=
"Previous"></a> <a href="index.html"><img src="contents_motif.gif"
alt="Up"></a> <a href="debugger.html"><img src="next_motif.gif"
alt="Next"></a>
</body>
</html>
