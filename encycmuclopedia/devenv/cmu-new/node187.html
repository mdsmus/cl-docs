<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.2//EN">
<!--Converted with LaTeX2HTML 96.1-h (September 30, 1996) by Nikos Drakos (nikos@cbl.leeds.ac.uk), CBLU, University of Leeds -->
<HTML>
<HEAD>
<TITLE>5.13.2 Efficiency Notes and Type Checking</TITLE>
<META NAME="description" CONTENT="5.13.2 Efficiency Notes and Type Checking">
<META NAME="keywords" CONTENT="cmu-new">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<LINK REL=STYLESHEET HREF="cmu-new.css">
</HEAD>
<BODY LANG="EN" >
 <A NAME="tex2html3052" HREF="node188.html"><IMG WIDTH=37 HEIGHT=24 ALIGN=BOTTOM ALT="next" SRC="next_motif.gif"></A> <A NAME="tex2html3050" HREF="node185.html"><IMG WIDTH=26 HEIGHT=24 ALIGN=BOTTOM ALT="up" SRC="up_motif.gif"></A> <A NAME="tex2html3044" HREF="node186.html"><IMG WIDTH=63 HEIGHT=24 ALIGN=BOTTOM ALT="previous" SRC="previous_motif.gif"></A> <A NAME="tex2html3054" HREF="node1.html"><IMG WIDTH=65 HEIGHT=24 ALIGN=BOTTOM ALT="contents" SRC="contents_motif.gif"></A> <A NAME="tex2html3055" HREF="node267.html"><IMG WIDTH=43 HEIGHT=24 ALIGN=BOTTOM ALT="index" SRC="index_motif.gif"></A> <BR>
<B> Next:</B> <A NAME="tex2html3053" HREF="node188.html">5.13.3 Representation Efficiency Notes</A>
<B>Up:</B> <A NAME="tex2html3051" HREF="node185.html">5.13 Efficiency Notes</A>
<B> Previous:</B> <A NAME="tex2html3045" HREF="node186.html">5.13.1 Type Uncertainty</A>
<BR> <P>
<H2><A NAME="SECTION006132000000000000000">5.13.2 Efficiency Notes and Type Checking</A></H2>
<P>
<A NAME="10754">&#160;</A>
<A NAME="10755">&#160;</A>
<A NAME="10756">&#160;</A>
<P>
It is important that the <tt>eff-note</tt> example above used
<tt>(safety 0)</tt>.  When type checking is enabled, you may get apparently
spurious efficiency notes.  With <tt>(safety 1)</tt>, the note has this extra
line on the end:
<BLOCKQUOTE> <PRE>The result is a (INTEGER -1610612736 1610612733), not a FIXNUM.
</PRE> </BLOCKQUOTE>
This seems strange, since there is a <tt>the</tt> declaration on the result of that
second addition.
<P>
In fact, the inefficiency is real, and is a consequence of Python's
treating declarations as assertions to be verified.  The compiler
can't assume that the result type declaration is true--it must
generate the result and then test whether it is of the appropriate
type.
<P>
In practice, this means that when you are tuning a program to run
without type checks, you should work from the efficiency notes
generated by unsafe compilation.  If you want code to run efficiently
with type checking, then you should pay attention to all the
efficiency notes that you get during safe compilation.  Since user
supplied output type assertions (e.g., from <tt>the</tt>) are
disregarded when selecting operation implementations for safe code,
you must somehow give the compiler information that allows it to prove
that the result truly must be of a good type.  In our example, it
could be done by constraining the argument types more:
<BLOCKQUOTE> <PRE>(defun eff-note (x y z)
  (declare (type (unsigned-byte 18) x y z))
  (+ x y z))
</PRE> </BLOCKQUOTE>
Of course, this declaration is acceptable only if the arguments to <tt>eff-note</tt>
always <i>are</i> <tt>(unsigned-byte 18)</tt> integers.
<P>
<BR> <HR>
<P><ADDRESS>
<I>Raymond Toy <BR>
Mon Sep 22 16:34:07 EDT 1997</I>
</ADDRESS>
</BODY>
</HTML>
