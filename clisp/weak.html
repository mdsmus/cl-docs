<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>31.7. Weak Objects</title><link rel="stylesheet" href="impnotes.css" type="text/css" /><link rev="made" href="mailto:clisp-list@lists.sourceforge.net" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot_7566" /><link rel="start" href="index.html" title="Implementation Notes for GNU CLISP" /><link rel="up" href="ext-p-indep.html" title="Chapter 31. Platform Independent Extensions" /><link rel="prev" href="gstream.html" title="31.6. Generic streams" /><link rel="next" href="final.html" title="31.8. Finalization" /><link rel="copyright" href="legalese.html" title="Legal Status of the CLISP Implementation Notes" /><meta name="date" content="'generated: 2008-07-02 11:52:30-04:00'" /><link rel="author" title="Authors" href="index.html#authors" /><link rel="contents" title="Table of Contents" href="index.html" /><link rel="glossary" href="glossary.html" /><link rel="help" href="faq.html#faq-help" title="How do I ask for help?" /><link rel="home" title="Home" href="http://clisp.cons.org" /><link rel="index" href="idx.html" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">31.7. Weak Objects</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="gstream.html">Prev</a> </td><th width="60%" align="center">Chapter 31. Platform Independent Extensions</th><td width="20%" align="right"> <a accesskey="n" href="final.html">Next</a></td></tr></table><hr /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="weak"></a>31.7. Weak Objects</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="weak.html#weak-pointer">31.7.1. Weak Pointers</a></span></dt><dt><span class="section"><a href="weak.html#weak-list">31.7.2. Weak Lists</a></span></dt><dt><span class="section"><a href="weak.html#weak-and-relation">31.7.3. Weak And Relations</a></span></dt><dt><span class="section"><a href="weak.html#weak-or-relation">31.7.4. Weak Or Relations</a></span></dt><dt><span class="section"><a href="weak.html#weak-mapping">31.7.5. Weak Associations</a></span></dt><dt><span class="section"><a href="weak.html#weak-and-mapping">31.7.6. Weak And Mappings</a></span></dt><dt><span class="section"><a href="weak.html#weak-or-mapping">31.7.7. Weak Or Mappings</a></span></dt><dt><span class="section"><a href="weak.html#weak-alist">31.7.8. Weak Association Lists</a></span></dt><dt><span class="section"><a href="weak.html#weak-ht">31.7.9. Weak Hash Tables</a></span></dt></dl></div><p>Recall two terms: An object is called “<span class="quote">"alive"</span>” as
 long as it can be retrieved by the user or program, through any kind of
 references, starting from global and local variables. (Objects that
 consume no heap storage, also known as “<span class="quote">"immediate
 objects"</span>”, such as <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/syscla_character.html" target="_top"><code class="classname">CHARACTER</code></a>s, <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/typ_fixnum.html" target="_top"><code class="classname">FIXNUM</code></a>s, and
 <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/typ_short-flo_m_long-float.html" target="_top"><code class="classname">SHORT-FLOAT</code></a>s, are alive indefinitely.) An object is said to be
 <a href="gc.html" class="olink">garbage-collect</a>ed when its storage is reclaimed, at some moment after it becomes
 “<span class="quote">"dead"</span>”.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="weak-pointer"></a>31.7.1. Weak Pointers</h3></div></div></div><p>A <a class="link" href="weak.html#weak-pointer" title="31.7.1. Weak Pointers"><code class="classname">EXT:WEAK-POINTER</code></a> is an object holding a reference to a given object,
 without keeping the latter from being <a href="gc.html" class="olink">garbage-collect</a>ed.</p><div class="variablelist"><p class="title"><b>Weak Pointer API</b></p><dl><dt><span class="term"><code class="code">(<code class="function">EXT:MAKE-WEAK-POINTER</code>
   <em class="replaceable"><code>value</code></em>)</code></span></dt><dd>returns a <a class="" href="http://www.lisp.org/HyperSpec/Body/glo_f.html#fresh">fresh</a> <a class="link" href="weak.html#weak-pointer" title="31.7.1. Weak Pointers"><code class="classname">EXT:WEAK-POINTER</code></a> referring to
   <em class="replaceable"><code>value</code></em>.</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-POINTER-P</code> <em class="replaceable"><code>object</code></em>)</code></span></dt><dd>returns true if the <em class="replaceable"><code>object</code></em> is of type
   <a class="link" href="weak.html#weak-pointer" title="31.7.1. Weak Pointers"><code class="classname">EXT:WEAK-POINTER</code></a>.</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-POINTER-VALUE</code>
   <em class="replaceable"><code>weak-pointer</code></em>)</code></span></dt><dd>returns two values: The original value and <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a>,
   if the value has not yet been <a href="gc.html" class="olink">garbage-collect</a>ed, else <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> and <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>.
   It is <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/mac_setfcm_psetf.html" target="_top"><code class="function">SETF</code></a>-able: you can change the value that the weak pointer
   points to.</dd></dl></div><p>Weak pointers are useful for notification-based communication
 protocols between software modules, e.g. when a change to an object
 <em class="replaceable"><code>x</code></em> requires a notification to an object <em class="replaceable"><code>y</code></em>, as long as <em class="replaceable"><code>y</code></em> is
 alive.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="weak-list"></a>31.7.2. Weak Lists</h3></div></div></div><p>A <a class="link" href="weak.html#weak-list" title="31.7.2. Weak Lists"><code class="classname">EXT:WEAK-LIST</code></a> is an ordered collection of references to objects
 that does <span class="strong"><strong>not</strong></span> keep the objects from being <a href="gc.html" class="olink">garbage-collect</a>ed. It is
 semantically equivalent to a list of <a class="link" href="weak.html#weak-pointer" title="31.7.1. Weak Pointers"><code class="classname">EXT:WEAK-POINTER</code></a>s, however with a
 more efficient in-memory representation than a plain list of
 <a class="link" href="weak.html#weak-pointer" title="31.7.1. Weak Pointers"><code class="classname">EXT:WEAK-POINTER</code></a>s would be.</p><div class="variablelist"><p class="title"><b>Weak List API</b></p><dl><dt><span class="term"><code class="code">(<code class="function">EXT:MAKE-WEAK-LIST</code> <em class="replaceable"><code>list</code></em>)</code></span></dt><dd>creates a <a class="link" href="weak.html#weak-list" title="31.7.2. Weak Lists"><code class="classname">EXT:WEAK-LIST</code></a> pointing to each of the
   elements in the given <em class="replaceable"><code>list</code></em>.</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-LIST-P</code> <em class="replaceable"><code>object</code></em>)</code></span></dt><dd>returns true if the <em class="replaceable"><code>object</code></em> is of type
   <a class="link" href="weak.html#weak-list" title="31.7.2. Weak Lists"><code class="classname">EXT:WEAK-LIST</code></a>.</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-LIST-LIST</code>
   <em class="replaceable"><code>weak-list</code></em>)</code></span></dt><dd>returns a <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/syscla_list.html" target="_top"><code class="classname">LIST</code></a> of those objects from the
   <em class="replaceable"><code>weak-list</code></em> that are still
   alive.</dd><dt><span class="term"><code class="code">(<a class="ulink" href="http://www.lisp.org/HyperSpec/Body/mac_setfcm_psetf.html" target="_top"><code class="function">SETF</code></a> (<code class="function">EXT:WEAK-LIST-LIST</code>
   <em class="replaceable"><code>weak-list</code></em>) <em class="replaceable"><code>list</code></em>)</code></span></dt><dd>replaces the list of objects stored by the
   <em class="replaceable"><code>weak-list</code></em>.</dd></dl></div><p>Weak lists are useful for notification based communication
 protocols between software modules, e.g. when a change to an object
 <em class="replaceable"><code>x</code></em> requires a notification to objects <em class="replaceable"><code>k<sub>1</sub></code></em>, <em class="replaceable"><code>k<sub>2</sub></code></em>, ..., as long
 as such a particular <em class="replaceable"><code>k<sub>n</sub></code></em> is alive.</p><p>A <a class="link" href="weak.html#weak-list" title="31.7.2. Weak Lists"><code class="classname">EXT:WEAK-LIST</code></a> with a single element is semantically equivalent to a
 single <a class="link" href="weak.html#weak-pointer" title="31.7.1. Weak Pointers"><code class="classname">EXT:WEAK-POINTER</code></a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="weak-and-relation"></a>31.7.3. Weak “<span class="quote">And</span>” Relations</h3></div></div></div><p>A weak “<span class="quote">and</span>” relation is an ordered collection of
 references to objects, that does <span class="strong"><strong>not</strong></span> keep the objects from being
 <a href="gc.html" class="olink">garbage-collect</a>ed, and which allows access to all the objects as long as all of
 them are still alive. As soon as one of them is <a href="gc.html" class="olink">garbage-collect</a>ed, the entire
 collection of objects becomes empty.</p><div class="variablelist"><p class="title"><b>Weak “<span class="quote">And</span>” Relation API</b></p><dl><dt><span class="term"><code class="code">(<code class="function">EXT:MAKE-WEAK-AND-RELATION</code>
   <em class="replaceable"><code>list</code></em>)</code></span></dt><dd>creates a <a class="link" href="weak.html#weak-and-relation" title="31.7.3. Weak And Relations"><code class="classname">EXT:WEAK-AND-RELATION</code></a> between the objects in
   the given <em class="replaceable"><code>list</code></em>.</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-AND-RELATION-P</code>
   <em class="replaceable"><code>object</code></em>)</code></span></dt><dd>returns true if the <em class="replaceable"><code>object</code></em> is of type
   <a class="link" href="weak.html#weak-and-relation" title="31.7.3. Weak And Relations"><code class="classname">EXT:WEAK-AND-RELATION</code></a>.</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-AND-RELATION-LIST</code>
   <em class="replaceable"><code>weak-and-relation</code></em>)</code></span></dt><dd>returns the list of objects stored in the
   <em class="replaceable"><code>weak-and-relation</code></em>. The returned list must not
   be destructively modified.</dd></dl></div><p><a class="link" href="weak.html#weak-and-relation" title="31.7.3. Weak And Relations"><code class="classname">EXT:WEAK-AND-RELATION</code></a>s are useful to model relations between objects
 that become worthless when one of the objects dies.</p><p>A <a class="link" href="weak.html#weak-and-relation" title="31.7.3. Weak And Relations"><code class="classname">EXT:WEAK-AND-RELATION</code></a> with a single element is semantically
 equivalent to a <a class="link" href="weak.html#weak-pointer" title="31.7.1. Weak Pointers"><code class="classname">EXT:WEAK-POINTER</code></a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="weak-or-relation"></a>31.7.4. Weak “<span class="quote">Or</span>” Relations</h3></div></div></div><p>A weak “<span class="quote">or</span>” relation is an ordered collection of
 references to objects, that keeps all objects from being <a href="gc.html" class="olink">garbage-collect</a>ed as long
 as one of them is still alive. In other words, each of them keeps all
 others among them from being <a href="gc.html" class="olink">garbage-collect</a>ed. When all of them are unreferenced,
 the collection of objects becomes empty.</p><div class="variablelist"><p class="title"><b>Weak “<span class="quote">Or</span>” Relation API</b></p><dl><dt><span class="term"><code class="code">(<code class="function">EXT:MAKE-WEAK-OR-RELATION</code>
   <em class="replaceable"><code>list</code></em>)</code></span></dt><dd>creates a <a class="link" href="weak.html#weak-or-relation" title="31.7.4. Weak Or Relations"><code class="classname">EXT:WEAK-OR-RELATION</code></a> between the objects in
   the given <em class="replaceable"><code>list</code></em>.</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-OR-RELATION-P</code>
   <em class="replaceable"><code>object</code></em>)</code></span></dt><dd>returns true if the <em class="replaceable"><code>object</code></em> is of type
   <a class="link" href="weak.html#weak-or-relation" title="31.7.4. Weak Or Relations"><code class="classname">EXT:WEAK-OR-RELATION</code></a>.</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-OR-RELATION-LIST</code>
   <em class="replaceable"><code>weak-or-relation</code></em>)</code></span></dt><dd>returns the list of objects stored in the
   <em class="replaceable"><code>weak-or-relation</code></em>. The returned list must not
   be destructively modified.</dd></dl></div><p><a class="link" href="weak.html#weak-or-relation" title="31.7.4. Weak Or Relations"><code class="classname">EXT:WEAK-OR-RELATION</code></a>s are useful to model relations between objects
 that do not become worthless when one of the objects dies.</p><p>A <a class="link" href="weak.html#weak-or-relation" title="31.7.4. Weak Or Relations"><code class="classname">EXT:WEAK-OR-RELATION</code></a> with a single element is semantically
 equivalent to a <a class="link" href="weak.html#weak-pointer" title="31.7.1. Weak Pointers"><code class="classname">EXT:WEAK-POINTER</code></a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="weak-mapping"></a>31.7.5. Weak Associations</h3></div></div></div><p>A weak association is a mapping from an object called <em class="replaceable"><code>key</code></em> to
 an object called <em class="replaceable"><code>value</code></em>, that exists as long as the key is alive. In
 other words, as long as the key is alive, it keeps the value from being
 <a href="gc.html" class="olink">garbage-collect</a>ed.</p><div class="variablelist"><p class="title"><b>Weak Association API</b></p><dl><dt><span class="term"><code class="code">(<code class="function">EXT:MAKE-WEAK-MAPPING</code>
   <em class="replaceable"><code>key</code></em> <em class="replaceable"><code>value</code></em>)</code></span></dt><dd>creates a <a class="link" href="weak.html#weak-mapping" title="31.7.5. Weak Associations"><code class="classname">EXT:WEAK-MAPPING</code></a>.
</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-MAPPING-P</code>
   <em class="replaceable"><code>object</code></em>)</code></span></dt><dd>returns true if the object is of type
   <a class="link" href="weak.html#weak-mapping" title="31.7.5. Weak Associations"><code class="classname">EXT:WEAK-MAPPING</code></a>.</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-MAPPING-PAIR</code>
   <em class="replaceable"><code>weak-mapping</code></em>)</code></span></dt><dd>returns three values: the original key, the original
   value, and <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a>, if the key has not yet been <a href="gc.html" class="olink">garbage-collect</a>ed, else <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>, <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>,
   <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>.</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-MAPPING-VALUE</code>
   <em class="replaceable"><code>weak-mapping</code></em>)</code></span></dt><dd>returns the value, if the key has not yet been <a href="gc.html" class="olink">garbage-collect</a>ed,
   else <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>.</dd><dt><span class="term"><code class="code">(<a class="ulink" href="http://www.lisp.org/HyperSpec/Body/mac_setfcm_psetf.html" target="_top"><code class="function">SETF</code></a> (<code class="function">EXT:WEAK-MAPPING-VALUE</code>
   <em class="replaceable"><code>weak-mapping</code></em>) <em class="replaceable"><code>value</code></em>)</code></span></dt><dd>replaces the value stored in the
   <em class="replaceable"><code>weak-mapping</code></em>. It has no effect when the
   key has already been <a href="gc.html" class="olink">garbage-collect</a>ed.</dd></dl></div><p>Weak associations are useful to supplement objects with additional
 information that is stored outside of the object.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="weak-and-mapping"></a>31.7.6. Weak “<span class="quote">And</span>” Mappings</h3></div></div></div><p>A weak “<span class="quote">and</span>” mapping is a mapping from a tuple of
 objects called <em class="replaceable"><code>keys</code></em> to an object called <em class="replaceable"><code>value</code></em>, that does
 <span class="strong"><strong>not</strong></span> keep the keys from being <a href="gc.html" class="olink">garbage-collect</a>ed and that exists as long as all
 keys are alive. As soon as one of the keys is <a href="gc.html" class="olink">garbage-collect</a>ed, the entire
 mapping goes away.</p><div class="variablelist"><p class="title"><b>Weak “<span class="quote">And</span>” Mapping API</b></p><dl><dt><span class="term"><code class="code">(<code class="function">EXT:MAKE-WEAK-AND-MAPPING</code>
   <em class="replaceable"><code>keys</code></em> <em class="replaceable"><code>value</code></em>)</code></span></dt><dd>creates a <a class="link" href="weak.html#weak-and-mapping" title="31.7.6. Weak And Mappings"><code class="classname">EXT:WEAK-AND-MAPPING</code></a> between the <em class="replaceable"><code>keys</code></em>
   objects in the given list and the given <em class="replaceable"><code>value</code></em>.
   The <em class="replaceable"><code>keys</code></em> list must be non-empty.</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-AND-MAPPING-P</code>
   <em class="replaceable"><code>object</code></em>)</code></span></dt><dd>returns true if the <em class="replaceable"><code>object</code></em> is of type
   <a class="link" href="weak.html#weak-and-mapping" title="31.7.6. Weak And Mappings"><code class="classname">EXT:WEAK-AND-MAPPING</code></a>.</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-AND-MAPPING-PAIR</code>
   <em class="replaceable"><code>weak-and-mapping</code></em>)</code></span></dt><dd>returns three values: the list of keys, the value,
   and <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a>, if none of the keys have been <a href="gc.html" class="olink">garbage-collect</a>ed, else <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>, <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>, <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>.
   The returned keys list must not be destructively modified.
</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-AND-MAPPING-VALUE</code>
   <em class="replaceable"><code>weak-and-mapping</code></em>)</code></span></dt><dd>returns the value, if none of the keys have been
   <a href="gc.html" class="olink">garbage-collect</a>ed, else <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>.</dd><dt><span class="term"><code class="code">(<a class="ulink" href="http://www.lisp.org/HyperSpec/Body/mac_setfcm_psetf.html" target="_top"><code class="function">SETF</code></a>
   (<code class="function">EXT:WEAK-AND-MAPPING-VALUE</code>
   <em class="replaceable"><code>weak-and-mapping</code></em>) <em class="replaceable"><code>value</code></em>)</code></span></dt><dd>replaces the value stored in the
   <em class="replaceable"><code>weak-and-mapping</code></em>. It has no effect when
   some key has already been <a href="gc.html" class="olink">garbage-collect</a>ed.</dd></dl></div><p><a class="link" href="weak.html#weak-and-mapping" title="31.7.6. Weak And Mappings"><code class="classname">EXT:WEAK-AND-MAPPING</code></a>s are useful to model properties of sets of
 objects that become worthless when one of the objects dies.</p><p>A <a class="link" href="weak.html#weak-and-mapping" title="31.7.6. Weak And Mappings"><code class="classname">EXT:WEAK-AND-MAPPING</code></a> with a single key is semantically equivalent
 to a weak association.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="weak-or-mapping"></a>31.7.7. Weak “<span class="quote">Or</span>” Mappings</h3></div></div></div><p>A weak “<span class="quote">or</span>” mapping is a mapping from a tuple of
 objects called <em class="replaceable"><code>keys</code></em> to an object called <em class="replaceable"><code>value</code></em>, that keeps all
 keys and the value from being <a href="gc.html" class="olink">garbage-collect</a>ed as long as one of the keys is
 still alive. In other words, each of the keys keeps all others among
 them and the value from being <a href="gc.html" class="olink">garbage-collect</a>ed.  When all of them are
 unreferenced, the entire mapping goes away.</p><div class="variablelist"><p class="title"><b>Weak “<span class="quote">Or</span>” Mapping API</b></p><dl><dt><span class="term"><code class="code">(<code class="function">EXT:MAKE-WEAK-OR-MAPPING</code>
   <em class="replaceable"><code>keys</code></em> <em class="replaceable"><code>value</code></em>)</code></span></dt><dd> creates a <a class="link" href="weak.html#weak-or-mapping" title="31.7.7. Weak Or Mappings"><code class="classname">EXT:WEAK-OR-MAPPING</code></a> between the
   <em class="replaceable"><code>keys</code></em> objects in the given list and the given
   <em class="replaceable"><code>value</code></em>. The <em class="replaceable"><code>keys</code></em> list must be
   non-empty.</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-OR-MAPPING-P</code>
   <em class="replaceable"><code>object</code></em>)</code></span></dt><dd>returns true if the <em class="replaceable"><code>object</code></em> is of type
   <a class="link" href="weak.html#weak-or-mapping" title="31.7.7. Weak Or Mappings"><code class="classname">EXT:WEAK-OR-MAPPING</code></a>.</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-OR-MAPPING-PAIR</code>
   <em class="replaceable"><code>weak-or-mapping</code></em>)</code></span></dt><dd>returns three values: the list of keys, the value,
   and <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a>, if the keys have not yet been <a href="gc.html" class="olink">garbage-collect</a>ed, else <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>, <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>, <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>.
   The returned keys list must not be destructively modified.
</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-OR-MAPPING-VALUE</code>
   <em class="replaceable"><code>weak-or-mapping</code></em>)</code></span></dt><dd>returns the value, if the keys have not yet been <a href="gc.html" class="olink">garbage-collect</a>ed,
   else <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>.</dd><dt><span class="term"><code class="code">(<a class="ulink" href="http://www.lisp.org/HyperSpec/Body/mac_setfcm_psetf.html" target="_top"><code class="function">SETF</code></a> (<code class="function">EXT:WEAK-OR-MAPPING-VALUE</code>
   <em class="replaceable"><code>weak-or-mapping</code></em>) <em class="replaceable"><code>value</code></em>)</code></span></dt><dd>replaces the value stored in the
   <em class="replaceable"><code>weak-or-mapping</code></em>. It has no effect when the
   keys have already been <a href="gc.html" class="olink">garbage-collect</a>ed.</dd></dl></div><p><a class="link" href="weak.html#weak-or-mapping" title="31.7.7. Weak Or Mappings"><code class="classname">EXT:WEAK-OR-MAPPING</code></a>s are useful to model properties of sets of
 objects that do not become worthless when one of the objects dies.</p><p>A <a class="link" href="weak.html#weak-or-mapping" title="31.7.7. Weak Or Mappings"><code class="classname">EXT:WEAK-OR-MAPPING</code></a> with a single key is semantically equivalent
 to a weak association.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="weak-alist"></a>31.7.8. Weak Association Lists</h3></div></div></div><p>A weak association list is an ordered collection of pairs, each
 pair being built from an object called <em class="replaceable"><code>key</code></em> and an object called
 <em class="replaceable"><code>value</code></em>.  The lifetime of each pair depends on the type of the weak
 <a class="" href="http://www.lisp.org/HyperSpec/Body/glo_a.html#association_list">association list</a>:
</p><div class="variablelist"><dl><dt><span class="term"><code class="constant">:KEY</code></span></dt><dd>The pair exists as long as the <em class="replaceable"><code>key</code></em> is not <a href="gc.html" class="olink">garbage-collect</a>ed.
    As long as the <em class="replaceable"><code>key</code></em> is alive, it prevents the <em class="replaceable"><code>value</code></em> from
    being <a href="gc.html" class="olink">garbage-collect</a>ed.</dd><dt><span class="term"><code class="constant">:VALUE</code></span></dt><dd>The pair exists as long as the <em class="replaceable"><code>value</code></em> is not <a href="gc.html" class="olink">garbage-collect</a>ed.
   As long as the <em class="replaceable"><code>value</code></em> is alive, it prevents the <em class="replaceable"><code>key</code></em> from
   being <a href="gc.html" class="olink">garbage-collect</a>ed.</dd><dt><span class="term"><code class="constant">:KEY-AND-VALUE</code></span></dt><dd>The pair exists as long as the <em class="replaceable"><code>key</code></em> and the <em class="replaceable"><code>value</code></em>
   are alive.
 </dd><dt><span class="term"><code class="constant">:KEY-OR-VALUE</code></span></dt><dd>The pair exists as long as the <em class="replaceable"><code>key</code></em> or the <em class="replaceable"><code>value</code></em>
   are alive.  As long as the <em class="replaceable"><code>key</code></em> is alive, it prevents the <em class="replaceable"><code>value</code></em>
   from being <a href="gc.html" class="olink">garbage-collect</a>ed, and as long as the <em class="replaceable"><code>value</code></em> is alive, it prevents the
   <em class="replaceable"><code>key</code></em> from being <a href="gc.html" class="olink">garbage-collect</a>ed.</dd></dl></div><p>
In other words, each pair is:
</p><div class="variablelist"><dl><dt><span class="term"><code class="constant">:KEY</code></span></dt><dd>a <a class="link" href="weak.html#weak-mapping" title="31.7.5. Weak Associations"><code class="classname">EXT:WEAK-MAPPING</code></a> from the <em class="replaceable"><code>key</code></em> to the <em class="replaceable"><code>value</code></em>,
 </dd><dt><span class="term"><code class="constant">:VALUE</code></span></dt><dd>a <a class="link" href="weak.html#weak-mapping" title="31.7.5. Weak Associations"><code class="classname">EXT:WEAK-MAPPING</code></a> from the <em class="replaceable"><code>value</code></em> to the <em class="replaceable"><code>key</code></em>,
 </dd><dt><span class="term"><code class="constant">:KEY-AND-VALUE</code></span></dt><dd>a <a class="link" href="weak.html#weak-and-relation" title="31.7.3. Weak And Relations"><code class="classname">EXT:WEAK-AND-RELATION</code></a> of the <em class="replaceable"><code>key</code></em> and the <em class="replaceable"><code>value</code></em>,
 </dd><dt><span class="term"><code class="constant">:KEY-OR-VALUE</code></span></dt><dd>a <a class="link" href="weak.html#weak-or-relation" title="31.7.4. Weak Or Relations"><code class="classname">EXT:WEAK-OR-RELATION</code></a> of the <em class="replaceable"><code>key</code></em> and the <em class="replaceable"><code>value</code></em>.
 </dd></dl></div><div class="variablelist"><p class="title"><b>Weak Association List API</b></p><dl><dt><span class="term"><code class="code">(<code class="function">EXT:MAKE-WEAK-ALIST</code>
   :type :initial-contents)</code></span></dt><dd>creates a <a class="link" href="weak.html#weak-alist" title="31.7.8. Weak Association Lists"><code class="classname">EXT:WEAK-ALIST</code></a>. The <em class="replaceable"><code>type</code></em> argument
   must be one of the four aforementioned types; the default is <code class="constant">:KEY</code>.
   The <em class="replaceable"><code>initial-contents</code></em> argument must be an
   <a class="" href="http://www.lisp.org/HyperSpec/Body/glo_a.html#association_list">association list</a>.</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-ALIST-P</code> <em class="replaceable"><code>object</code></em>)</code></span></dt><dd>returns true if the <em class="replaceable"><code>object</code></em> is of type
   <a class="link" href="weak.html#weak-alist" title="31.7.8. Weak Association Lists"><code class="classname">EXT:WEAK-ALIST</code></a>.</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-ALIST-TYPE</code>
   <em class="replaceable"><code>weak-alist</code></em>)</code></span></dt><dd>returns the type of the
   <em class="replaceable"><code>weak-alist</code></em>.</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-ALIST-CONTENTS</code>
   <em class="replaceable"><code>weak-alist</code></em>)</code></span></dt><dd>returns an <a class="" href="http://www.lisp.org/HyperSpec/Body/glo_a.html#association_list">association list</a> that corresponds to the current
   contents of the <em class="replaceable"><code>weak-alist</code></em>.
</dd><dt><span class="term"><code class="code">(<a class="ulink" href="http://www.lisp.org/HyperSpec/Body/mac_setfcm_psetf.html" target="_top"><code class="function">SETF</code></a> (<code class="function">EXT:WEAK-ALIST-CONTENTS</code>
   <em class="replaceable"><code>weak-alist</code></em>)
   <em class="replaceable"><code>contents</code></em>)</code></span></dt><dd>replaces the contents of a
   <em class="replaceable"><code>weak-alist</code></em>. The
   <em class="replaceable"><code>contents</code></em> argument must be an
   <a class="" href="http://www.lisp.org/HyperSpec/Body/glo_a.html#association_list">association list</a>.</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-ALIST-ASSOC</code> <em class="replaceable"><code>item</code></em>
   <em class="replaceable"><code>weak-alist</code></em>
   [:test] [:test-not] [:key])</code></span></dt><dd>is equivalent to
   <code class="code">(<a class="ulink" href="http://www.lisp.org/HyperSpec/Body/fun_assoccm_a_assoc-if-not.html" target="_top"><code class="function">ASSOC</code></a> <em class="replaceable"><code>item</code></em> (<code class="function">EXT:WEAK-ALIST-CONTENTS</code>
    <em class="replaceable"><code>weak-alist</code></em>)
    [:test] [:test-not] [:key])</code>.
</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-ALIST-RASSOC</code> <em class="replaceable"><code>item</code></em>
   <em class="replaceable"><code>weak-alist</code></em>
   [:test] [:test-not] [:key])</code></span></dt><dd>is equivalent to
   <code class="code">(<a class="ulink" href="http://www.lisp.org/HyperSpec/Body/fun_rassoccm__assoc-if-not.html" target="_top"><code class="function">RASSOC</code></a> <em class="replaceable"><code>item</code></em> (<code class="function">EXT:WEAK-ALIST-CONTENTS</code>
    <em class="replaceable"><code>weak-alist</code></em>)
    [:test] [:test-not] [:key])</code>.
</dd><dt><span class="term"><code class="code">(<code class="function">EXT:WEAK-ALIST-VALUE</code> <em class="replaceable"><code>item</code></em>
   <em class="replaceable"><code>weak-alist</code></em> [:test] [:test-not])</code></span></dt><dd>is equivalent to
   <code class="code">(<a class="ulink" href="http://www.lisp.org/HyperSpec/Body/acc_carcm_cdr_darcm_cddddr.html" target="_top"><code class="function">CDR</code></a> (<code class="function">EXT:WEAK-LIST-ASSOC</code>
    <em class="replaceable"><code>item</code></em> <em class="replaceable"><code>weak-alist</code></em>
    [:test] [:test-not]))</code>.
</dd><dt><span class="term"><code class="code">(<a class="ulink" href="http://www.lisp.org/HyperSpec/Body/mac_setfcm_psetf.html" target="_top"><code class="function">SETF</code></a> (<code class="function">EXT:WEAK-ALIST-VALUE</code>
   <em class="replaceable"><code>item</code></em> <em class="replaceable"><code>weak-alist</code></em> [:test] [:test-not])
   <em class="replaceable"><code>value</code></em>)</code></span></dt><dd>replaces the value stored for <em class="replaceable"><code>item</code></em> in
   a <em class="replaceable"><code>weak-alist</code></em>.  When a pair with the given
   <em class="replaceable"><code>item</code></em> as key does not exist or has already been <a href="gc.html" class="olink">garbage-collect</a>ed, a new pair
   is added to the <a class="" href="http://www.lisp.org/HyperSpec/Body/glo_a.html#association_list">association list</a>.</dd></dl></div><p>Weak associations lists are useful to supplement objects with
 additional information that is stored outside of the object, when the
 number of such objects is known to be small.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="weak-ht"></a>31.7.9. Weak Hash Tables</h3></div></div></div><p>A weak <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/syscla_hash-table.html" target="_top"><code class="classname">HASH-TABLE</code></a> is an unordered collection of pairs, each
 pair being built from an object called <em class="replaceable"><code>key</code></em> and an object called
 <em class="replaceable"><code>value</code></em>. There can be only one pair with a given <em class="replaceable"><code>key</code></em> in a weak
 <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/syscla_hash-table.html" target="_top"><code class="classname">HASH-TABLE</code></a>. The lifetime of each pair depends on the type of the
 weak <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/syscla_hash-table.html" target="_top"><code class="classname">HASH-TABLE</code></a>
</p><div class="variablelist"><dl><dt><span class="term"><code class="constant">:KEY</code></span></dt><dd>The pair exists as long as the <em class="replaceable"><code>key</code></em> is not <a href="gc.html" class="olink">garbage-collect</a>ed.
    As long as the <em class="replaceable"><code>key</code></em> is alive, it prevents the <em class="replaceable"><code>value</code></em> from
    being <a href="gc.html" class="olink">garbage-collect</a>ed.</dd><dt><span class="term"><code class="constant">:VALUE</code></span></dt><dd>The pair exists as long as the <em class="replaceable"><code>value</code></em> is not <a href="gc.html" class="olink">garbage-collect</a>ed.
     As long as the <em class="replaceable"><code>value</code></em> is alive, it prevents the <em class="replaceable"><code>key</code></em> from
     being <a href="gc.html" class="olink">garbage-collect</a>ed.</dd><dt><span class="term"><code class="constant">:KEY-AND-VALUE</code></span></dt><dd>The pair exists as long as the <em class="replaceable"><code>key</code></em> and the
     <em class="replaceable"><code>value</code></em> are alive.</dd><dt><span class="term"><code class="constant">:KEY-OR-VALUE</code></span></dt><dd>The pair exists as long as the <em class="replaceable"><code>key</code></em> or the
     <em class="replaceable"><code>value</code></em> are alive.  As long as the <em class="replaceable"><code>key</code></em> is alive, it prevents
     the <em class="replaceable"><code>key</code></em> from being <a href="gc.html" class="olink">garbage-collect</a>ed, and as long as the <em class="replaceable"><code>value</code></em> is
     alive, it prevents the <em class="replaceable"><code>key</code></em> from being <a href="gc.html" class="olink">garbage-collect</a>ed.
  </dd></dl></div><p>
In other words, each pair is:
</p><div class="variablelist"><dl><dt><span class="term"><code class="constant">:KEY</code></span></dt><dd>a <a class="link" href="weak.html#weak-mapping" title="31.7.5. Weak Associations"><code class="classname">EXT:WEAK-MAPPING</code></a> from the <em class="replaceable"><code>key</code></em> to the <em class="replaceable"><code>value</code></em>,
 </dd><dt><span class="term"><code class="constant">:VALUE</code></span></dt><dd>a <a class="link" href="weak.html#weak-mapping" title="31.7.5. Weak Associations"><code class="classname">EXT:WEAK-MAPPING</code></a> from the <em class="replaceable"><code>value</code></em> to the <em class="replaceable"><code>key</code></em>,
 </dd><dt><span class="term"><code class="constant">:KEY-AND-VALUE</code></span></dt><dd>a <a class="link" href="weak.html#weak-and-relation" title="31.7.3. Weak And Relations"><code class="classname">EXT:WEAK-AND-RELATION</code></a> of the <em class="replaceable"><code>key</code></em> and the <em class="replaceable"><code>value</code></em>,
 </dd><dt><span class="term"><code class="constant">:KEY-OR-VALUE</code></span></dt><dd>a <a class="link" href="weak.html#weak-or-relation" title="31.7.4. Weak Or Relations"><code class="classname">EXT:WEAK-OR-RELATION</code></a> of the <em class="replaceable"><code>key</code></em> and the <em class="replaceable"><code>value</code></em>.
</dd></dl></div><p>See also <a class="xref" href="make-hash.html" title="18.1. Function MAKE-HASH-TABLE">Section 18.1, “Function <code class="function">MAKE-HASH-TABLE</code>”</a>.</p><p>Weak <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/syscla_hash-table.html" target="_top"><code class="classname">HASH-TABLE</code></a>s are useful to supplement objects with
 additional information that is stored outside of the object. This data
 structure scales up without performance degradation when the number of
 pairs is big.</p><p>Weak <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/syscla_hash-table.html" target="_top"><code class="classname">HASH-TABLE</code></a>s are also useful to implement canonicalization
 tables.</p></div></div><div class="bookinfo"><hr /><table width="100%" summary="impnotes meta info"><th><td align="left">These notes document <a class="ulink" href="http://clisp.cons.org" target="_top"><span class="command"><strong>CLISP</strong></span></a> version 2.46</td><td align="right">Last modified: 2008-07-02</td></th></table></div><div class="custom-footer"><hr /><table width="100%"><tr><td align="left"><a href="http://clisp.cons.org"><img src="clisp.png" width="48" height="48" alt="[CLISP home]" /></a></td><td align="center"><a href="http://sourceforge.net/donate/index.php?group_id=1355"><img src="http://images.sourceforge.net/images/project-support.jpg" width="88" height="32" alt="[Support CLISP]" /></a></td><td align="right"><a href="http://sourceforge.net"><img width="125" height="37" alt="[SourceForge]" src="http://sflogo.sourceforge.net/sflogo.php?group_id=1355&amp;type=2&amp;page=weak" /></a></td></tr></table></div><hr /><form method="get" action="http://www.google.com/custom" target="_top"><table width="100%" border="0"><tr><td nowrap="nowrap" align="center"><input type="hidden" name="domains" value="clisp.cons.org;clisp.podval.org;www.lisp.org" /><label for="sbi" style="display: none">Enter your search terms</label><input type="text" name="q" size="50" maxlength="255" id="sbi" value="31.7. Weak Objects" /><label for="sbb" style="display: none">Submit search form</label><input type="submit" name="sa" value="Google Search" id="sbb" /></td></tr><tr><td nowrap="nowrap" align="center"><input type="radio" name="sitesearch" value="" checked="1" id="ss0" /><label for="ss0" title="Search the Web"><small>Web</small></label><input type="radio" name="sitesearch" value="clisp.cons.org" id="ss1" /><label for="ss1" title="Search clisp.cons.org"><small>clisp.cons.org</small></label><input type="radio" name="sitesearch" value="clisp.podval.org" id="ss2" /><label for="ss2" title="Search clisp.podval.org"><small>clisp.podval.org</small></label><input type="radio" name="sitesearch" value="www.lisp.org" id="ss3" /><label for="ss3" title="Search www.lisp.org"><small>www.lisp.org</small></label><input type="hidden" name="client" value="pub-4445255502750357" /><input type="hidden" name="forid" value="1" /><input type="hidden" name="ie" value="UTF-8" /><input type="hidden" name="oe" value="UTF-8" /><input type="hidden" name="cof" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:000000;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;LH:48;LW:48;L:http://clisp.cons.org/clisp.png;S:http://clisp.cons.org;FORID:1" /><input type="hidden" name="hl" value="en" /></td></tr></table></form><hr /><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="gstream.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ext-p-indep.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="final.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">31.6. Generic streams </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 31.8. Finalization</td></tr></table></div></body></html>
