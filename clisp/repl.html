<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>25.1. Top Level Loop</title><link rel="stylesheet" href="impnotes.css" type="text/css" /><link rev="made" href="mailto:clisp-list@lists.sourceforge.net" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot_7566" /><link rel="start" href="index.html" title="Implementation Notes for GNU CLISP" /><link rel="up" href="environment.html" title="Chapter 25. Environment" /><link rel="prev" href="environment.html" title="Chapter 25. Environment" /><link rel="next" href="debugger.html" title="25.2. Debugging Utilities" /><link rel="copyright" href="legalese.html" title="Legal Status of the CLISP Implementation Notes" /><meta name="date" content="'generated: 2008-07-02 11:52:30-04:00'" /><link rel="author" title="Authors" href="index.html#authors" /><link rel="contents" title="Table of Contents" href="index.html" /><link rel="glossary" href="glossary.html" /><link rel="help" href="faq.html#faq-help" title="How do I ask for help?" /><link rel="home" title="Home" href="http://clisp.cons.org" /><link rel="index" href="idx.html" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">25.1. Top Level Loop
  </th></tr><tr><td width="20%" align="left"><a accesskey="p" href="environment.html">Prev</a> </td><th width="60%" align="center">Chapter 25. Environment
  </th><td width="20%" align="right"> <a accesskey="n" href="debugger.html">Next</a></td></tr></table><hr /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="repl"></a>25.1. Top Level Loop
  <a class="clhs" href="http://www.lisp.org/HyperSpec/Body/sec_25-1-1.html">[sec_25-1-1]</a></h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="repl.html#user-commands">25.1.1. User-defined Commands</a></span></dt></dl></div><p>The debugger may be invoked through the functions
 <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/fun_invoke-debugger.html" target="_top"><code class="function">INVOKE-DEBUGGER</code></a>, <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/fun_break.html" target="_top"><code class="function">BREAK</code></a>, <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/fun_signal.html" target="_top"><code class="function">SIGNAL</code></a>, <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/fun_error.html" target="_top"><code class="function">ERROR</code></a>, <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/fun_cerror.html" target="_top"><code class="function">CERROR</code></a>, <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/fun_warn.html" target="_top"><code class="function">WARN</code></a>.
 The stepper is invoked through the macro <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/mac_step.html" target="_top"><code class="function">STEP</code></a>.
 Debugger and stepper execute subordinate <a class="clhs" href="http://www.lisp.org/HyperSpec/Body/sec_25-1-1.html">read-eval-print loop</a>
 (called <strong class="first"><em class="firstterm">break loops</em></strong>)
 which are similar to the main <a class="clhs" href="http://www.lisp.org/HyperSpec/Body/sec_25-1-1.html">read-eval-print loop</a> except for the
 <a class="link" href="prompt.html" title="31.9. The Prompt">prompt</a> and the set of available commands.
 Commands must be typed literally, in any case,
 without surrounding quotes or <a class="clhs" href="http://www.lisp.org/HyperSpec/Body/sec_2-1-4-7.html">whitespace</a>.
 Each command has a keyword abbreviation,
 indicated in the second column.</p><div class="table"><a id="debugger-main-deb-step"></a><p class="title"><b>Table 25.1. Commands common to the main loop, the debugger and the stepper</b></p><div class="table-contents"><table summary="Commands common to the main loop, the debugger and the stepper" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="center">command</th><th align="center">abbreviation</th><th align="center">operation</th></tr></thead><tbody><tr><td align="center"><a href="repl.html#debugger-main-deb-step" class="olink"><span class="command"><strong>help</strong></span></a></td><td align="center"><span class="command"><strong>:h</strong></span></td><td align="center">prints a list of available commands</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="debugger-deb-step"></a><p class="title"><b>Table 25.2. Commands common to the debugger and the stepper</b></p><div class="table-contents"><table summary="Commands common to the debugger and the stepper" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="center">command</th><th align="center">abbreviation</th><th align="center">operation</th></tr></thead><tbody><tr><td align="center"><span class="command"><strong>Abort</strong></span></td><td align="center"><span class="command"><strong>:a</strong></span></td><td align="center">abort to the next most recent <a class="clhs" href="http://www.lisp.org/HyperSpec/Body/sec_25-1-1.html">read-eval-print loop</a></td></tr><tr><td align="center"><span class="command"><strong>Unwind</strong></span></td><td align="center"><span class="command"><strong>:uw</strong></span></td><td align="center">abort to the next most recent <a class="clhs" href="http://www.lisp.org/HyperSpec/Body/sec_25-1-1.html">read-eval-print loop</a></td></tr><tr><td align="center"><span class="command"><strong>Quit</strong></span></td><td align="center"><span class="command"><strong>:q</strong></span></td><td align="center">quit to the top <a class="clhs" href="http://www.lisp.org/HyperSpec/Body/sec_25-1-1.html">read-eval-print loop</a></td></tr></tbody></table></div></div><br class="table-break" /><p>The stack is organized into frames and other stack elements.
 Usually every invocation of an interpreted function and every
 evaluation of an interpreted form corresponds to one stack frame.
 Special forms such as <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/speope_letcm_letst.html" target="_top"><code class="function">LET</code></a>, <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/speope_letcm_letst.html" target="_top"><code class="function">LET*</code></a>, <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/speope_unwind-protect.html" target="_top"><code class="function">UNWIND-PROTECT</code></a> and <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/speope_catch.html" target="_top"><code class="function">CATCH</code></a>
 produce special kinds of stack frames.</p><p><a id="cur-frame"></a>In a break loop there is a
 <strong class="first"><em class="firstterm"><a class="link" href="repl.html#cur-frame">current stack frame</a></em></strong>, which is initially the most recent
 stack frame but can be moved using the debugger
 commands <span class="command"><strong>Up</strong></span> and <span class="command"><strong>Down</strong></span>.</p><p>Evaluation of forms in a break loop occurs in the <a class="clhs" href="http://www.lisp.org/HyperSpec/Body/sec_3-1-1-3.html">lexical environment</a> of the
 <a class="link" href="repl.html#cur-frame">current stack frame</a> and <span class="emphasis"><em>at the same time</em></span> in the <a class="clhs" href="http://www.lisp.org/HyperSpec/Body/sec_3-1-1-2.html">dynamic environment</a>
 of the debugger's caller.  This means that to inspect or modify a
 <a class="clhs" href="http://www.lisp.org/HyperSpec/Body/sec_3-1-2-1-1-1.html">lexical variable</a> all you have to do is to move the <a class="link" href="repl.html#cur-frame">current stack frame</a> to be just
 below the frame that corresponds to the form or the function call that
 binds that variable.</p><p>There is a current <strong class="first"><em class="firstterm">stack mode</em></strong> which defines
 in how much detail the stack is shown by the stack-related debugger
 commands:</p><div class="orderedlist"><ol type="1"><li>All the stack elements are considered.
    This mode works fine for debugging compiled functions.</li><li>All the frames are considered.</li><li>Only lexical frames (frames that correspond to special
    forms that modify the <a class="clhs" href="http://www.lisp.org/HyperSpec/Body/sec_3-1-1-3.html">lexical environment</a>) are considered.</li><li>Only <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/fun_eval.html" target="_top"><code class="function">EVAL</code></a> and <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/fun_apply.html" target="_top"><code class="function">APPLY</code></a> frames are considered.
    Every evaluation of a form in the interpreter corresponds to an
    <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/fun_eval.html" target="_top"><code class="function">EVAL</code></a> frame.  This is the default.</li><li>Only <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/fun_apply.html" target="_top"><code class="function">APPLY</code></a> frames are considered.
    Every invocation of an interpreted function corresponds to one
    <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/fun_apply.html" target="_top"><code class="function">APPLY</code></a> frame.</li></ol></div><div class="table"><a id="debugger-deb-step-1"></a><p class="title"><b>Table 25.3. Commands common to the debugger and the stepper</b></p><div class="table-contents"><table summary="Commands common to the debugger and the stepper" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="center">command</th><th align="center">abbreviation</th><th align="center">operation</th></tr></thead><tbody><tr><td align="center"><span class="command"><strong>Error</strong></span></td><td align="center"><span class="command"><strong>:e</strong></span></td><td align="center">print the last error object.</td></tr><tr><td align="center"><span class="command"><strong>Inspect</strong></span></td><td align="center"><span class="command"><strong>:i</strong></span></td><td align="center"><a class="link" href="debugger.html#inspect" title="25.2.6. Function INSPECT"><code class="function">INSPECT</code></a> the last error object.</td></tr><tr><td align="center"><span class="command"><strong>Where</strong></span></td><td align="center"><span class="command"><strong>:w</strong></span></td><td align="center">shows the <a class="link" href="repl.html#cur-frame">current stack frame</a>.</td></tr><tr><td align="center"><span class="command"><strong>Up</strong></span></td><td align="center"><span class="command"><strong>:u</strong></span></td><td align="center">goes up one frame, i.e., to the caller if in mode-5</td></tr><tr><td align="center"><span class="command"><strong>Down</strong></span></td><td align="center"><span class="command"><strong>:d</strong></span></td><td align="center">does down one frame, i.e., to the callee if in mode-5</td></tr><tr><td align="center"><span class="command"><strong>Top</strong></span></td><td align="center"><span class="command"><strong>:t</strong></span></td><td align="center">goes to top frame, i.e., to the top-level form if in mode-4
 </td></tr><tr><td align="center"><span class="command"><strong>Bottom</strong></span></td><td align="center"><span class="command"><strong>:b</strong></span></td><td align="center">goes to bottom (most recent) frame, i.e., most probably to the
   form or function that caused the debugger to be entered.</td></tr><tr><td align="center"><span class="command"><strong>Mode</strong></span> <em class="replaceable"><code>mode</code></em></td><td align="center"><span class="command"><strong>:m</strong></span> <em class="replaceable"><code>mode</code></em></td><td align="center">sets the current stack mode</td></tr><tr><td align="center"><span class="command"><strong>Frame-limit</strong></span> <em class="replaceable"><code>l</code></em></td><td align="center"><span class="command"><strong>:fl</strong></span></td><td align="center">set the frame-limit: this many frames will be printed
   by <span class="command"><strong>Backtrace</strong></span> at most.</td></tr><tr><td align="center"><span class="command"><strong>Backtrace</strong></span> [<em class="replaceable"><code>mode</code></em> [<em class="replaceable"><code>l</code></em>]]</td><td align="center"><span class="command"><strong>:bt</strong></span> [<em class="replaceable"><code>mode</code></em> [<em class="replaceable"><code>l</code></em>]]</td><td align="center">lists the stack in the given <em class="replaceable"><code>mode</code></em>, bottom frame first, top
   frame last; at most <em class="replaceable"><code>l</code></em> frames are printed.</td></tr></tbody></table></div></div><br class="table-break" /><p>If the <a class="link" href="repl.html#cur-frame">current stack frame</a> is an <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/fun_eval.html" target="_top"><code class="function">EVAL</code></a> or <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/fun_apply.html" target="_top"><code class="function">APPLY</code></a> frame, the
  following commands are available as well:</p><div class="table"><a id="debugger-eval-apply"></a><p class="title"><b>Table 25.4. Commands specific to <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/fun_eval.html" target="_top"><code class="function">EVAL</code></a>/<a class="ulink" href="http://www.lisp.org/HyperSpec/Body/fun_apply.html" target="_top"><code class="function">APPLY</code></a></b></p><div class="table-contents"><table summary="Commands specific to EVAL/APPLY" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="center">command</th><th align="center">abbreviation</th><th align="center">operation</th></tr></thead><tbody><tr><td align="center"><span class="command"><strong>Break+</strong></span></td><td align="center"><span class="command"><strong>:br+</strong></span></td><td align="center">sets a breakpoint in the current frame.  When the corresponding
  form or function will be left, the debugger will be entered again, with
  the variable <a class="link" href="debugger.html#trace-val"><code class="varname">EXT:*TRACE-VALUES*</code></a> containing a list of its values.</td></tr><tr><td align="center"><span class="command"><strong>Break-</strong></span></td><td align="center"><span class="command"><strong>:br-</strong></span></td><td align="center">removes a breakpoint from the current frame.</td></tr><tr><td align="center"><span class="command"><strong>Redo</strong></span></td><td align="center"><span class="command"><strong>:rd</strong></span></td><td align="center">re-evaluates the corresponding form or function call. This
  command can be used to restart parts of a computation without
  aborting it entirely.</td></tr><tr><td align="center"><span class="command"><strong>Return</strong></span> <em class="replaceable"><code>value</code></em></td><td align="center"><span class="command"><strong>:rt</strong></span> <em class="replaceable"><code>value</code></em></td><td align="center">leaves the current frame, returning the given value.</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="debugger-deb"></a><p class="title"><b>Table 25.5. Commands specific to the debugger</b></p><div class="table-contents"><table summary="Commands specific to the debugger" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="center">command</th><th align="center">abbreviation</th><th align="center">operation</th></tr></thead><tbody><tr><td align="center"><span class="command"><strong>Continue</strong></span></td><td align="center"><span class="command"><strong>:c</strong></span></td><td align="center">continues evaluation of the program.</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="debugger-step"></a><p class="title"><b>Table 25.6. Commands specific to the stepper</b></p><div class="table-contents"><table summary="Commands specific to the stepper" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="center">command</th><th align="center">abbreviation</th><th align="center">operation</th></tr></thead><tbody><tr><td align="center"><span class="command"><strong>Step</strong></span></td><td align="center"><span class="command"><strong>:s</strong></span></td><td align="center">step into a form: evaluate this form in single step mode
   </td></tr><tr><td align="center"><span class="command"><strong>Next</strong></span></td><td align="center"><span class="command"><strong>:n</strong></span></td><td align="center">step over a form: evaluate this form at once
   </td></tr><tr><td align="center"><span class="command"><strong>Over</strong></span></td><td align="center"><span class="command"><strong>:o</strong></span></td><td align="center">step over this level: evaluate at once up to the next return
   </td></tr><tr><td align="center"><span class="command"><strong>Continue</strong></span></td><td align="center"><span class="command"><strong>:c</strong></span></td><td align="center">switch off single step mode, continue evaluation
   </td></tr></tbody></table></div></div><br class="table-break" /><p>The stepper is usually used like this: If some form returns a
 strange value or results in an error, call <code class="code">(<a class="ulink" href="http://www.lisp.org/HyperSpec/Body/mac_step.html" target="_top"><code class="function">STEP</code></a>
 <em class="replaceable"><code>form</code></em>)</code> and navigate using the
 commands <span class="command"><strong>Step</strong></span> and <span class="command"><strong>Next</strong></span> until you
 reach the form you regard as responsible.  If you are too fast (execute
 <span class="command"><strong>Next</strong></span> once and get the error), there is no way back;
 you have to restart the entire stepper session.  If you are too slow
 (stepped into a function or a form which certainly is OK), a couple of
 <span class="command"><strong>Next</strong></span> commands or one <span class="command"><strong>Over</strong></span> command
 will help.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="user-commands"></a>25.1.1. User-defined Commands</h3></div></div></div><p>You can set <strong class="first"><em class="firstterm"><a class="link" href="repl.html#user-commands" title="25.1.1. User-defined Commands"><code class="varname">CUSTOM:*USER-COMMANDS*</code></a></em></strong> to a list of
 <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/syscla_function.html" target="_top"><code class="classname">FUNCTION</code></a>s, each returning a <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/syscla_list.html" target="_top"><code class="classname">LIST</code></a>
 of <strong class="first"><em class="firstterm">bindings</em></strong>, i.e., either a
</p><div class="variablelist"><dl><dt><span class="term"><a class="ulink" href="http://www.lisp.org/HyperSpec/Body/syscla_string.html" target="_top"><code class="classname">STRING</code></a></span></dt><dd>the help string printed by <a href="repl.html#debugger-main-deb-step" class="olink"><span class="command"><strong>help</strong></span></a> in addition to the
  standard <a class="ulink" href="http://clisp.cons.org" target="_top"><span class="command"><strong>CLISP</strong></span></a> help</dd><dt><span class="term"><a class="ulink" href="http://www.lisp.org/HyperSpec/Body/syscla_cons.html" target="_top"><code class="classname">CONS</code></a> <span class="data"><code class="literal">(<a class="ulink" href="http://www.lisp.org/HyperSpec/Body/syscla_string.html" target="_top"><code class="classname">STRING</code></a>
   . <a class="ulink" href="http://www.lisp.org/HyperSpec/Body/syscla_function.html" target="_top"><code class="classname">FUNCTION</code></a>)</code></span></span></dt><dd>the actual binding: when the user types the string,
   the function is called on the remainder of the string, i.e., the part
   of the string after the command.</dd></dl></div><p> E.g.,
</p><pre class="programlisting">
(setq <a class="link" href="repl.html#user-commands" title="25.1.1. User-defined Commands"><code class="varname">CUSTOM:*USER-COMMANDS*</code></a>
      (list (lambda () (list (format nil "~2%User-defined commands:")))
            (lambda ()
              (flet ((panic (argline)
                       (format t "don't panic~@[ because of ~A~], ~D~%"
                               (and (plusp (length argline)) argline)
                               (random 42))))
                (list (format nil "~%panic   :p    hit the panic button!")
                      (cons "panic" #'panic)
                      (cons ":p" #'panic))))
            (lambda ()
              (let ((curses #("ouch" "yuk" "bletch")))
                (flet ((swear (argline)
                         (format t "~A: ~A!~%" argline
                                 (aref curses (random (length curses))))))
                  (list (format nil "~%swear   :e    curse")
                        (cons "swear" #'swear)
                        (cons ":e" #'swear)))))))
</pre></div></div><div class="bookinfo"><hr /><table width="100%" summary="impnotes meta info"><th><td align="left">These notes document <a class="ulink" href="http://clisp.cons.org" target="_top"><span class="command"><strong>CLISP</strong></span></a> version 2.46</td><td align="right">Last modified: 2008-07-02</td></th></table></div><div class="custom-footer"><hr /><table width="100%"><tr><td align="left"><a href="http://clisp.cons.org"><img src="clisp.png" width="48" height="48" alt="[CLISP home]" /></a></td><td align="center"><a href="http://sourceforge.net/donate/index.php?group_id=1355"><img src="http://images.sourceforge.net/images/project-support.jpg" width="88" height="32" alt="[Support CLISP]" /></a></td><td align="right"><a href="http://sourceforge.net"><img width="125" height="37" alt="[SourceForge]" src="http://sflogo.sourceforge.net/sflogo.php?group_id=1355&amp;type=2&amp;page=repl" /></a></td></tr></table></div><hr /><form method="get" action="http://www.google.com/custom" target="_top"><table width="100%" border="0"><tr><td nowrap="nowrap" align="center"><input type="hidden" name="domains" value="clisp.cons.org;clisp.podval.org;www.lisp.org" /><label for="sbi" style="display: none">Enter your search terms</label><input type="text" name="q" size="50" maxlength="255" id="sbi" value="25.1. Top Level Loop" /><label for="sbb" style="display: none">Submit search form</label><input type="submit" name="sa" value="Google Search" id="sbb" /></td></tr><tr><td nowrap="nowrap" align="center"><input type="radio" name="sitesearch" value="" checked="1" id="ss0" /><label for="ss0" title="Search the Web"><small>Web</small></label><input type="radio" name="sitesearch" value="clisp.cons.org" id="ss1" /><label for="ss1" title="Search clisp.cons.org"><small>clisp.cons.org</small></label><input type="radio" name="sitesearch" value="clisp.podval.org" id="ss2" /><label for="ss2" title="Search clisp.podval.org"><small>clisp.podval.org</small></label><input type="radio" name="sitesearch" value="www.lisp.org" id="ss3" /><label for="ss3" title="Search www.lisp.org"><small>www.lisp.org</small></label><input type="hidden" name="client" value="pub-4445255502750357" /><input type="hidden" name="forid" value="1" /><input type="hidden" name="ie" value="UTF-8" /><input type="hidden" name="oe" value="UTF-8" /><input type="hidden" name="cof" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:000000;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;LH:48;LW:48;L:http://clisp.cons.org/clisp.png;S:http://clisp.cons.org;FORID:1" /><input type="hidden" name="hl" value="en" /></td></tr></table></form><hr /><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="environment.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="environment.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="debugger.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 25. Environment
   </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 25.2. Debugging Utilities
  </td></tr></table></div></body></html>
